"use strict";!function(){function artigoDetalheCtrl($scope,$controller,item,functionToDetailNotify,objectName,stUtil){var ctrl=this;item=item||{},item.content=item.content||" ",ctrl.activeTab=item.content.length>2?1:0,angular.extend(ctrl,$controller("genericDetalheController",{$scope:$scope,functionToDetailNotify:functionToDetailNotify,objectName:objectName,item:item}))}function artigoListCtrl($scope,$controller,config,stCrudTools,stUtil,$route){function saveSuccessResolve(obj){stUtil.showMessage("","Salvo com sucesso!"),ctrl.data.getList()}var ctrl=this;angular.extend(ctrl,$controller("genericListController",{$scope:$scope,objectName:objectName,detalheTemplateUrl:"app/artigo/html/artigoDetalhe.html",detalheController:"artigoDetalheCtrl",detalheControllerAs:"$artigoDetalheCtrl",filtros:[{attr:"titulo",label:" Buscar pelo nomeprincipal"}]})),ctrl.data.tableColumns=[{label:"TÃ­tulo do artigo",attr:"titulo",orderBy:!0,labelIcon:"text_format"}],ctrl.data.orderBy="titulo",ctrl.data.requestListParams={objectName:objectName,maxItensPerPage:config.confs.maxItemsPerPage||9},ctrl.data.saveSuccesResolve=saveSuccessResolve,ctrl.data.getList()}angular.module("stapiApp").controller("artigoDetalheCtrl",artigoDetalheCtrl).controller("artigoListCtrl",artigoListCtrl);var objectName="Artigo"}(),function(){function artigoList(){return{restrict:"E",templateUrl:"app/artigo/html/artigoList.html",controller:"artigoListCtrl",controllerAs:"$artigoListCtrl"}}function artigoGridView(){return{restrict:"E",templateUrl:"app/artigo/html/artigoGridView.html"}}function artigoTableView(){return{restrict:"E",templateUrl:"app/artigo/html/artigoTableView.html"}}function artigoForm(){return{restrict:"E",templateUrl:"app/artigo/html/artigoForm.html"}}angular.module("stapiApp").directive("artigoGridView",artigoGridView).directive("artigoTableView",artigoTableView).directive("artigoList",artigoList).directive("artigoDetalhe",artigoList).directive("artigoForm",artigoForm)}(),function(){function artigoUtil($mdDialogstService,$q,$mdDialog,$mdMedia,stCrudToolsUtils){}angular.module("stapiApp").factory("artigoUtil",artigoUtil)}(),function(){angular.module("stapiApp").config(function($routeProvider,$httpProvider){$routeProvider.when("/artigo",{template:"<artigo-list></artigo-list>"})})}(),function(){angular.module("stapi").factory("config",function($location,$window,$rootScope,$http,$templateCache){return{scope:"static",confs:{path:"StApi",defaultRoute:"/login",securityPaths:"all",appVersion:"1.0",fullScreenItemDetail:!0,initialPath:"/democompoment",loginPath:"/login",notFoundPath:"/notfound",pathsToHideMenu:["/login"]}}})}(),function(root,factory){"function"==typeof define&&define.amd?define("simple-module",["jquery"],function(a0){return root.Module=factory(a0)}):"object"==typeof exports?module.exports=factory(require("jquery")):root.SimpleModule=factory(jQuery)}(this,function($){var Module,slice=[].slice;return Module=function(){function Module(opts){var base,cls,i,instance,instances,len,name;if(this.opts=$.extend({},this.opts,opts),(base=this.constructor)._connectedClasses||(base._connectedClasses=[]),instances=function(){var i,len,ref,results;for(ref=this.constructor._connectedClasses,results=[],i=0,len=ref.length;len>i;i++)cls=ref[i],name=cls.pluginName.charAt(0).toLowerCase()+cls.pluginName.slice(1),cls.prototype._connected&&(cls.prototype._module=this),results.push(this[name]=new cls);return results}.call(this),this._connected)this.opts=$.extend({},this.opts,this._module.opts);else for(this._init(),i=0,len=instances.length;len>i;i++)instance=instances[i],"function"==typeof instance._init&&instance._init();this.trigger("initialized")}return Module.extend=function(obj){var key,ref,val;if(null!=obj&&"object"==typeof obj){for(key in obj)val=obj[key],"included"!==key&&"extended"!==key&&(this[key]=val);return null!=(ref=obj.extended)?ref.call(this):void 0}},Module.include=function(obj){var key,ref,val;if(null!=obj&&"object"==typeof obj){for(key in obj)val=obj[key],"included"!==key&&"extended"!==key&&(this.prototype[key]=val);return null!=(ref=obj.included)?ref.call(this):void 0}},Module.connect=function(cls){if("function"==typeof cls){if(!cls.pluginName)throw new Error("Module.connect: cannot connect plugin without pluginName");return cls.prototype._connected=!0,this._connectedClasses||(this._connectedClasses=[]),this._connectedClasses.push(cls),cls.pluginName?this[cls.pluginName]=cls:void 0}},Module.prototype.opts={},Module.prototype._init=function(){},Module.prototype.on=function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=$(this)).on.apply(ref,args),this},Module.prototype.one=function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=$(this)).one.apply(ref,args),this},Module.prototype.off=function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=$(this)).off.apply(ref,args),this},Module.prototype.trigger=function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=$(this)).trigger.apply(ref,args),this},Module.prototype.triggerHandler=function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=$(this)).triggerHandler.apply(ref,args)},Module.prototype._t=function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=this.constructor)._t.apply(ref,args)},Module._t=function(){var args,key,ref,result;return key=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],result=(null!=(ref=this.i18n[this.locale])?ref[key]:void 0)||"",args.length>0?(result=result.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(p0,p,position){return position?p+args[parseInt(position)-1]:p+args.shift()}),result.replace(/%%s/g,"%s")):result},Module.i18n={"zh-CN":{}},Module.locale="zh-CN",Module}()}),function(root,factory){"function"==typeof define&&define.amd?define("simple-hotkeys",["jquery","simple-module"],function($,SimpleModule){return root.hotkeys=factory($,SimpleModule)}):"object"==typeof exports?module.exports=factory(require("jquery"),require("simple-module")):(root.simple=root.simple||{},root.simple.hotkeys=factory(jQuery,SimpleModule))}(this,function($,SimpleModule){var Hotkeys,hotkeys,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;return Hotkeys=function(superClass){function Hotkeys(){return Hotkeys.__super__.constructor.apply(this,arguments)}return extend(Hotkeys,superClass),Hotkeys.count=0,Hotkeys.keyNameMap={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",91:"Meta",93:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"Multiply",107:"Add",109:"Subtract",110:"Decimal",111:"Divide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",59:";",61:"=",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Hotkeys.aliases={escape:"esc","delete":"del","return":"enter",ctrl:"control",space:"spacebar",ins:"insert",cmd:"meta",command:"meta",wins:"meta",windows:"meta"},Hotkeys.normalize=function(shortcut){var i,j,key,keyname,keys,len;for(keys=shortcut.toLowerCase().replace(/\s+/gi,"").split("+"),i=j=0,len=keys.length;len>j;i=++j)key=keys[i],keys[i]=this.aliases[key]||key;return keyname=keys.pop(),keys.sort().push(keyname),keys.join("_")},Hotkeys.prototype.opts={el:document},Hotkeys.prototype._init=function(){return this.id=++this.constructor.count,this._map={},this._delegate="string"==typeof this.opts.el?document:this.opts.el,$(this._delegate).on("keydown.simple-hotkeys-"+this.id,this.opts.el,function(_this){return function(e){var ref;return null!=(ref=_this._getHander(e))?ref.call(_this,e):void 0}}(this))},Hotkeys.prototype._getHander=function(e){var keyname,shortcut;if(keyname=this.constructor.keyNameMap[e.which])return shortcut="",e.altKey&&(shortcut+="alt_"),e.ctrlKey&&(shortcut+="control_"),e.metaKey&&(shortcut+="meta_"),e.shiftKey&&(shortcut+="shift_"),shortcut+=keyname.toLowerCase(),this._map[shortcut]},Hotkeys.prototype.respondTo=function(subject){return"string"==typeof subject?null!=this._map[this.constructor.normalize(subject)]:null!=this._getHander(subject)},Hotkeys.prototype.add=function(shortcut,handler){return this._map[this.constructor.normalize(shortcut)]=handler,this},Hotkeys.prototype.remove=function(shortcut){return delete this._map[this.constructor.normalize(shortcut)],this},Hotkeys.prototype.destroy=function(){return $(this._delegate).off(".simple-hotkeys-"+this.id),this._map={},this},Hotkeys}(SimpleModule),hotkeys=function(opts){return new Hotkeys(opts)}}),function(root,factory){"function"==typeof define&&define.amd?define("simditor",["jquery","simple-module","simple-hotkeys","simple-uploader"],function($,SimpleModule,simpleHotkeys,simpleUploader){return root.Simditor=factory($,SimpleModule,simpleHotkeys,simpleUploader)}):"object"==typeof exports?module.exports=factory(require("jquery"),require("simple-module"),require("simple-hotkeys"),require("simple-uploader")):root.Simditor=factory(jQuery,SimpleModule,simple.hotkeys,simple.uploader)}(this,function($,SimpleModule,simpleHotkeys,simpleUploader){var AlignmentButton,BlockquoteButton,BoldButton,Button,Clipboard,CodeButton,CodePopover,ColorButton,FontScaleButton,Formatter,HrButton,ImageButton,ImagePopover,IndentButton,Indentation,InputManager,ItalicButton,Keystroke,LinkButton,LinkPopover,ListButton,OrderListButton,OutdentButton,Popover,Selection,Simditor,StrikethroughButton,TableButton,TitleButton,Toolbar,UnderlineButton,UndoManager,UnorderListButton,Util,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},slice=[].slice;return Selection=function(superClass){function Selection(){return Selection.__super__.constructor.apply(this,arguments)}return extend(Selection,superClass),Selection.pluginName="Selection",Selection.prototype._range=null,Selection.prototype._startNodes=null,Selection.prototype._endNodes=null,Selection.prototype._containerNode=null,Selection.prototype._nodes=null,Selection.prototype._blockNodes=null,Selection.prototype._rootNodes=null,Selection.prototype._init=function(){return this.editor=this._module,this._selection=document.getSelection(),this.editor.on("selectionchanged",function(_this){return function(e){return _this.reset(),_this._range=_this._selection.getRangeAt(0)}}(this)),this.editor.on("blur",function(_this){return function(e){return _this.reset()}}(this)),this.editor.on("focus",function(_this){return function(e){return _this.reset(),_this._range=_this._selection.getRangeAt(0)}}(this))},Selection.prototype.reset=function(){return this._range=null,this._startNodes=null,this._endNodes=null,this._containerNode=null,this._nodes=null,this._blockNodes=null,this._rootNodes=null},Selection.prototype.clear=function(){var e;try{this._selection.removeAllRanges()}catch(_error){e=_error}return this.reset()},Selection.prototype.range=function(range){var ffOrIE;return range?(this.clear(),this._selection.addRange(range),this._range=range,ffOrIE=this.editor.util.browser.firefox||this.editor.util.browser.msie,!this.editor.inputManager.focused&&ffOrIE&&this.editor.body.focus()):!this._range&&this.editor.inputManager.focused&&this._selection.rangeCount&&(this._range=this._selection.getRangeAt(0)),this._range},Selection.prototype.startNodes=function(){return this._range&&(this._startNodes||(this._startNodes=function(_this){return function(){var startNodes;return startNodes=$(_this._range.startContainer).parentsUntil(_this.editor.body).get(),startNodes.unshift(_this._range.startContainer),$(startNodes)}}(this)())),this._startNodes},Selection.prototype.endNodes=function(){var endNodes;return this._range&&(this._endNodes||(this._endNodes=this._range.collapsed?this.startNodes():(endNodes=$(this._range.endContainer).parentsUntil(this.editor.body).get(),endNodes.unshift(this._range.endContainer),$(endNodes)))),this._endNodes},Selection.prototype.containerNode=function(){return this._range&&(this._containerNode||(this._containerNode=$(this._range.commonAncestorContainer))),this._containerNode},Selection.prototype.nodes=function(){return this._range&&(this._nodes||(this._nodes=function(_this){return function(){var nodes;return nodes=[],_this.startNodes().first().is(_this.endNodes().first())?nodes=_this.startNodes().get():(_this.startNodes().each(function(i,node){var $endNode,$node,$nodes,endIndex,index,sharedIndex,startIndex;return $node=$(node),_this.endNodes().index($node)>-1?nodes.push(node):$node.parent().is(_this.editor.body)||(sharedIndex=_this.endNodes().index($node.parent()))>-1?($endNode=sharedIndex&&sharedIndex>-1?_this.endNodes().eq(sharedIndex-1):_this.endNodes().last(),$nodes=$node.parent().contents(),startIndex=$nodes.index($node),endIndex=$nodes.index($endNode),$.merge(nodes,$nodes.slice(startIndex,endIndex).get())):($nodes=$node.parent().contents(),index=$nodes.index($node),$.merge(nodes,$nodes.slice(index).get()))}),_this.endNodes().each(function(i,node){var $node,$nodes,index;return $node=$(node),$node.parent().is(_this.editor.body)||_this.startNodes().index($node.parent())>-1?(nodes.push(node),!1):($nodes=$node.parent().contents(),index=$nodes.index($node),$.merge(nodes,$nodes.slice(0,index+1)))})),$($.unique(nodes))}}(this)())),this._nodes},Selection.prototype.blockNodes=function(){return this._range?(this._blockNodes||(this._blockNodes=function(_this){return function(){return _this.nodes().filter(function(i,node){return _this.editor.util.isBlockNode(node)})}}(this)()),this._blockNodes):void 0},Selection.prototype.rootNodes=function(){return this._range?(this._rootNodes||(this._rootNodes=function(_this){return function(){return _this.nodes().filter(function(i,node){var $parent;return $parent=$(node).parent(),$parent.is(_this.editor.body)||$parent.is("blockquote")})}}(this)()),this._rootNodes):void 0},Selection.prototype.rangeAtEndOf=function(node,range){var afterLastNode,beforeLastNode,endNode,endNodeLength,lastNodeIsBr,result;return null==range&&(range=this.range()),range&&range.collapsed?(node=$(node)[0],endNode=range.endContainer,endNodeLength=this.editor.util.getNodeLength(endNode),beforeLastNode=range.endOffset===endNodeLength-1,lastNodeIsBr=$(endNode).contents().last().is("br"),afterLastNode=range.endOffset===endNodeLength,beforeLastNode&&lastNodeIsBr||afterLastNode?node===endNode?!0:$.contains(node,endNode)?(result=!0,$(endNode).parentsUntil(node).addBack().each(function(i,n){var $lastChild,beforeLastbr,isLastNode,nodes;return nodes=$(n).parent().contents().filter(function(){return!(this!==n&&3===this.nodeType&&!this.nodeValue)}),$lastChild=nodes.last(),isLastNode=$lastChild.get(0)===n,beforeLastbr=$lastChild.is("br")&&$lastChild.prev().get(0)===n,isLastNode||beforeLastbr?void 0:(result=!1,!1)}),result):!1:!1):void 0},Selection.prototype.rangeAtStartOf=function(node,range){var result,startNode;return null==range&&(range=this.range()),range&&range.collapsed?(node=$(node)[0],startNode=range.startContainer,0!==range.startOffset?!1:node===startNode?!0:$.contains(node,startNode)?(result=!0,$(startNode).parentsUntil(node).addBack().each(function(i,n){var nodes;return nodes=$(n).parent().contents().filter(function(){return!(this!==n&&3===this.nodeType&&!this.nodeValue)}),nodes.first().get(0)!==n?result=!1:void 0}),result):!1):void 0},Selection.prototype.insertNode=function(node,range){return null==range&&(range=this.range()),range?(node=$(node)[0],range.insertNode(node),this.setRangeAfter(node,range)):void 0},Selection.prototype.setRangeAfter=function(node,range){return null==range&&(range=this.range()),null!=range?(node=$(node)[0],range.setEndAfter(node),range.collapse(!1),this.range(range)):void 0},Selection.prototype.setRangeBefore=function(node,range){return null==range&&(range=this.range()),null!=range?(node=$(node)[0],range.setEndBefore(node),range.collapse(!1),this.range(range)):void 0},Selection.prototype.setRangeAtStartOf=function(node,range){return null==range&&(range=this.range()),node=$(node).get(0),range.setEnd(node,0),range.collapse(!1),this.range(range)},Selection.prototype.setRangeAtEndOf=function(node,range){var $lastNode,$node,contents,lastChild,lastChildLength,lastText,nodeLength;return null==range&&(range=this.range()),$node=$(node),(node=$node[0])?($node.is("pre")?(contents=$node.contents(),contents.length>0?(lastChild=contents.last(),lastText=lastChild.text(),lastChildLength=this.editor.util.getNodeLength(lastChild[0]),"\n"===lastText.charAt(lastText.length-1)?range.setEnd(lastChild[0],lastChildLength-1):range.setEnd(lastChild[0],lastChildLength)):range.setEnd(node,0)):(nodeLength=this.editor.util.getNodeLength(node),3!==node.nodeType&&nodeLength>0&&($lastNode=$(node).contents().last(),$lastNode.is("br")?nodeLength-=1:3!==$lastNode[0].nodeType&&this.editor.util.isEmptyNode($lastNode)&&($lastNode.append(this.editor.util.phBr),node=$lastNode[0],nodeLength=0)),range.setEnd(node,nodeLength)),range.collapse(!1),this.range(range)):void 0},Selection.prototype.deleteRangeContents=function(range){var atEndOfBody,atStartOfBody,endRange,startRange;return null==range&&(range=this.range()),startRange=range.cloneRange(),endRange=range.cloneRange(),startRange.collapse(!0),endRange.collapse(!1),atStartOfBody=this.rangeAtStartOf(this.editor.body,startRange),atEndOfBody=this.rangeAtEndOf(this.editor.body,endRange),!range.collapsed&&atStartOfBody&&atEndOfBody?(this.editor.body.empty(),range.setStart(this.editor.body[0],0),range.collapse(!0),this.range(range)):range.deleteContents(),range},Selection.prototype.breakBlockEl=function(el,range){var $el;return null==range&&(range=this.range()),$el=$(el),range.collapsed?(range.setStartBefore($el.get(0)),range.collapsed?$el:$el.before(range.extractContents())):$el},Selection.prototype.save=function(range){var endCaret,endRange,startCaret;return null==range&&(range=this.range()),this._selectionSaved?void 0:(endRange=range.cloneRange(),endRange.collapse(!1),startCaret=$("<span/>").addClass("simditor-caret-start"),endCaret=$("<span/>").addClass("simditor-caret-end"),endRange.insertNode(endCaret[0]),range.insertNode(startCaret[0]),this.clear(),this._selectionSaved=!0)},Selection.prototype.restore=function(){var endCaret,endContainer,endOffset,range,startCaret,startContainer,startOffset;return this._selectionSaved?(startCaret=this.editor.body.find(".simditor-caret-start"),endCaret=this.editor.body.find(".simditor-caret-end"),startCaret.length&&endCaret.length?(startContainer=startCaret.parent(),startOffset=startContainer.contents().index(startCaret),endContainer=endCaret.parent(),endOffset=endContainer.contents().index(endCaret),startContainer[0]===endContainer[0]&&(endOffset-=1),range=document.createRange(),range.setStart(startContainer.get(0),startOffset),range.setEnd(endContainer.get(0),endOffset),startCaret.remove(),endCaret.remove(),this.range(range)):(startCaret.remove(),endCaret.remove()),this._selectionSaved=!1,range):!1},Selection}(SimpleModule),Formatter=function(superClass){function Formatter(){return Formatter.__super__.constructor.apply(this,arguments)}return extend(Formatter,superClass),Formatter.pluginName="Formatter",Formatter.prototype.opts={allowedTags:[],allowedAttributes:{},allowedStyles:{}},Formatter.prototype._init=function(){return this.editor=this._module,this._allowedTags=$.merge(["br","span","a","img","b","strong","i","strike","u","font","p","ul","ol","li","blockquote","pre","code","h1","h2","h3","h4","hr"],this.opts.allowedTags),this._allowedAttributes=$.extend({img:["src","alt","width","height","data-non-image"],a:["href","target"],font:["color"],code:["class"]},this.opts.allowedAttributes),this._allowedStyles=$.extend({span:["color","font-size"],b:["color","font-size"],i:["color","font-size"],strong:["color","font-size"],strike:["color","font-size"],u:["color","font-size"],p:["margin-left","text-align"],h1:["margin-left","text-align"],h2:["margin-left","text-align"],h3:["margin-left","text-align"],h4:["margin-left","text-align"]},this.opts.allowedStyles),this.editor.body.on("click","a",function(e){return!1})},Formatter.prototype.decorate=function($el){return null==$el&&($el=this.editor.body),this.editor.trigger("decorate",[$el]),$el},Formatter.prototype.undecorate=function($el){return null==$el&&($el=this.editor.body.clone()),this.editor.trigger("undecorate",[$el]),$el},Formatter.prototype.autolink=function($el){var $link,$node,findLinkNode,k,lastIndex,len,linkNodes,match,re,replaceEls,subStr,text,uri;for(null==$el&&($el=this.editor.body),linkNodes=[],findLinkNode=function($parentNode){return $parentNode.contents().each(function(i,node){var $node,text;return $node=$(node),$node.is("a")||$node.closest("a, pre",$el).length?void 0:!$node.is("iframe")&&$node.contents().length?findLinkNode($node):(text=$node.text())&&/https?:\/\/|www\./gi.test(text)?linkNodes.push($node):void 0})},findLinkNode($el),re=/(https?:\/\/|www\.)[\w\-\.\?&=\/#%:,@\!\+]+/gi,k=0,len=linkNodes.length;len>k;k++){for($node=linkNodes[k],text=$node.text(),replaceEls=[],match=null,lastIndex=0;null!==(match=re.exec(text));)subStr=text.substring(lastIndex,match.index),replaceEls.push(document.createTextNode(subStr)),lastIndex=re.lastIndex,uri=/^(http(s)?:\/\/|\/)/.test(match[0])?match[0]:"http://"+match[0],$link=$('<a href="'+uri+'" rel="nofollow"></a>').text(match[0]),replaceEls.push($link[0]);replaceEls.push(document.createTextNode(text.substring(lastIndex))),$node.replaceWith($(replaceEls))}return $el},Formatter.prototype.format=function($el){var $node,blockNode,k,l,len,len1,n,node,ref,ref1;if(null==$el&&($el=this.editor.body),$el.is(":empty"))return $el.append("<p>"+this.editor.util.phBr+"</p>"),$el;for(ref=$el.contents(),k=0,len=ref.length;len>k;k++)n=ref[k],this.cleanNode(n,!0);for(ref1=$el.contents(),l=0,len1=ref1.length;len1>l;l++)node=ref1[l],$node=$(node),$node.is("br")?("undefined"!=typeof blockNode&&null!==blockNode&&(blockNode=null),$node.remove()):this.editor.util.isBlockNode(node)?$node.is("li")?blockNode&&blockNode.is("ul, ol")?blockNode.append(node):(blockNode=$("<ul/>").insertBefore(node),blockNode.append(node)):blockNode=null:((!blockNode||blockNode.is("ul, ol"))&&(blockNode=$("<p/>").insertBefore(node)),blockNode.append(node),this.editor.util.isEmptyNode(blockNode)&&blockNode.append(this.editor.util.phBr));return $el},Formatter.prototype.cleanNode=function(node,recursive){var $blockEls,$childImg,$node,$p,$td,allowedAttributes,attr,contents,isDecoration,k,l,len,len1,n,ref,ref1,text,textNode;if($node=$(node),$node.length>0){if(3===$node[0].nodeType)return text=$node.text().replace(/(\r\n|\n|\r)/gm,""),void(text?(textNode=document.createTextNode(text),$node.replaceWith(textNode)):$node.remove());if(contents=$node.is("iframe")?null:$node.contents(),isDecoration=this.editor.util.isDecoratedNode($node),$node.is(this._allowedTags.join(","))||isDecoration){if($node.is("a")&&($childImg=$node.find("img")).length>0&&($node.replaceWith($childImg),$node=$childImg,contents=null),$node.is("td")&&($blockEls=$node.find(this.editor.util.blockNodes.join(","))).length>0&&($blockEls.each(function(_this){return function(i,blockEl){return $(blockEl).contents().unwrap()}}(this)),contents=$node.contents()),$node.is("img")&&$node.hasClass("uploading")&&$node.remove(),!isDecoration){for(allowedAttributes=this._allowedAttributes[$node[0].tagName.toLowerCase()],ref=$.makeArray($node[0].attributes),k=0,len=ref.length;len>k;k++)attr=ref[k],"style"!==attr.name&&(null!=allowedAttributes&&(ref1=attr.name,indexOf.call(allowedAttributes,ref1)>=0)||$node.removeAttr(attr.name));this._cleanNodeStyles($node),$node.is("span")&&(0===$node[0].attributes.length&&$node.contents().first().unwrap(),2===$node[0].style.length&&"rgb(51, 51, 51)"===$node[0].style.color&&"16px"===$node[0].style.fontSize&&$node.contents().unwrap())}}else 1!==$node[0].nodeType||$node.is(":empty")?($node.remove(),contents=null):$node.is("div, article, dl, header, footer, tr")?($node.append("<br/>"),contents.first().unwrap()):$node.is("table")?($p=$("<p/>"),$node.find("tr").each(function(i,tr){return $p.append($(tr).text()+"<br/>")}),$node.replaceWith($p),contents=null):$node.is("thead, tfoot")?($node.remove(),contents=null):$node.is("th")?($td=$("<td/>").append($node.contents()),$node.replaceWith($td)):contents.first().unwrap();if(recursive&&null!=contents&&!$node.is("pre"))for(l=0,len1=contents.length;len1>l;l++)n=contents[l],this.cleanNode(n,!0);return null}},Formatter.prototype._cleanNodeStyles=function($node){var allowedStyles,k,len,pair,ref,ref1,style,styleStr,styles;if(styleStr=$node.attr("style")){if($node.removeAttr("style"),allowedStyles=this._allowedStyles[$node[0].tagName.toLowerCase()],!(allowedStyles&&allowedStyles.length>0))return $node;for(styles={},ref=styleStr.split(";"),k=0,len=ref.length;len>k;k++)style=ref[k],style=$.trim(style),pair=style.split(":"),2===pair.length&&("font-size"===pair[0]&&pair[1].indexOf("px")>0&&parseInt(pair[1],10)<12||(ref1=pair[0],indexOf.call(allowedStyles,ref1)>=0&&(styles[$.trim(pair[0])]=$.trim(pair[1]))));return Object.keys(styles).length>0&&$node.css(styles),$node}},Formatter.prototype.clearHtml=function(html,lineBreak){var container,contents,result;return null==lineBreak&&(lineBreak=!0),container=$("<div/>").append(html),contents=container.contents(),result="",contents.each(function(_this){return function(i,node){var $node,children;return 3===node.nodeType?result+=node.nodeValue:1===node.nodeType&&($node=$(node),children=$node.is("iframe")?null:$node.contents(),children&&children.length>0&&(result+=_this.clearHtml(children)),lineBreak&&i<contents.length-1&&$node.is("br, p, div, li,tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2,h3, h4, header"))?result+="\n":void 0}}(this)),result},Formatter.prototype.beautify=function($contents){var uselessP;return uselessP=function($el){return!!($el.is("p")&&!$el.text()&&$el.children(":not(br)").length<1)},$contents.each(function(i,el){var $el,invalid;return $el=$(el),invalid=$el.is(':not(img, br, col, td, hr, [class^="simditor-"]):empty'),(invalid||uselessP($el))&&$el.remove(),$el.find(':not(img, br, col, td, hr, [class^="simditor-"]):empty').remove()})},Formatter}(SimpleModule),InputManager=function(superClass){function InputManager(){return InputManager.__super__.constructor.apply(this,arguments)}return extend(InputManager,superClass),InputManager.pluginName="InputManager",InputManager.prototype._modifierKeys=[16,17,18,91,93,224],InputManager.prototype._arrowKeys=[37,38,39,40],InputManager.prototype._init=function(){var selectAllKey,submitKey;return this.editor=this._module,this.throttledValueChanged=this.editor.util.throttle(function(_this){return function(params){return setTimeout(function(){return _this.editor.trigger("valuechanged",params)},10)}}(this),300),this.throttledSelectionChanged=this.editor.util.throttle(function(_this){return function(){return _this.editor.trigger("selectionchanged")}}(this),50),$(document).on("selectionchange.simditor"+this.editor.id,function(_this){return function(e){var triggerEvent;if(_this.focused&&!_this.editor.clipboard.pasting)return(triggerEvent=function(){return _this._selectionTimer&&(clearTimeout(_this._selectionTimer),_this._selectionTimer=null),_this.editor.selection._selection.rangeCount>0?_this.throttledSelectionChanged():_this._selectionTimer=setTimeout(function(){return _this._selectionTimer=null,_this.focused?triggerEvent():void 0},10)})()}}(this)),this.editor.on("valuechanged",function(_this){return function(){var $rootBlocks;return _this.lastCaretPosition=null,$rootBlocks=_this.editor.body.children().filter(function(i,node){return _this.editor.util.isBlockNode(node)}),_this.focused&&0===$rootBlocks.length&&(_this.editor.selection.save(),_this.editor.formatter.format(),_this.editor.selection.restore()),_this.editor.body.find("hr, pre, .simditor-table").each(function(i,el){var $el,formatted;return $el=$(el),($el.parent().is("blockquote")||$el.parent()[0]===_this.editor.body[0])&&(formatted=!1,0===$el.next().length&&($("<p/>").append(_this.editor.util.phBr).insertAfter($el),formatted=!0),0===$el.prev().length&&($("<p/>").append(_this.editor.util.phBr).insertBefore($el),formatted=!0),formatted)?_this.throttledValueChanged():void 0}),_this.editor.body.find("pre:empty").append(_this.editor.util.phBr),!_this.editor.util.support.onselectionchange&&_this.focused?_this.throttledSelectionChanged():void 0}}(this)),this.editor.body.on("keydown",$.proxy(this._onKeyDown,this)).on("keypress",$.proxy(this._onKeyPress,this)).on("keyup",$.proxy(this._onKeyUp,this)).on("mouseup",$.proxy(this._onMouseUp,this)).on("focus",$.proxy(this._onFocus,this)).on("blur",$.proxy(this._onBlur,this)).on("drop",$.proxy(this._onDrop,this)).on("input",$.proxy(this._onInput,this)),this.editor.util.browser.firefox&&(this.editor.hotkeys.add("cmd+left",function(_this){return function(e){return e.preventDefault(),_this.editor.selection._selection.modify("move","backward","lineboundary"),!1}}(this)),this.editor.hotkeys.add("cmd+right",function(_this){return function(e){return e.preventDefault(),_this.editor.selection._selection.modify("move","forward","lineboundary"),!1}}(this)),selectAllKey=this.editor.util.os.mac?"cmd+a":"ctrl+a",this.editor.hotkeys.add(selectAllKey,function(_this){return function(e){var $children,firstBlock,lastBlock,range;return $children=_this.editor.body.children(),$children.length>0?(firstBlock=$children.first().get(0),lastBlock=$children.last().get(0),range=document.createRange(),range.setStart(firstBlock,0),range.setEnd(lastBlock,_this.editor.util.getNodeLength(lastBlock)),_this.editor.selection.range(range),!1):void 0}}(this))),submitKey=this.editor.util.os.mac?"cmd+enter":"ctrl+enter",this.editor.hotkeys.add(submitKey,function(_this){return function(e){return _this.editor.sync(),_this.editor.el.closest("form").find("button:submit").click(),!1}}(this))},InputManager.prototype._onFocus=function(e){return this.editor.clipboard.pasting?void 0:(this.editor.el.addClass("focus").removeClass("error"),this.focused=!0,setTimeout(function(_this){return function(){var $blockEl,range;return range=_this.editor.selection._selection.getRangeAt(0),range.startContainer===_this.editor.body[0]&&(_this.lastCaretPosition?_this.editor.undoManager.caretPosition(_this.lastCaretPosition):($blockEl=_this.editor.body.children().first(),range=document.createRange(),_this.editor.selection.setRangeAtStartOf($blockEl,range))),_this.lastCaretPosition=null,_this.editor.triggerHandler("focus"),_this.editor.util.support.onselectionchange?void 0:_this.throttledSelectionChanged()}}(this),0))},InputManager.prototype._onBlur=function(e){var ref;if(!this.editor.clipboard.pasting)return this.editor.el.removeClass("focus"),this.editor.sync(),this.focused=!1,this.lastCaretPosition=null!=(ref=this.editor.undoManager.currentState())?ref.caret:void 0,this.editor.triggerHandler("blur")},InputManager.prototype._onMouseUp=function(e){return this.editor.util.support.onselectionchange?void 0:this.throttledSelectionChanged();
},InputManager.prototype._onKeyDown=function(e){var ref,ref1;if(this.editor.triggerHandler(e)===!1)return!1;if(!this.editor.hotkeys.respondTo(e)){if(this.editor.keystroke.respondTo(e))return this.throttledValueChanged(),!1;if(ref=e.which,!(indexOf.call(this._modifierKeys,ref)>=0||(ref1=e.which,indexOf.call(this._arrowKeys,ref1)>=0)||this.editor.util.metaKey(e)&&86===e.which))return this.editor.util.support.oninput||this.throttledValueChanged(["typing"]),null}},InputManager.prototype._onKeyPress=function(e){return this.editor.triggerHandler(e)===!1?!1:void 0},InputManager.prototype._onKeyUp=function(e){var p,ref;return this.editor.triggerHandler(e)===!1?!1:!this.editor.util.support.onselectionchange&&(ref=e.which,indexOf.call(this._arrowKeys,ref)>=0)?void this.throttledValueChanged():void(8!==e.which&&46!==e.which||!this.editor.util.isEmptyNode(this.editor.body)||(this.editor.body.empty(),p=$("<p/>").append(this.editor.util.phBr).appendTo(this.editor.body),this.editor.selection.setRangeAtStartOf(p)))},InputManager.prototype._onDrop=function(e){return this.editor.triggerHandler(e)===!1?!1:this.throttledValueChanged()},InputManager.prototype._onInput=function(e){return this.throttledValueChanged(["oninput"])},InputManager}(SimpleModule),Keystroke=function(superClass){function Keystroke(){return Keystroke.__super__.constructor.apply(this,arguments)}return extend(Keystroke,superClass),Keystroke.pluginName="Keystroke",Keystroke.prototype._init=function(){return this.editor=this._module,this._keystrokeHandlers={},this._initKeystrokeHandlers()},Keystroke.prototype.add=function(key,node,handler){return key=key.toLowerCase(),key=this.editor.hotkeys.constructor.aliases[key]||key,this._keystrokeHandlers[key]||(this._keystrokeHandlers[key]={}),this._keystrokeHandlers[key][node]=handler},Keystroke.prototype.respondTo=function(e){var base,key,ref,result;return(key=null!=(ref=this.editor.hotkeys.constructor.keyNameMap[e.which])?ref.toLowerCase():void 0)&&key in this._keystrokeHandlers&&(result="function"==typeof(base=this._keystrokeHandlers[key])["*"]?base["*"](e):void 0,result||this.editor.selection.startNodes().each(function(_this){return function(i,node){var handler,ref1;if(node.nodeType===Node.ELEMENT_NODE)return handler=null!=(ref1=_this._keystrokeHandlers[key])?ref1[node.tagName.toLowerCase()]:void 0,result="function"==typeof handler?handler(e,$(node)):void 0,result===!0||result===!1?!1:void 0}}(this)),result)?!0:void 0},Keystroke.prototype._initKeystrokeHandlers=function(){var titleEnterHandler;return this.editor.util.browser.safari&&this.add("enter","*",function(_this){return function(e){var $blockEl,$br;if(e.shiftKey&&($blockEl=_this.editor.selection.blockNodes().last(),!$blockEl.is("pre")))return $br=$("<br/>"),_this.editor.selection.rangeAtEndOf($blockEl)?(_this.editor.selection.insertNode($br),_this.editor.selection.insertNode($("<br/>")),_this.editor.selection.setRangeBefore($br)):_this.editor.selection.insertNode($br),!0}}(this)),(this.editor.util.browser.webkit||this.editor.util.browser.msie)&&(titleEnterHandler=function(_this){return function(e,$node){var $p;if(_this.editor.selection.rangeAtEndOf($node))return $p=$("<p/>").append(_this.editor.util.phBr).insertAfter($node),_this.editor.selection.setRangeAtStartOf($p),!0}}(this),this.add("enter","h1",titleEnterHandler),this.add("enter","h2",titleEnterHandler),this.add("enter","h3",titleEnterHandler),this.add("enter","h4",titleEnterHandler),this.add("enter","h5",titleEnterHandler),this.add("enter","h6",titleEnterHandler)),this.add("backspace","*",function(_this){return function(e){var $blockEl,$prevBlockEl,$rootBlock,isWebkit;return $rootBlock=_this.editor.selection.rootNodes().first(),$prevBlockEl=$rootBlock.prev(),$prevBlockEl.is("hr")&&_this.editor.selection.rangeAtStartOf($rootBlock)?(_this.editor.selection.save(),$prevBlockEl.remove(),_this.editor.selection.restore(),!0):($blockEl=_this.editor.selection.blockNodes().last(),$blockEl.is(".simditor-resize-handle")&&$rootBlock.is(".simditor-table")&&(e.preventDefault(),$rootBlock.remove(),_this.editor.selection.setRangeAtEndOf($prevBlockEl)),$prevBlockEl.is(".simditor-table")&&!$blockEl.is("table")&&_this.editor.util.isEmptyNode($blockEl)&&(e.preventDefault(),$blockEl.remove(),_this.editor.selection.setRangeAtEndOf($prevBlockEl)),isWebkit=_this.editor.util.browser.webkit,isWebkit&&_this.editor.selection.rangeAtStartOf($blockEl)?(_this.editor.selection.save(),_this.editor.formatter.cleanNode($blockEl,!0),_this.editor.selection.restore(),null):void 0)}}(this)),this.add("enter","div",function(_this){return function(e,$node){var $blockEl,$p;return $node.is(".simditor-table")&&($blockEl=_this.editor.selection.blockNodes().last(),$blockEl.is(".simditor-resize-handle"))?(e.preventDefault(),$p=$("<p/>").append(_this.editor.util.phBr).insertAfter($node),_this.editor.selection.setRangeAtStartOf($p)):void 0}}(this)),this.add("enter","li",function(_this){return function(e,$node){var $cloneNode,listEl,newBlockEl,newListEl;if($cloneNode=$node.clone(),$cloneNode.find("ul, ol").remove(),_this.editor.util.isEmptyNode($cloneNode)&&$node.is(_this.editor.selection.blockNodes().last())){if(listEl=$node.parent(),$node.next("li").length>0){if(!_this.editor.util.isEmptyNode($node))return;listEl.parent("li").length>0?(newBlockEl=$("<li/>").append(_this.editor.util.phBr).insertAfter(listEl.parent("li")),newListEl=$("<"+listEl[0].tagName+"/>").append($node.nextAll("li")),newBlockEl.append(newListEl)):(newBlockEl=$("<p/>").append(_this.editor.util.phBr).insertAfter(listEl),newListEl=$("<"+listEl[0].tagName+"/>").append($node.nextAll("li")),newBlockEl.after(newListEl))}else listEl.parent("li").length>0?(newBlockEl=$("<li/>").insertAfter(listEl.parent("li")),$node.contents().length>0?newBlockEl.append($node.contents()):newBlockEl.append(_this.editor.util.phBr)):(newBlockEl=$("<p/>").append(_this.editor.util.phBr).insertAfter(listEl),$node.children("ul, ol").length>0&&newBlockEl.after($node.children("ul, ol")));return $node.prev("li").length?$node.remove():$node.prev("ul").length||$node.prev("ol").length?$node.remove():listEl.remove(),_this.editor.selection.setRangeAtStartOf(newBlockEl),!0}}}(this)),this.add("enter","pre",function(_this){return function(e,$node){var $p,breakNode,range;return e.preventDefault(),e.shiftKey?($p=$("<p/>").append(_this.editor.util.phBr).insertAfter($node),_this.editor.selection.setRangeAtStartOf($p),!0):(range=_this.editor.selection.range(),breakNode=null,range.deleteContents(),breakNode=!_this.editor.util.browser.msie&&_this.editor.selection.rangeAtEndOf($node)?document.createTextNode("\n\n"):document.createTextNode("\n"),range.insertNode(breakNode),range.setEnd(breakNode,1),range.collapse(!1),_this.editor.selection.range(range),!0)}}(this)),this.add("enter","blockquote",function(_this){return function(e,$node){var $closestBlock,range;return $closestBlock=_this.editor.selection.blockNodes().last(),$closestBlock.is("p")&&!$closestBlock.next().length&&_this.editor.util.isEmptyNode($closestBlock)?($node.after($closestBlock),range=document.createRange(),_this.editor.selection.setRangeAtStartOf($closestBlock,range),!0):void 0}}(this)),this.add("backspace","li",function(_this){return function(e,$node){var $br,$childList,$newLi,$prevChildList,$prevNode,$textNode,isFF,range,text;return $childList=$node.children("ul, ol"),$prevNode=$node.prev("li"),$childList.length>0&&$prevNode.length>0?(text="",$textNode=null,$node.contents().each(function(i,n){if(1===n.nodeType&&/UL|OL/.test(n.nodeName))return!1;if(1!==n.nodeType||!/BR/.test(n.nodeName))return 3===n.nodeType&&n.nodeValue?text+=n.nodeValue:1===n.nodeType&&(text+=$(n).text()),$textNode=$(n)}),isFF=_this.editor.util.browser.firefox&&!$textNode.next("br").length,$textNode&&1===text.length&&isFF?($br=$(_this.editor.util.phBr).insertAfter($textNode),$textNode.remove(),_this.editor.selection.setRangeBefore($br),!0):text.length>0?!1:(range=document.createRange(),$prevChildList=$prevNode.children("ul, ol"),$prevChildList.length>0?($newLi=$("<li/>").append(_this.editor.util.phBr).appendTo($prevChildList),$prevChildList.append($childList.children("li")),$node.remove(),_this.editor.selection.setRangeAtEndOf($newLi,range)):(_this.editor.selection.setRangeAtEndOf($prevNode,range),$prevNode.append($childList),$node.remove(),_this.editor.selection.range(range)),!0)):!1}}(this)),this.add("backspace","pre",function(_this){return function(e,$node){var $newNode,codeStr,range;if(_this.editor.selection.rangeAtStartOf($node))return codeStr=$node.html().replace("\n","<br/>")||_this.editor.util.phBr,$newNode=$("<p/>").append(codeStr).insertAfter($node),$node.remove(),range=document.createRange(),_this.editor.selection.setRangeAtStartOf($newNode,range),!0}}(this)),this.add("backspace","blockquote",function(_this){return function(e,$node){var $firstChild,range;if(_this.editor.selection.rangeAtStartOf($node))return $firstChild=$node.children().first().unwrap(),range=document.createRange(),_this.editor.selection.setRangeAtStartOf($firstChild,range),!0}}(this))},Keystroke}(SimpleModule),UndoManager=function(superClass){function UndoManager(){return UndoManager.__super__.constructor.apply(this,arguments)}return extend(UndoManager,superClass),UndoManager.pluginName="UndoManager",UndoManager.prototype._index=-1,UndoManager.prototype._capacity=20,UndoManager.prototype._startPosition=null,UndoManager.prototype._endPosition=null,UndoManager.prototype._init=function(){var redoShortcut,undoShortcut;return this.editor=this._module,this._stack=[],this.editor.util.os.mac?(undoShortcut="cmd+z",redoShortcut="shift+cmd+z"):this.editor.util.os.win?(undoShortcut="ctrl+z",redoShortcut="ctrl+y"):(undoShortcut="ctrl+z",redoShortcut="shift+ctrl+z"),this.editor.hotkeys.add(undoShortcut,function(_this){return function(e){return e.preventDefault(),_this.undo(),!1}}(this)),this.editor.hotkeys.add(redoShortcut,function(_this){return function(e){return e.preventDefault(),_this.redo(),!1}}(this)),this.throttledPushState=this.editor.util.throttle(function(_this){return function(){return _this._pushUndoState()}}(this),2e3),this.editor.on("valuechanged",function(_this){return function(e,src){return"undo"!==src&&"redo"!==src?_this.throttledPushState():void 0}}(this)),this.editor.on("selectionchanged",function(_this){return function(e){return _this.resetCaretPosition(),_this.update()}}(this)),this.editor.on("focus",function(_this){return function(e){return 0===_this._stack.length?_this._pushUndoState():void 0}}(this)),this.editor.on("blur",function(_this){return function(e){return _this.resetCaretPosition()}}(this))},UndoManager.prototype.resetCaretPosition=function(){return this._startPosition=null,this._endPosition=null},UndoManager.prototype.startPosition=function(){return this.editor.selection._range&&(this._startPosition||(this._startPosition=this._getPosition("start"))),this._startPosition},UndoManager.prototype.endPosition=function(){return this.editor.selection._range&&(this._endPosition||(this._endPosition=function(_this){return function(){var range;return range=_this.editor.selection.range(),range.collapsed?_this._startPosition:_this._getPosition("end")}}(this)())),this._endPosition},UndoManager.prototype._pushUndoState=function(){var caret;if(this.editor.triggerHandler("pushundostate")!==!1&&(caret=this.caretPosition(),caret.start))return this._index+=1,this._stack.length=this._index,this._stack.push({html:this.editor.body.html(),caret:this.caretPosition()}),this._stack.length>this._capacity?(this._stack.shift(),this._index-=1):void 0},UndoManager.prototype.currentState=function(){return this._stack.length&&this._index>-1?this._stack[this._index]:null},UndoManager.prototype.undo=function(){var state;if(!(this._index<1||this._stack.length<2))return this.editor.hidePopover(),this._index-=1,state=this._stack[this._index],this.editor.body.get(0).innerHTML=state.html,this.caretPosition(state.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["undo"])},UndoManager.prototype.redo=function(){var state;if(!(this._index<0||this._stack.length<this._index+2))return this.editor.hidePopover(),this._index+=1,state=this._stack[this._index],this.editor.body.get(0).innerHTML=state.html,this.caretPosition(state.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["redo"])},UndoManager.prototype.update=function(){var currentState;return(currentState=this.currentState())?(currentState.html=this.editor.body.html(),currentState.caret=this.caretPosition()):void 0},UndoManager.prototype._getNodeOffset=function(node,index){var $parent,merging,offset;return $parent=$.isNumeric(index)?$(node):$(node).parent(),offset=0,merging=!1,$parent.contents().each(function(i,child){return node===child||index===i&&0===i?!1:(child.nodeType===Node.TEXT_NODE?!merging&&child.nodeValue.length>0&&(offset+=1,merging=!0):(offset+=1,merging=!1),index-1===i?!1:null)}),offset},UndoManager.prototype._getPosition=function(type){var $nodes,node,nodes,offset,position,prevNode,range;if(null==type&&(type="start"),range=this.editor.selection.range(),offset=range[type+"Offset"],$nodes=this.editor.selection[type+"Nodes"](),node=$nodes.first()[0],node.nodeType===Node.TEXT_NODE){for(prevNode=node.previousSibling;prevNode&&prevNode.nodeType===Node.TEXT_NODE;)node=prevNode,offset+=this.editor.util.getNodeLength(prevNode),prevNode=prevNode.previousSibling;nodes=$nodes.get(),nodes[0]=node,$nodes=$(nodes)}else offset=this._getNodeOffset(node,offset);return position=[offset],$nodes.each(function(_this){return function(i,node){return position.unshift(_this._getNodeOffset(node))}}(this)),position},UndoManager.prototype._getNodeByPosition=function(position){var child,childNodes,i,k,len,node,offset,ref;for(node=this.editor.body[0],ref=position.slice(0,position.length-1),i=k=0,len=ref.length;len>k;i=++k){if(offset=ref[i],childNodes=node.childNodes,offset>childNodes.length-1){if(i!==position.length-2||!$(node).is(":empty")){node=null;break}child=document.createTextNode(""),node.appendChild(child),childNodes=node.childNodes}node=childNodes[offset]}return node},UndoManager.prototype.caretPosition=function(caret){var endContainer,endOffset,range,startContainer,startOffset;if(caret){if(!caret.start)return;return startContainer=this._getNodeByPosition(caret.start),startOffset=caret.start[caret.start.length-1],caret.collapsed?(endContainer=startContainer,endOffset=startOffset):(endContainer=this._getNodeByPosition(caret.end),endOffset=caret.start[caret.start.length-1]),startContainer&&endContainer?(range=document.createRange(),range.setStart(startContainer,startOffset),range.setEnd(endContainer,endOffset),this.editor.selection.range(range)):void("undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("simditor: invalid caret state"))}return range=this.editor.selection.range(),caret=this.editor.inputManager.focused&&null!=range?{start:this.startPosition(),end:this.endPosition(),collapsed:range.collapsed}:{}},UndoManager}(SimpleModule),Util=function(superClass){function Util(){return Util.__super__.constructor.apply(this,arguments)}return extend(Util,superClass),Util.pluginName="Util",Util.prototype._init=function(){return this.editor=this._module,this.browser.msie&&this.browser.version<11?this.phBr="":void 0},Util.prototype.phBr="<br/>",Util.prototype.os=function(){var os;return os={},/Mac/.test(navigator.appVersion)?os.mac=!0:/Linux/.test(navigator.appVersion)?os.linux=!0:/Win/.test(navigator.appVersion)?os.win=!0:/X11/.test(navigator.appVersion)&&(os.unix=!0),/Mobi/.test(navigator.appVersion)&&(os.mobile=!0),os}(),Util.prototype.browser=function(){var chrome,edge,firefox,ie,ref,ref1,ref2,ref3,ref4,safari,ua;return ua=navigator.userAgent,ie=/(msie|trident)/i.test(ua),chrome=/chrome|crios/i.test(ua),safari=/safari/i.test(ua)&&!chrome,firefox=/firefox/i.test(ua),edge=/edge/i.test(ua),ie?{msie:!0,version:1*(null!=(ref=ua.match(/(msie |rv:)(\d+(\.\d+)?)/i))?ref[2]:void 0)}:edge?{edge:!0,webkit:!0,version:1*(null!=(ref1=ua.match(/edge\/(\d+(\.\d+)?)/i))?ref1[1]:void 0)}:chrome?{webkit:!0,chrome:!0,version:1*(null!=(ref2=ua.match(/(?:chrome|crios)\/(\d+(\.\d+)?)/i))?ref2[1]:void 0)}:safari?{webkit:!0,safari:!0,version:1*(null!=(ref3=ua.match(/version\/(\d+(\.\d+)?)/i))?ref3[1]:void 0)}:firefox?{mozilla:!0,firefox:!0,version:1*(null!=(ref4=ua.match(/firefox\/(\d+(\.\d+)?)/i))?ref4[1]:void 0)}:{}}(),Util.prototype.support=function(){return{onselectionchange:function(){var e,onselectionchange;if(onselectionchange=document.onselectionchange,void 0!==onselectionchange)try{return document.onselectionchange=0,null===document.onselectionchange}catch(_error){e=_error}finally{document.onselectionchange=onselectionchange}return!1}(),oninput:function(){return!/(msie|trident)/i.test(navigator.userAgent)}()}}(),Util.prototype.reflow=function(el){return null==el&&(el=document),$(el)[0].offsetHeight},Util.prototype.metaKey=function(e){var isMac;return isMac=/Mac/.test(navigator.userAgent),isMac?e.metaKey:e.ctrlKey},Util.prototype.isEmptyNode=function(node){var $node;return $node=$(node),$node.is(":empty")||!$node.text()&&!$node.find(":not(br, span, div)").length},Util.prototype.isDecoratedNode=function(node){return $(node).is('[class^="simditor-"]')},Util.prototype.blockNodes=["div","p","ul","ol","li","blockquote","hr","pre","h1","h2","h3","h4","h5","table"],Util.prototype.isBlockNode=function(node){return node=$(node)[0],node&&3!==node.nodeType?new RegExp("^("+this.blockNodes.join("|")+")$").test(node.nodeName.toLowerCase()):!1},Util.prototype.getNodeLength=function(node){switch(node=$(node)[0],node.nodeType){case 7:case 10:return 0;case 3:case 8:return node.length;default:return node.childNodes.length}},Util.prototype.dataURLtoBlob=function(dataURL){var BlobBuilder,arrayBuffer,bb,blobArray,byteString,hasArrayBufferViewSupport,hasBlobConstructor,i,intArray,k,mimeString,ref,supportBlob;if(hasBlobConstructor=window.Blob&&function(){var e;try{return Boolean(new Blob)}catch(_error){return e=_error,!1}}(),hasArrayBufferViewSupport=hasBlobConstructor&&window.Uint8Array&&function(){var e;try{return 100===new Blob([new Uint8Array(100)]).size}catch(_error){return e=_error,!1}}(),BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,supportBlob=hasBlobConstructor||BlobBuilder,!(supportBlob&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return!1;for(byteString=dataURL.split(",")[0].indexOf("base64")>=0?atob(dataURL.split(",")[1]):decodeURIComponent(dataURL.split(",")[1]),arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),i=k=0,ref=byteString.length;ref>=0?ref>=k:k>=ref;i=ref>=0?++k:--k)intArray[i]=byteString.charCodeAt(i);return mimeString=dataURL.split(",")[0].split(":")[1].split(";")[0],hasBlobConstructor?(blobArray=hasArrayBufferViewSupport?intArray:arrayBuffer,new Blob([blobArray],{type:mimeString})):(bb=new BlobBuilder,bb.append(arrayBuffer),bb.getBlob(mimeString))},Util.prototype.throttle=function(func,wait){var args,call,ctx,last,rtn,throttled,timeoutID;return last=0,timeoutID=0,ctx=args=rtn=null,call=function(){return timeoutID=0,last=+new Date,rtn=func.apply(ctx,args),ctx=null,args=null},throttled=function(){var delta;return ctx=this,args=arguments,delta=new Date-last,timeoutID||(delta>=wait?call():timeoutID=setTimeout(call,wait-delta)),rtn},throttled.clear=function(){return timeoutID?(clearTimeout(timeoutID),call()):void 0},throttled},Util.prototype.formatHTML=function(html){var cursor,indentString,lastMatch,level,match,re,repeatString,result,str;for(re=/<(\/?)(.+?)(\/?)>/g,result="",level=0,lastMatch=null,indentString="  ",repeatString=function(str,n){return new Array(n+1).join(str)};null!==(match=re.exec(html));)match.isBlockNode=$.inArray(match[2],this.blockNodes)>-1,match.isStartTag="/"!==match[1]&&"/"!==match[3],match.isEndTag="/"===match[1]||"/"===match[3],cursor=lastMatch?lastMatch.index+lastMatch[0].length:0,(str=html.substring(cursor,match.index)).length>0&&$.trim(str)&&(result+=str),match.isBlockNode&&match.isEndTag&&!match.isStartTag&&(level-=1),match.isBlockNode&&match.isStartTag&&(lastMatch&&lastMatch.isBlockNode&&lastMatch.isEndTag||(result+="\n"),result+=repeatString(indentString,level)),result+=match[0],match.isBlockNode&&match.isEndTag&&(result+="\n"),match.isBlockNode&&match.isStartTag&&(level+=1),lastMatch=match;return $.trim(result)},Util}(SimpleModule),Toolbar=function(superClass){function Toolbar(){return Toolbar.__super__.constructor.apply(this,arguments)}return extend(Toolbar,superClass),Toolbar.pluginName="Toolbar",Toolbar.prototype.opts={toolbar:!0,toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0},Toolbar.prototype._tpl={wrapper:'<div class="simditor-toolbar"><ul></ul></div>',separator:'<li><span class="separator"></span></li>'},Toolbar.prototype._init=function(){var floatInitialized,initToolbarFloat,toolbarHeight;return this.editor=this._module,this.opts.toolbar?($.isArray(this.opts.toolbar)||(this.opts.toolbar=["bold","italic","underline","strikethrough","|","ol","ul","blockquote","code","|","link","image","|","indent","outdent"]),this._render(),this.list.on("click",function(e){return!1}),this.wrapper.on("mousedown",function(_this){return function(e){return _this.list.find(".menu-on").removeClass(".menu-on")}}(this)),$(document).on("mousedown.simditor"+this.editor.id,function(_this){return function(e){return _this.list.find(".menu-on").removeClass(".menu-on")}}(this)),!this.opts.toolbarHidden&&this.opts.toolbarFloat&&(this.wrapper.css("top",this.opts.toolbarFloatOffset),toolbarHeight=0,initToolbarFloat=function(_this){return function(){return _this.wrapper.css("position","static"),_this.wrapper.width("auto"),_this.editor.util.reflow(_this.wrapper),_this.wrapper.width(_this.wrapper.outerWidth()),_this.wrapper.css("left",_this.editor.util.os.mobile?_this.wrapper.position().left:_this.wrapper.offset().left),_this.wrapper.css("position",""),toolbarHeight=_this.wrapper.outerHeight(),_this.editor.placeholderEl.css("top",toolbarHeight),!0}}(this),floatInitialized=null,$(window).on("resize.simditor-"+this.editor.id,function(e){return floatInitialized=initToolbarFloat()}),$(window).on("scroll.simditor-"+this.editor.id,function(_this){return function(e){var bottomEdge,scrollTop,topEdge;if(_this.wrapper.is(":visible"))if(topEdge=_this.editor.wrapper.offset().top,bottomEdge=topEdge+_this.editor.wrapper.outerHeight()-80,scrollTop=$(document).scrollTop()+_this.opts.toolbarFloatOffset,topEdge>=scrollTop||scrollTop>=bottomEdge){if(_this.editor.wrapper.removeClass("toolbar-floating").css("padding-top",""),_this.editor.util.os.mobile)return _this.wrapper.css("top",_this.opts.toolbarFloatOffset)}else if(floatInitialized||(floatInitialized=initToolbarFloat()),_this.editor.wrapper.addClass("toolbar-floating").css("padding-top",toolbarHeight),_this.editor.util.os.mobile)return _this.wrapper.css("top",scrollTop-topEdge+_this.opts.toolbarFloatOffset)}}(this))),this.editor.on("destroy",function(_this){return function(){return _this.buttons.length=0}}(this)),$(document).on("mousedown.simditor-"+this.editor.id,function(_this){return function(e){return _this.list.find("li.menu-on").removeClass("menu-on")}}(this))):void 0},Toolbar.prototype._render=function(){var k,len,name,ref;for(this.buttons=[],this.wrapper=$(this._tpl.wrapper).prependTo(this.editor.wrapper),this.list=this.wrapper.find("ul"),ref=this.opts.toolbar,k=0,len=ref.length;len>k;k++)if(name=ref[k],"|"!==name){if(!this.constructor.buttons[name])throw new Error("simditor: invalid toolbar button "+name);this.buttons.push(new this.constructor.buttons[name]({editor:this.editor}))}else $(this._tpl.separator).appendTo(this.list);return this.opts.toolbarHidden?this.wrapper.hide():void 0},Toolbar.prototype.findButton=function(name){var button;return button=this.list.find(".toolbar-item-"+name).data("button"),null!=button?button:null},Toolbar.addButton=function(btn){return this.buttons[btn.prototype.name]=btn},Toolbar.buttons={},Toolbar}(SimpleModule),Indentation=function(superClass){function Indentation(){return Indentation.__super__.constructor.apply(this,arguments)}return extend(Indentation,superClass),Indentation.pluginName="Indentation",Indentation.prototype.opts={tabIndent:!0},Indentation.prototype._init=function(){return this.editor=this._module,this.editor.keystroke.add("tab","*",function(_this){return function(e){var codeButton;return codeButton=_this.editor.toolbar.findButton("code"),_this.opts.tabIndent||codeButton&&codeButton.active?_this.indent(e.shiftKey):void 0}}(this))},Indentation.prototype.indent=function(isBackward){var $blockNodes,$endNodes,$startNodes,nodes,result;return $startNodes=this.editor.selection.startNodes(),$endNodes=this.editor.selection.endNodes(),$blockNodes=this.editor.selection.blockNodes(),nodes=[],$blockNodes=$blockNodes.each(function(i,node){var include,j,k,len,n;for(include=!0,j=k=0,len=nodes.length;len>k;j=++k){if(n=nodes[j],$.contains(node,n)){include=!1;break}if($.contains(n,node)){nodes.splice(j,1,node),include=!1;break}}return include?nodes.push(node):void 0}),$blockNodes=$(nodes),result=!1,$blockNodes.each(function(_this){return function(i,blockEl){var r;return r=isBackward?_this.outdentBlock(blockEl):_this.indentBlock(blockEl),r?result=r:void 0}}(this)),result},Indentation.prototype.indentBlock=function(blockEl){var $blockEl,$childList,$nextTd,$nextTr,$parentLi,$pre,$td,$tr,marginLeft,tagName;if($blockEl=$(blockEl),$blockEl.length){if($blockEl.is("pre")){if($pre=this.editor.selection.containerNode(),!$pre.is($blockEl)&&!$pre.closest("pre").is($blockEl))return;this.indentText(this.editor.selection.range())}else if($blockEl.is("li")){if($parentLi=$blockEl.prev("li"),$parentLi.length<1)return;this.editor.selection.save(),tagName=$blockEl.parent()[0].tagName,$childList=$parentLi.children("ul, ol"),$childList.length>0?$childList.append($blockEl):$("<"+tagName+"/>").append($blockEl).appendTo($parentLi),this.editor.selection.restore()}else if($blockEl.is("p, h1, h2, h3, h4"))marginLeft=parseInt($blockEl.css("margin-left"))||0,marginLeft=(Math.round(marginLeft/this.opts.indentWidth)+1)*this.opts.indentWidth,$blockEl.css("margin-left",marginLeft);else{if(!$blockEl.is("table")&&!$blockEl.is(".simditor-table"))return!1;if($td=this.editor.selection.containerNode().closest("td, th"),$nextTd=$td.next("td, th"),$nextTd.length>0||($tr=$td.parent("tr"),$nextTr=$tr.next("tr"),$nextTr.length<1&&$tr.parent().is("thead")&&($nextTr=$tr.parent("thead").next("tbody").find("tr:first")),$nextTd=$nextTr.find("td:first, th:first")),!($td.length>0&&$nextTd.length>0))return;this.editor.selection.setRangeAtEndOf($nextTd)}return!0}},Indentation.prototype.indentText=function(range){var text,textNode;return text=range.toString().replace(/^(?=.+)/gm,"Â Â "),textNode=document.createTextNode(text||"Â Â "),range.deleteContents(),range.insertNode(textNode),text?(range.selectNode(textNode),this.editor.selection.range(range)):this.editor.selection.setRangeAfter(textNode)},Indentation.prototype.outdentBlock=function(blockEl){var $blockEl,$parent,$parentLi,$pre,$prevTd,$prevTr,$td,$tr,marginLeft,range;if($blockEl=$(blockEl),$blockEl&&$blockEl.length>0){if($blockEl.is("pre")){if($pre=this.editor.selection.containerNode(),!$pre.is($blockEl)&&!$pre.closest("pre").is($blockEl))return;this.outdentText(range)}else if($blockEl.is("li"))$parent=$blockEl.parent(),$parentLi=$parent.parent("li"),this.editor.selection.save(),$parentLi.length<1?(range=document.createRange(),range.setStartBefore($parent[0]),range.setEndBefore($blockEl[0]),$parent.before(range.extractContents()),$("<p/>").insertBefore($parent).after($blockEl.children("ul, ol")).append($blockEl.contents()),$blockEl.remove()):($blockEl.next("li").length>0&&$("<"+$parent[0].tagName+"/>").append($blockEl.nextAll("li")).appendTo($blockEl),$blockEl.insertAfter($parentLi),$parent.children("li").length<1&&$parent.remove()),this.editor.selection.restore();else if($blockEl.is("p, h1, h2, h3, h4"))marginLeft=parseInt($blockEl.css("margin-left"))||0,marginLeft=Math.max(Math.round(marginLeft/this.opts.indentWidth)-1,0)*this.opts.indentWidth,$blockEl.css("margin-left",0===marginLeft?"":marginLeft);else{if(!$blockEl.is("table")&&!$blockEl.is(".simditor-table"))return!1;if($td=this.editor.selection.containerNode().closest("td, th"),$prevTd=$td.prev("td, th"),$prevTd.length>0||($tr=$td.parent("tr"),$prevTr=$tr.prev("tr"),$prevTr.length<1&&$tr.parent().is("tbody")&&($prevTr=$tr.parent("tbody").prev("thead").find("tr:first")),$prevTd=$prevTr.find("td:last, th:last")),!($td.length>0&&$prevTd.length>0))return;this.editor.selection.setRangeAtEndOf($prevTd)}return!0}},Indentation.prototype.outdentText=function(range){},Indentation}(SimpleModule),Clipboard=function(superClass){function Clipboard(){return Clipboard.__super__.constructor.apply(this,arguments)}return extend(Clipboard,superClass),Clipboard.pluginName="Clipboard",Clipboard.prototype.opts={pasteImage:!1,cleanPaste:!1},Clipboard.prototype._init=function(){return this.editor=this._module,this.opts.pasteImage&&"string"!=typeof this.opts.pasteImage&&(this.opts.pasteImage="inline"),this.editor.body.on("paste",function(_this){return function(e){var range;if(!_this.pasting&&!_this._pasteBin)return _this.editor.triggerHandler(e)===!1?!1:(range=_this.editor.selection.deleteRangeContents(),_this.editor.body.html()?range.collapsed||range.collapse(!0):(_this.editor.formatter.format(),_this.editor.selection.setRangeAtStartOf(_this.editor.body.find("p:first"))),_this._processPasteByClipboardApi(e)?!1:(_this.editor.inputManager.throttledValueChanged.clear(),_this.editor.inputManager.throttledSelectionChanged.clear(),_this.editor.undoManager.throttledPushState.clear(),_this.editor.selection.reset(),_this.editor.undoManager.resetCaretPosition(),_this.pasting=!0,_this._getPasteContent(function(pasteContent){return _this._processPasteContent(pasteContent),_this._pasteInBlockEl=null,_this._pastePlainText=null,_this.pasting=!1})))}}(this))},Clipboard.prototype._processPasteByClipboardApi=function(e){var imageFile,pasteItem,ref,uploadOpt;if(!this.editor.util.browser.edge&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items&&e.originalEvent.clipboardData.items.length>0&&(pasteItem=e.originalEvent.clipboardData.items[0],/^image\//.test(pasteItem.type))){if(imageFile=pasteItem.getAsFile(),null==imageFile||!this.opts.pasteImage)return;if(imageFile.name||(imageFile.name="Clipboard Image.png"),this.editor.triggerHandler("pasting",[imageFile])===!1)return;return uploadOpt={},uploadOpt[this.opts.pasteImage]=!0,null!=(ref=this.editor.uploader)&&ref.upload(imageFile,uploadOpt),!0}},Clipboard.prototype._getPasteContent=function(callback){var state;return this._pasteBin=$('<div contenteditable="true" />').addClass("simditor-paste-bin").attr("tabIndex","-1").appendTo(this.editor.el),state={html:this.editor.body.html(),caret:this.editor.undoManager.caretPosition()},this._pasteBin.focus(),setTimeout(function(_this){return function(){var pasteContent;return _this.editor.hidePopover(),_this.editor.body.get(0).innerHTML=state.html,_this.editor.undoManager.caretPosition(state.caret),_this.editor.body.focus(),_this.editor.selection.reset(),_this.editor.selection.range(),_this._pasteInBlockEl=_this.editor.selection.blockNodes().last(),_this._pastePlainText=_this.opts.cleanPaste||_this._pasteInBlockEl.is("pre, table"),_this._pastePlainText?pasteContent=_this.editor.formatter.clearHtml(_this._pasteBin.html(),!0):(pasteContent=$("<div/>").append(_this._pasteBin.contents()),pasteContent.find("style").remove(),pasteContent.find("table colgroup").remove(),_this._cleanPasteFontSize(pasteContent),_this.editor.formatter.format(pasteContent),_this.editor.formatter.decorate(pasteContent),_this.editor.formatter.beautify(pasteContent.children()),pasteContent=pasteContent.contents()),_this._pasteBin.remove(),_this._pasteBin=null,
callback(pasteContent)}}(this),0)},Clipboard.prototype._processPasteContent=function(pasteContent){var $blockEl,$img,blob,children,dataURLtoBlob,img,insertPosition,k,l,lastLine,len,len1,len2,len3,len4,line,lines,m,node,o,q,ref,ref1,ref2,uploadOpt,uploader;if(this.editor.triggerHandler("pasting",[pasteContent])!==!1&&($blockEl=this._pasteInBlockEl,pasteContent)){if(this._pastePlainText)if($blockEl.is("table")){for(lines=pasteContent.split("\n"),lastLine=lines.pop(),k=0,len=lines.length;len>k;k++)line=lines[k],this.editor.selection.insertNode(document.createTextNode(line)),this.editor.selection.insertNode($("<br/>"));this.editor.selection.insertNode(document.createTextNode(lastLine))}else for(pasteContent=$("<div/>").text(pasteContent),ref=pasteContent.contents(),l=0,len1=ref.length;len1>l;l++)node=ref[l],this.editor.selection.insertNode($(node)[0]);else if($blockEl.is(this.editor.body))for(m=0,len2=pasteContent.length;len2>m;m++)node=pasteContent[m],this.editor.selection.insertNode(node);else{if(pasteContent.length<1)return;if(1===pasteContent.length)if(pasteContent.is("p")){if(children=pasteContent.contents(),$blockEl.is("h1, h2, h3, h4, h5")&&children.length&&children.css("font-size",""),1===children.length&&children.is("img")){if($img=children,/^data:image/.test($img.attr("src"))){if(!this.opts.pasteImage)return;return blob=this.editor.util.dataURLtoBlob($img.attr("src")),blob.name="Clipboard Image.png",uploadOpt={},uploadOpt[this.opts.pasteImage]=!0,void(null!=(ref1=this.editor.uploader)&&ref1.upload(blob,uploadOpt))}if(new RegExp("^blob:"+location.origin+"/").test($img.attr("src"))){if(!this.opts.pasteImage)return;return uploadOpt={},uploadOpt[this.opts.pasteImage]=!0,dataURLtoBlob=this.editor.util.dataURLtoBlob,uploader=this.editor.uploader,img=new Image,img.onload=function(){var canvas;canvas=document.createElement("canvas"),canvas.width=img.naturalWidth,canvas.height=img.naturalHeight,canvas.getContext("2d").drawImage(img,0,0),blob=dataURLtoBlob(canvas.toDataURL("image/png")),blob.name="Clipboard Image.png",null!==uploader&&uploader.upload(blob,uploadOpt)},void(img.src=$img.attr("src"))}if($img.is('img[src^="webkit-fake-url://"]'))return}for(o=0,len3=children.length;len3>o;o++)node=children[o],this.editor.selection.insertNode(node)}else if($blockEl.is("p")&&this.editor.util.isEmptyNode($blockEl))$blockEl.replaceWith(pasteContent),this.editor.selection.setRangeAtEndOf(pasteContent);else if(pasteContent.is("ul, ol"))if(1===pasteContent.find("li").length)for(pasteContent=$("<div/>").text(pasteContent.text()),ref2=pasteContent.contents(),q=0,len4=ref2.length;len4>q;q++)node=ref2[q],this.editor.selection.insertNode($(node)[0]);else $blockEl.is("li")?($blockEl.parent().after(pasteContent),this.editor.selection.setRangeAtEndOf(pasteContent)):($blockEl.after(pasteContent),this.editor.selection.setRangeAtEndOf(pasteContent));else $blockEl.after(pasteContent),this.editor.selection.setRangeAtEndOf(pasteContent);else $blockEl.is("li")&&($blockEl=$blockEl.parent()),this.editor.selection.rangeAtStartOf($blockEl)?insertPosition="before":this.editor.selection.rangeAtEndOf($blockEl)?insertPosition="after":(this.editor.selection.breakBlockEl($blockEl),insertPosition="before"),$blockEl[insertPosition](pasteContent),this.editor.selection.setRangeAtEndOf(pasteContent.last())}return this.editor.inputManager.throttledValueChanged()}},Clipboard.prototype._cleanPasteFontSize=function(node){var $node,sizeMap;return $node=$(node),$node.length>0?(sizeMap=["1.5em","1.25em","0.75em","0.5em"],$node.find('[style*="font-size"]').map(function(i,el){var $el;return $el=$(el),$.inArray($el.css("font-size"),sizeMap)<0?$el.css("font-size",""):void 0})):void 0},Clipboard}(SimpleModule),Simditor=function(superClass){function Simditor(){return Simditor.__super__.constructor.apply(this,arguments)}return extend(Simditor,superClass),Simditor.connect(Util),Simditor.connect(InputManager),Simditor.connect(Selection),Simditor.connect(UndoManager),Simditor.connect(Keystroke),Simditor.connect(Formatter),Simditor.connect(Toolbar),Simditor.connect(Indentation),Simditor.connect(Clipboard),Simditor.count=0,Simditor.prototype.opts={textarea:null,placeholder:"",defaultImage:"images/image.png",params:{},upload:!1,indentWidth:40},Simditor.prototype._init=function(){var e,editor,uploadOpts;if(this.textarea=$(this.opts.textarea),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder"),!this.textarea.length)throw new Error("simditor: param textarea is required.");if(editor=this.textarea.data("simditor"),null!=editor&&editor.destroy(),this.id=++Simditor.count,this._render(),!simpleHotkeys)throw new Error("simditor: simple-hotkeys is required.");if(this.hotkeys=simpleHotkeys({el:this.body}),this.opts.upload&&simpleUploader&&(uploadOpts="object"==typeof this.opts.upload?this.opts.upload:{},this.uploader=simpleUploader(uploadOpts)),this.on("initialized",function(_this){return function(){return _this.opts.placeholder&&_this.on("valuechanged",function(){return _this._placeholder()}),_this.setValue(_this.textarea.val().trim()||""),_this.textarea.attr("autofocus")?_this.focus():void 0}}(this)),this.util.browser.mozilla){this.util.reflow();try{return document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(_error){e=_error}}},Simditor.prototype._tpl='<div class="simditor">\n  <div class="simditor-wrapper">\n    <div class="simditor-placeholder"></div>\n    <div class="simditor-body" contenteditable="true">\n    </div>\n  </div>\n</div>',Simditor.prototype._render=function(){var key,ref,results,val;if(this.el=$(this._tpl).insertBefore(this.textarea),this.wrapper=this.el.find(".simditor-wrapper"),this.body=this.wrapper.find(".simditor-body"),this.placeholderEl=this.wrapper.find(".simditor-placeholder").append(this.opts.placeholder),this.el.data("simditor",this),this.wrapper.append(this.textarea),this.textarea.data("simditor",this).blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.util.os.mac?this.el.addClass("simditor-mac"):this.util.os.linux&&this.el.addClass("simditor-linux"),this.util.os.mobile&&this.el.addClass("simditor-mobile"),this.opts.params){ref=this.opts.params,results=[];for(key in ref)val=ref[key],results.push($("<input/>",{type:"hidden",name:key,value:val}).insertAfter(this.textarea));return results}},Simditor.prototype._placeholder=function(){var children;return children=this.body.children(),0===children.length||1===children.length&&this.util.isEmptyNode(children)&&parseInt(children.css("margin-left")||0)<this.opts.indentWidth?this.placeholderEl.show():this.placeholderEl.hide()},Simditor.prototype.setValue=function(val){return this.hidePopover(),this.textarea.val(val),this.body.get(0).innerHTML=val,this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null,this.trigger("valuechanged")},Simditor.prototype.getValue=function(){return this.sync()},Simditor.prototype.sync=function(){var children,cloneBody,emptyP,firstP,lastP,val;for(cloneBody=this.body.clone(),this.formatter.undecorate(cloneBody),this.formatter.format(cloneBody),this.formatter.autolink(cloneBody),children=cloneBody.children(),lastP=children.last("p"),firstP=children.first("p");lastP.is("p")&&this.util.isEmptyNode(lastP);)emptyP=lastP,lastP=lastP.prev("p"),emptyP.remove();for(;firstP.is("p")&&this.util.isEmptyNode(firstP);)emptyP=firstP,firstP=lastP.next("p"),emptyP.remove();return cloneBody.find("img.uploading").remove(),val=$.trim(cloneBody.html()),this.textarea.val(val),val},Simditor.prototype.focus=function(){var $blockEl,range;return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.inputManager.lastCaretPosition?(this.undoManager.caretPosition(this.inputManager.lastCaretPosition),this.inputManager.lastCaretPosition=null):($blockEl=this.body.children().last(),$blockEl.is("p")||($blockEl=$("<p/>").append(this.util.phBr).appendTo(this.body)),range=document.createRange(),this.selection.setRangeAtEndOf($blockEl,range)):void this.el.find("textarea:visible").focus()},Simditor.prototype.blur=function(){return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.body.blur():this.body.find("textarea:visible").blur()},Simditor.prototype.hidePopover=function(){return this.el.find(".simditor-popover").each(function(i,popover){return popover=$(popover).data("popover"),popover.active?popover.hide():void 0})},Simditor.prototype.destroy=function(){return this.triggerHandler("destroy"),this.textarea.closest("form").off(".simditor .simditor-"+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val("").removeData("simditor"),this.el.remove(),$(document).off(".simditor-"+this.id),$(window).off(".simditor-"+this.id),this.off()},Simditor}(SimpleModule),Simditor.i18n={"zh-CN":{blockquote:"å¼ç¨",bold:"å ç²æå­",code:"æå¥ä»£ç ",color:"æå­é¢è²",coloredText:"å½©è²æå­",hr:"åéçº¿",image:"æå¥å¾ç",externalImage:"å¤é¾å¾ç",uploadImage:"ä¸ä¼ å¾ç",uploadFailed:"ä¸ä¼ å¤±è´¥äº",uploadError:"ä¸ä¼ åºéäº",imageUrl:"å¾çå°å",imageSize:"å¾çå°ºå¯¸",imageAlt:"å¾çæè¿°",restoreImageSize:"è¿åå¾çå°ºå¯¸",uploading:"æ­£å¨ä¸ä¼ ",indent:"åå³ç¼©è¿",outdent:"åå·¦ç¼©è¿",italic:"æä½æå­",link:"æå¥é¾æ¥",linkText:"é¾æ¥æå­",linkUrl:"é¾æ¥å°å",linkTarget:"æå¼æ¹å¼",openLinkInCurrentWindow:"å¨å½åçªå£ä¸­æå¼",openLinkInNewWindow:"å¨æ°çªå£ä¸­æå¼",removeLink:"ç§»é¤é¾æ¥",ol:"æåºåè¡¨",ul:"æ åºåè¡¨",strikethrough:"å é¤çº¿æå­",table:"è¡¨æ ¼",deleteRow:"å é¤è¡",insertRowAbove:"å¨ä¸é¢æå¥è¡",insertRowBelow:"å¨ä¸é¢æå¥è¡",deleteColumn:"å é¤å",insertColumnLeft:"å¨å·¦è¾¹æå¥å",insertColumnRight:"å¨å³è¾¹æå¥å",deleteTable:"å é¤è¡¨æ ¼",title:"æ é¢",normalText:"æ®éææ¬",underline:"ä¸åçº¿æå­",alignment:"æ°´å¹³å¯¹é½",alignCenter:"å±ä¸­",alignLeft:"å±å·¦",alignRight:"å±å³",selectLanguage:"éæ©ç¨åºè¯­è¨",fontScale:"å­ä½å¤§å°",fontScaleXLarge:"è¶å¤§å­ä½",fontScaleLarge:"å¤§å·å­ä½",fontScaleNormal:"æ­£å¸¸å¤§å°",fontScaleSmall:"å°å·å­ä½",fontScaleXSmall:"è¶å°å­ä½"},"en-US":{blockquote:"Block Quote",bold:"Bold",code:"Code",color:"Text Color",coloredText:"Colored Text",hr:"Horizontal Line",image:"Insert Image",externalImage:"External Image",uploadImage:"Upload Image",uploadFailed:"Upload failed",uploadError:"Error occurs during upload",imageUrl:"Url",imageSize:"Size",imageAlt:"Alt",restoreImageSize:"Restore Origin Size",uploading:"Uploading",indent:"Indent",outdent:"Outdent",italic:"Italic",link:"Insert Link",linkText:"Text",linkUrl:"Url",linkTarget:"Target",openLinkInCurrentWindow:"Open link in current window",openLinkInNewWindow:"Open link in new window",removeLink:"Remove Link",ol:"Ordered List",ul:"Unordered List",strikethrough:"Strikethrough",table:"Table",deleteRow:"Delete Row",insertRowAbove:"Insert Row Above",insertRowBelow:"Insert Row Below",deleteColumn:"Delete Column",insertColumnLeft:"Insert Column Left",insertColumnRight:"Insert Column Right",deleteTable:"Delete Table",title:"Title",normalText:"Text",underline:"Underline",alignment:"Alignment",alignCenter:"Align Center",alignLeft:"Align Left",alignRight:"Align Right",selectLanguage:"Select Language",fontScale:"Font Size",fontScaleXLarge:"X Large Size",fontScaleLarge:"Large Size",fontScaleNormal:"Normal Size",fontScaleSmall:"Small Size",fontScaleXSmall:"X Small Size"}},Button=function(superClass){function Button(opts){this.editor=opts.editor,this.title=this._t(this.name),Button.__super__.constructor.call(this,opts)}return extend(Button,superClass),Button.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},Button.prototype.name="",Button.prototype.icon="",Button.prototype.title="",Button.prototype.text="",Button.prototype.htmlTag="",Button.prototype.disableTag="",Button.prototype.menu=!1,Button.prototype.active=!1,Button.prototype.disabled=!1,Button.prototype.needFocus=!0,Button.prototype.shortcut=null,Button.prototype._init=function(){var k,len,ref,tag;for(this.render(),this.el.on("mousedown",function(_this){return function(e){var exceed,noFocus,param;return e.preventDefault(),noFocus=_this.needFocus&&!_this.editor.inputManager.focused,_this.el.hasClass("disabled")?!1:(noFocus&&_this.editor.focus(),_this.menu?(_this.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),_this.wrapper.is(".menu-on")&&(exceed=_this.menuWrapper.offset().left+_this.menuWrapper.outerWidth()+5-_this.editor.wrapper.offset().left-_this.editor.wrapper.outerWidth(),exceed>0&&_this.menuWrapper.css({left:"auto",right:0}),_this.trigger("menuexpand")),!1):(param=_this.el.data("param"),_this.command(param),!1))}}(this)),this.wrapper.on("click","a.menu-item",function(_this){return function(e){var btn,noFocus,param;return e.preventDefault(),btn=$(e.currentTarget),_this.wrapper.removeClass("menu-on"),noFocus=_this.needFocus&&!_this.editor.inputManager.focused,btn.hasClass("disabled")||noFocus?!1:(_this.editor.toolbar.wrapper.removeClass("menu-on"),param=btn.data("param"),_this.command(param),!1)}}(this)),this.wrapper.on("mousedown","a.menu-item",function(e){return!1}),this.editor.on("blur",function(_this){return function(){var editorActive;return editorActive=_this.editor.body.is(":visible")&&_this.editor.body.is("[contenteditable]"),editorActive&&!_this.editor.clipboard.pasting?(_this.setActive(!1),_this.setDisabled(!1)):void 0}}(this)),null!=this.shortcut&&this.editor.hotkeys.add(this.shortcut,function(_this){return function(e){return _this.el.mousedown(),!1}}(this)),ref=this.htmlTag.split(","),k=0,len=ref.length;len>k;k++)tag=ref[k],tag=$.trim(tag),tag&&$.inArray(tag,this.editor.formatter._allowedTags)<0&&this.editor.formatter._allowedTags.push(tag);return this.editor.on("selectionchanged",function(_this){return function(e){return _this.editor.inputManager.focused?_this._status():void 0}}(this))},Button.prototype.iconClassOf=function(icon){return icon?"simditor-icon simditor-icon-"+icon:""},Button.prototype.setIcon=function(icon){return this.el.find("span").removeClass().addClass(this.iconClassOf(icon)).text(this.text)},Button.prototype.render=function(){return this.wrapper=$(this._tpl.item).appendTo(this.editor.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.setIcon(this.icon),this.menu?(this.menuWrapper=$(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()):void 0},Button.prototype.renderMenu=function(){var $menuBtnEl,$menuItemEl,k,len,menuItem,ref,ref1,results;if($.isArray(this.menu)){for(this.menuEl=$("<ul/>").appendTo(this.menuWrapper),ref=this.menu,results=[],k=0,len=ref.length;len>k;k++)menuItem=ref[k],"|"!==menuItem?($menuItemEl=$(this._tpl.menuItem).appendTo(this.menuEl),$menuBtnEl=$menuItemEl.find("a.menu-item").attr({title:null!=(ref1=menuItem.title)?ref1:menuItem.text,"data-param":menuItem.param}).addClass("menu-item-"+menuItem.name),menuItem.icon?results.push($menuBtnEl.find("span").addClass(this.iconClassOf(menuItem.icon))):results.push($menuBtnEl.find("span").text(menuItem.text))):$(this._tpl.separator).appendTo(this.menuEl);return results}},Button.prototype.setActive=function(active){return active!==this.active?(this.active=active,this.el.toggleClass("active",this.active)):void 0},Button.prototype.setDisabled=function(disabled){return disabled!==this.disabled?(this.disabled=disabled,this.el.toggleClass("disabled",this.disabled)):void 0},Button.prototype._disableStatus=function(){var disabled,endNodes,startNodes;return startNodes=this.editor.selection.startNodes(),endNodes=this.editor.selection.endNodes(),disabled=startNodes.filter(this.disableTag).length>0||endNodes.filter(this.disableTag).length>0,this.setDisabled(disabled),this.disabled&&this.setActive(!1),this.disabled},Button.prototype._activeStatus=function(){var active,endNode,endNodes,startNode,startNodes;return startNodes=this.editor.selection.startNodes(),endNodes=this.editor.selection.endNodes(),startNode=startNodes.filter(this.htmlTag),endNode=endNodes.filter(this.htmlTag),active=startNode.length>0&&endNode.length>0&&startNode.is(endNode),this.node=active?startNode:null,this.setActive(active),this.active},Button.prototype._status=function(){return this._disableStatus(),this.disabled?void 0:this._activeStatus()},Button.prototype.command=function(param){},Button.prototype._t=function(){var args,ref,result;return args=1<=arguments.length?slice.call(arguments,0):[],result=Button.__super__._t.apply(this,args),result||(result=(ref=this.editor)._t.apply(ref,args)),result},Button}(SimpleModule),Simditor.Button=Button,Popover=function(superClass){function Popover(opts){this.button=opts.button,this.editor=opts.button.editor,Popover.__super__.constructor.call(this,opts)}return extend(Popover,superClass),Popover.prototype.offset={top:4,left:0},Popover.prototype.target=null,Popover.prototype.active=!1,Popover.prototype._init=function(){return this.el=$('<div class="simditor-popover"></div>').appendTo(this.editor.el).data("popover",this),this.render(),this.el.on("mouseenter",function(_this){return function(e){return _this.el.addClass("hover")}}(this)),this.el.on("mouseleave",function(_this){return function(e){return _this.el.removeClass("hover")}}(this))},Popover.prototype.render=function(){},Popover.prototype._initLabelWidth=function(){var $fields;return $fields=this.el.find(".settings-field"),$fields.length>0?(this._labelWidth=0,$fields.each(function(_this){return function(i,field){var $field,$label;return $field=$(field),$label=$field.find("label"),$label.length>0?_this._labelWidth=Math.max(_this._labelWidth,$label.width()):void 0}}(this)),$fields.find("label").width(this._labelWidth)):void 0},Popover.prototype.show=function($target,position){return null==position&&(position="bottom"),null!=$target?(this.el.siblings(".simditor-popover").each(function(i,popover){return popover=$(popover).data("popover"),popover.active?popover.hide():void 0}),this.active&&this.target&&this.target.removeClass("selected"),this.target=$target.addClass("selected"),this.active?(this.refresh(position),this.trigger("popovershow")):(this.active=!0,this.el.css({left:-9999}).show(),this._labelWidth||this._initLabelWidth(),this.editor.util.reflow(),this.refresh(position),this.trigger("popovershow"))):void 0},Popover.prototype.hide=function(){return this.active?(this.target&&this.target.removeClass("selected"),this.target=null,this.active=!1,this.el.hide(),this.trigger("popoverhide")):void 0},Popover.prototype.refresh=function(position){var editorOffset,left,maxLeft,targetH,targetOffset,top;return null==position&&(position="bottom"),this.active?(editorOffset=this.editor.el.offset(),targetOffset=this.target.offset(),targetH=this.target.outerHeight(),"bottom"===position?top=targetOffset.top-editorOffset.top+targetH:"top"===position&&(top=targetOffset.top-editorOffset.top-this.el.height()),maxLeft=this.editor.wrapper.width()-this.el.outerWidth()-10,left=Math.min(targetOffset.left-editorOffset.left,maxLeft),this.el.css({top:top+this.offset.top,left:left+this.offset.left})):void 0},Popover.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off(".linkpopover"),this.el.remove()},Popover.prototype._t=function(){var args,ref,result;return args=1<=arguments.length?slice.call(arguments,0):[],result=Popover.__super__._t.apply(this,args),result||(result=(ref=this.button)._t.apply(ref,args)),result},Popover}(SimpleModule),Simditor.Popover=Popover,TitleButton=function(superClass){function TitleButton(){return TitleButton.__super__.constructor.apply(this,arguments)}return extend(TitleButton,superClass),TitleButton.prototype.name="title",TitleButton.prototype.htmlTag="h1, h2, h3, h4, h5",TitleButton.prototype.disableTag="pre, table",TitleButton.prototype._init=function(){return this.menu=[{name:"normal",text:this._t("normalText"),param:"p"},"|",{name:"h1",text:this._t("title")+" 1",param:"h1"},{name:"h2",text:this._t("title")+" 2",param:"h2"},{name:"h3",text:this._t("title")+" 3",param:"h3"},{name:"h4",text:this._t("title")+" 4",param:"h4"},{name:"h5",text:this._t("title")+" 5",param:"h5"}],TitleButton.__super__._init.call(this)},TitleButton.prototype.setActive=function(active,param){return TitleButton.__super__.setActive.call(this,active),active&&(param||(param=this.node[0].tagName.toLowerCase())),this.el.removeClass("active-p active-h1 active-h2 active-h3 active-h4 active-h5"),active?this.el.addClass("active active-"+param):void 0},TitleButton.prototype.command=function(param){var $rootNodes;return $rootNodes=this.editor.selection.rootNodes(),this.editor.selection.save(),$rootNodes.each(function(_this){return function(i,node){var $node;return $node=$(node),$node.is("blockquote")||$node.is(param)||$node.is(_this.disableTag)||_this.editor.util.isDecoratedNode($node)?void 0:$("<"+param+"/>").append($node.contents()).replaceAll($node)}}(this)),this.editor.selection.restore(),this.editor.trigger("valuechanged")},TitleButton}(Button),Simditor.Toolbar.addButton(TitleButton),FontScaleButton=function(superClass){function FontScaleButton(){return FontScaleButton.__super__.constructor.apply(this,arguments)}return extend(FontScaleButton,superClass),FontScaleButton.prototype.name="fontScale",FontScaleButton.prototype.icon="font",FontScaleButton.prototype.htmlTag="span",FontScaleButton.prototype.disableTag="pre, h1, h2, h3, h4, h5",FontScaleButton.prototype.sizeMap={"x-large":"1.5em",large:"1.25em",small:".75em","x-small":".5em"},FontScaleButton.prototype._init=function(){return this.menu=[{name:"150%",text:this._t("fontScaleXLarge"),param:"5"},{name:"125%",text:this._t("fontScaleLarge"),param:"4"},{name:"100%",text:this._t("fontScaleNormal"),param:"3"},{name:"75%",text:this._t("fontScaleSmall"),param:"2"},{name:"50%",text:this._t("fontScaleXSmall"),param:"1"}],FontScaleButton.__super__._init.call(this)},FontScaleButton.prototype._activeStatus=function(){var active,endNode,endNodes,range,startNode,startNodes;return range=this.editor.selection.range(),startNodes=this.editor.selection.startNodes(),endNodes=this.editor.selection.endNodes(),startNode=startNodes.filter('span[style*="font-size"]'),endNode=endNodes.filter('span[style*="font-size"]'),active=startNodes.length>0&&endNodes.length>0&&startNode.is(endNode),this.setActive(active),this.active},FontScaleButton.prototype.command=function(param){var $scales,containerNode,range;return range=this.editor.selection.range(),range.collapsed?void 0:(this.editor.selection.range(range),document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,param),document.execCommand("styleWithCSS",!1,!1),this.editor.selection.reset(),this.editor.selection.range(),containerNode=this.editor.selection.containerNode(),$scales=containerNode[0].nodeType===Node.TEXT_NODE?containerNode.closest('span[style*="font-size"]'):containerNode.find('span[style*="font-size"]'),$scales.each(function(_this){return function(i,n){var $span,size;return $span=$(n),size=n.style.fontSize,/large|x-large|small|x-small/.test(size)?$span.css("fontSize",_this.sizeMap[size]):"medium"===size?$span[0].style.length>1?$span.css("fontSize",""):$span.replaceWith($span.contents()):void 0}}(this)),this.editor.trigger("valuechanged"))},FontScaleButton}(Button),Simditor.Toolbar.addButton(FontScaleButton),BoldButton=function(superClass){function BoldButton(){return BoldButton.__super__.constructor.apply(this,arguments)}return extend(BoldButton,superClass),BoldButton.prototype.name="bold",BoldButton.prototype.icon="bold",BoldButton.prototype.htmlTag="b, strong",BoldButton.prototype.disableTag="pre",BoldButton.prototype.shortcut="cmd+b",BoldButton.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + b )":(this.title=this.title+" ( Ctrl + b )",this.shortcut="ctrl+b"),BoldButton.__super__._init.call(this)},BoldButton.prototype._activeStatus=function(){var active;return active=document.queryCommandState("bold")===!0,this.setActive(active),this.active},BoldButton.prototype.command=function(){return document.execCommand("bold"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),$(document).trigger("selectionchange")},BoldButton}(Button),Simditor.Toolbar.addButton(BoldButton),ItalicButton=function(superClass){function ItalicButton(){return ItalicButton.__super__.constructor.apply(this,arguments)}return extend(ItalicButton,superClass),ItalicButton.prototype.name="italic",ItalicButton.prototype.icon="italic",ItalicButton.prototype.htmlTag="i",ItalicButton.prototype.disableTag="pre",ItalicButton.prototype.shortcut="cmd+i",ItalicButton.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + i )":(this.title=this.title+" ( Ctrl + i )",this.shortcut="ctrl+i"),ItalicButton.__super__._init.call(this)},ItalicButton.prototype._activeStatus=function(){var active;return active=document.queryCommandState("italic")===!0,this.setActive(active),this.active},ItalicButton.prototype.command=function(){return document.execCommand("italic"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),$(document).trigger("selectionchange")},ItalicButton}(Button),Simditor.Toolbar.addButton(ItalicButton),UnderlineButton=function(superClass){function UnderlineButton(){return UnderlineButton.__super__.constructor.apply(this,arguments)}return extend(UnderlineButton,superClass),UnderlineButton.prototype.name="underline",UnderlineButton.prototype.icon="underline",UnderlineButton.prototype.htmlTag="u",UnderlineButton.prototype.disableTag="pre",UnderlineButton.prototype.shortcut="cmd+u",UnderlineButton.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + u )":(this.title=this.title+" ( Ctrl + u )",this.shortcut="ctrl+u"),UnderlineButton.__super__.render.call(this)},UnderlineButton.prototype._activeStatus=function(){var active;return active=document.queryCommandState("underline")===!0,this.setActive(active),this.active},UnderlineButton.prototype.command=function(){return document.execCommand("underline"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),$(document).trigger("selectionchange")},UnderlineButton}(Button),Simditor.Toolbar.addButton(UnderlineButton),ColorButton=function(superClass){function ColorButton(){return ColorButton.__super__.constructor.apply(this,arguments)}return extend(ColorButton,superClass),ColorButton.prototype.name="color",ColorButton.prototype.icon="tint",ColorButton.prototype.disableTag="pre",ColorButton.prototype.menu=!0,ColorButton.prototype.render=function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],ColorButton.__super__.render.apply(this,args)},ColorButton.prototype.renderMenu=function(){return $('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-default"></a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on("mousedown",".color-list",function(e){return!1}),this.menuWrapper.on("click",".font-color",function(_this){return function(e){var $link,$p,hex,range,rgb,textNode;if(_this.wrapper.removeClass("menu-on"),$link=$(e.currentTarget),$link.hasClass("font-color-default")){if($p=_this.editor.body.find("p, li"),!($p.length>0))return;rgb=window.getComputedStyle($p[0],null).getPropertyValue("color"),hex=_this._convertRgbToHex(rgb)}else rgb=window.getComputedStyle($link[0],null).getPropertyValue("background-color"),hex=_this._convertRgbToHex(rgb);return hex?(range=_this.editor.selection.range(),!$link.hasClass("font-color-default")&&range.collapsed&&(textNode=document.createTextNode(_this._t("coloredText")),range.insertNode(textNode),range.selectNodeContents(textNode)),_this.editor.selection.range(range),document.execCommand("styleWithCSS",!1,!0),document.execCommand("foreColor",!1,hex),document.execCommand("styleWithCSS",!1,!1),_this.editor.util.support.oninput?void 0:_this.editor.trigger("valuechanged")):void 0}}(this))},ColorButton.prototype._convertRgbToHex=function(rgb){var match,re,rgbToHex;return re=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g,(match=re.exec(rgb))?(rgbToHex=function(r,g,b){var componentToHex;return componentToHex=function(c){var hex;return hex=c.toString(16),1===hex.length?"0"+hex:hex},"#"+componentToHex(r)+componentToHex(g)+componentToHex(b)})(1*match[1],1*match[2],1*match[3]):""},ColorButton}(Button),Simditor.Toolbar.addButton(ColorButton),ListButton=function(superClass){function ListButton(){return ListButton.__super__.constructor.apply(this,arguments)}return extend(ListButton,superClass),ListButton.prototype.type="",ListButton.prototype.disableTag="pre, table",ListButton.prototype.command=function(param){var $list,$rootNodes,anotherType;return $rootNodes=this.editor.selection.blockNodes(),anotherType="ul"===this.type?"ol":"ul",this.editor.selection.save(),$list=null,$rootNodes.each(function(_this){return function(i,node){var $node;return $node=$(node),$node.is("blockquote, li")||$node.is(_this.disableTag)||_this.editor.util.isDecoratedNode($node)||!$.contains(document,node)?void 0:$node.is(_this.type)?($node.children("li").each(function(i,li){var $childList,$li;return $li=$(li),$childList=$li.children("ul, ol").insertAfter($node),$("<p/>").append($(li).html()||_this.editor.util.phBr).insertBefore($node)}),$node.remove()):$node.is(anotherType)?$("<"+_this.type+"/>").append($node.contents()).replaceAll($node):$list&&$node.prev().is($list)?($("<li/>").append($node.html()||_this.editor.util.phBr).appendTo($list),$node.remove()):($list=$("<"+_this.type+"><li></li></"+_this.type+">"),$list.find("li").append($node.html()||_this.editor.util.phBr),$list.replaceAll($node))}}(this)),this.editor.selection.restore(),this.editor.trigger("valuechanged")},ListButton}(Button),OrderListButton=function(superClass){function OrderListButton(){return OrderListButton.__super__.constructor.apply(this,arguments)}return extend(OrderListButton,superClass),OrderListButton.prototype.type="ol",OrderListButton.prototype.name="ol",OrderListButton.prototype.icon="list-ol",OrderListButton.prototype.htmlTag="ol",OrderListButton.prototype.shortcut="cmd+/",OrderListButton.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + / )":(this.title=this.title+" ( ctrl + / )",this.shortcut="ctrl+/"),OrderListButton.__super__._init.call(this)},OrderListButton}(ListButton),UnorderListButton=function(superClass){function UnorderListButton(){return UnorderListButton.__super__.constructor.apply(this,arguments)}return extend(UnorderListButton,superClass),UnorderListButton.prototype.type="ul",UnorderListButton.prototype.name="ul",UnorderListButton.prototype.icon="list-ul",UnorderListButton.prototype.htmlTag="ul",UnorderListButton.prototype.shortcut="cmd+.",UnorderListButton.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + . )":(this.title=this.title+" ( Ctrl + . )",this.shortcut="ctrl+."),UnorderListButton.__super__._init.call(this)},UnorderListButton}(ListButton),Simditor.Toolbar.addButton(OrderListButton),Simditor.Toolbar.addButton(UnorderListButton),BlockquoteButton=function(superClass){function BlockquoteButton(){return BlockquoteButton.__super__.constructor.apply(this,arguments)}return extend(BlockquoteButton,superClass),BlockquoteButton.prototype.name="blockquote",BlockquoteButton.prototype.icon="quote-left",BlockquoteButton.prototype.htmlTag="blockquote",BlockquoteButton.prototype.disableTag="pre, table",BlockquoteButton.prototype.command=function(){var $rootNodes,clearCache,nodeCache;
return $rootNodes=this.editor.selection.rootNodes(),$rootNodes=$rootNodes.filter(function(i,node){return!$(node).parent().is("blockquote")}),this.editor.selection.save(),nodeCache=[],clearCache=function(_this){return function(){return nodeCache.length>0?($("<"+_this.htmlTag+"/>").insertBefore(nodeCache[0]).append(nodeCache),nodeCache.length=0):void 0}}(this),$rootNodes.each(function(_this){return function(i,node){var $node;return $node=$(node),$node.parent().is(_this.editor.body)?$node.is(_this.htmlTag)?(clearCache(),$node.children().unwrap()):$node.is(_this.disableTag)||_this.editor.util.isDecoratedNode($node)?clearCache():nodeCache.push(node):void 0}}(this)),clearCache(),this.editor.selection.restore(),this.editor.trigger("valuechanged")},BlockquoteButton}(Button),Simditor.Toolbar.addButton(BlockquoteButton),CodeButton=function(superClass){function CodeButton(){return CodeButton.__super__.constructor.apply(this,arguments)}return extend(CodeButton,superClass),CodeButton.prototype.name="code",CodeButton.prototype.icon="code",CodeButton.prototype.htmlTag="pre",CodeButton.prototype.disableTag="ul, ol, table",CodeButton.prototype._init=function(){return CodeButton.__super__._init.call(this),this.editor.on("decorate",function(_this){return function(e,$el){return $el.find("pre").each(function(i,pre){return _this.decorate($(pre))})}}(this)),this.editor.on("undecorate",function(_this){return function(e,$el){return $el.find("pre").each(function(i,pre){return _this.undecorate($(pre))})}}(this))},CodeButton.prototype.render=function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],CodeButton.__super__.render.apply(this,args),this.popover=new CodePopover({button:this})},CodeButton.prototype._checkMode=function(){var $blockNodes,range;return range=this.editor.selection.range(),($blockNodes=$(range.cloneContents()).find(this.editor.util.blockNodes.join(",")))>0||range.collapsed&&0===this.editor.selection.startNodes().filter("code").length?(this.inlineMode=!1,this.htmlTag="pre"):(this.inlineMode=!0,this.htmlTag="code")},CodeButton.prototype._status=function(){return this._checkMode(),CodeButton.__super__._status.call(this),this.inlineMode?void 0:this.active?this.popover.show(this.node):this.popover.hide()},CodeButton.prototype.decorate=function($pre){var $code,lang,ref,ref1;return $code=$pre.find("> code"),$code.length>0&&(lang=null!=(ref=$code.attr("class"))&&null!=(ref1=ref.match(/lang-(\S+)/))?ref1[1]:void 0,$code.contents().unwrap(),lang)?$pre.attr("data-lang",lang):void 0},CodeButton.prototype.undecorate=function($pre){var $code,lang;return lang=$pre.attr("data-lang"),$code=$("<code/>"),lang&&-1!==lang&&$code.addClass("lang-"+lang),$pre.wrapInner($code).removeAttr("data-lang")},CodeButton.prototype.command=function(){return this.inlineMode?this._inlineCommand():this._blockCommand()},CodeButton.prototype._blockCommand=function(){var $rootNodes,clearCache,nodeCache,resultNodes;return $rootNodes=this.editor.selection.rootNodes(),nodeCache=[],resultNodes=[],clearCache=function(_this){return function(){var $pre;if(nodeCache.length>0)return $pre=$("<"+_this.htmlTag+"/>").insertBefore(nodeCache[0]).text(_this.editor.formatter.clearHtml(nodeCache)),resultNodes.push($pre[0]),nodeCache.length=0}}(this),$rootNodes.each(function(_this){return function(i,node){var $node,$p;return $node=$(node),$node.is(_this.htmlTag)?(clearCache(),$p=$("<p/>").append($node.html().replace("\n","<br/>")).replaceAll($node),resultNodes.push($p[0])):$node.is(_this.disableTag)||_this.editor.util.isDecoratedNode($node)||$node.is("blockquote")?clearCache():nodeCache.push(node)}}(this)),clearCache(),this.editor.selection.setRangeAtEndOf($(resultNodes).last()),this.editor.trigger("valuechanged")},CodeButton.prototype._inlineCommand=function(){var $code,$contents,range;return range=this.editor.selection.range(),this.active?(range.selectNodeContents(this.node[0]),this.editor.selection.save(range),this.node.contents().unwrap(),this.editor.selection.restore()):($contents=$(range.extractContents()),$code=$("<"+this.htmlTag+"/>").append($contents.contents()),range.insertNode($code[0]),range.selectNodeContents($code[0]),this.editor.selection.range(range)),this.editor.trigger("valuechanged")},CodeButton}(Button),CodePopover=function(superClass){function CodePopover(){return CodePopover.__super__.constructor.apply(this,arguments)}return extend(CodePopover,superClass),CodePopover.prototype.render=function(){var $option,k,lang,len,ref;for(this._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">'+this._t("selectLanguage")+"</option>\n    </select>\n  </div>\n</div>",this.langs=this.editor.opts.codeLanguages||[{name:"Bash",value:"bash"},{name:"C++",value:"c++"},{name:"C#",value:"cs"},{name:"CSS",value:"css"},{name:"Erlang",value:"erlang"},{name:"Less",value:"less"},{name:"Sass",value:"sass"},{name:"Diff",value:"diff"},{name:"CoffeeScript",value:"coffeescript"},{name:"HTML,XML",value:"html"},{name:"JSON",value:"json"},{name:"Java",value:"java"},{name:"JavaScript",value:"js"},{name:"Markdown",value:"markdown"},{name:"Objective C",value:"oc"},{name:"PHP",value:"php"},{name:"Perl",value:"parl"},{name:"Python",value:"python"},{name:"Ruby",value:"ruby"},{name:"SQL",value:"sql"}],this.el.addClass("code-popover").append(this._tpl),this.selectEl=this.el.find(".select-lang"),ref=this.langs,k=0,len=ref.length;len>k;k++)lang=ref[k],$option=$("<option/>",{text:lang.name,value:lang.value}).appendTo(this.selectEl);return this.selectEl.on("change",function(_this){return function(e){var selected;return _this.lang=_this.selectEl.val(),selected=_this.target.hasClass("selected"),_this.target.removeClass().removeAttr("data-lang"),-1!==_this.lang&&_this.target.attr("data-lang",_this.lang),selected&&_this.target.addClass("selected"),_this.editor.trigger("valuechanged")}}(this)),this.editor.on("valuechanged",function(_this){return function(e){return _this.active?_this.refresh():void 0}}(this))},CodePopover.prototype.show=function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],CodePopover.__super__.show.apply(this,args),this.lang=this.target.attr("data-lang"),null!=this.lang?this.selectEl.val(this.lang):this.selectEl.val(-1)},CodePopover}(Popover),Simditor.Toolbar.addButton(CodeButton),LinkButton=function(superClass){function LinkButton(){return LinkButton.__super__.constructor.apply(this,arguments)}return extend(LinkButton,superClass),LinkButton.prototype.name="link",LinkButton.prototype.icon="link",LinkButton.prototype.htmlTag="a",LinkButton.prototype.disableTag="pre",LinkButton.prototype.render=function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],LinkButton.__super__.render.apply(this,args),this.popover=new LinkPopover({button:this})},LinkButton.prototype._status=function(){return LinkButton.__super__._status.call(this),this.active&&!this.editor.selection.rangeAtEndOf(this.node)?this.popover.show(this.node):this.popover.hide()},LinkButton.prototype.command=function(){var $contents,$link,$newBlock,linkText,range,txtNode;return range=this.editor.selection.range(),this.active?(txtNode=document.createTextNode(this.node.text()),this.node.replaceWith(txtNode),range.selectNode(txtNode)):($contents=$(range.extractContents()),linkText=this.editor.formatter.clearHtml($contents.contents(),!1),$link=$("<a/>",{href:"",target:"_blank",text:linkText||this._t("linkText")}),this.editor.selection.blockNodes().length>0?range.insertNode($link[0]):($newBlock=$("<p/>").append($link),range.insertNode($newBlock[0])),range.selectNodeContents($link[0]),this.popover.one("popovershow",function(_this){return function(){return linkText?(_this.popover.urlEl.focus(),_this.popover.urlEl[0].select()):(_this.popover.textEl.focus(),_this.popover.textEl[0].select())}}(this))),this.editor.selection.range(range),this.editor.trigger("valuechanged")},LinkButton}(Button),LinkPopover=function(superClass){function LinkPopover(){return LinkPopover.__super__.constructor.apply(this,arguments)}return extend(LinkPopover,superClass),LinkPopover.prototype.render=function(){var tpl;return tpl='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("linkText")+'</label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="'+this._t("removeLink")+'"\n      tabindex="-1">\n      <span class="simditor-icon simditor-icon-unlink"></span>\n    </a>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkUrl")+'</label>\n    <input class="link-url" type="text"/>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkTarget")+'</label>\n    <select class="link-target">\n      <option value="_blank">'+this._t("openLinkInNewWindow")+' (_blank)</option>\n      <option value="_self">'+this._t("openLinkInCurrentWindow")+" (_self)</option>\n    </select>\n  </div>\n</div>",this.el.addClass("link-popover").append(tpl),this.textEl=this.el.find(".link-text"),this.urlEl=this.el.find(".link-url"),this.unlinkEl=this.el.find(".btn-unlink"),this.selectTarget=this.el.find(".link-target"),this.textEl.on("keyup",function(_this){return function(e){return 13!==e.which?(_this.target.text(_this.textEl.val()),_this.editor.inputManager.throttledValueChanged()):void 0}}(this)),this.urlEl.on("keyup",function(_this){return function(e){var val;if(13!==e.which)return val=_this.urlEl.val(),!/^(http|https|ftp|ftps|file)?:\/\/|^(mailto|tel)?:|^\//gi.test(val)&&val&&(val="http://"+val),_this.target.attr("href",val),_this.editor.inputManager.throttledValueChanged()}}(this)),$([this.urlEl[0],this.textEl[0]]).on("keydown",function(_this){return function(e){var range;return 13===e.which||27===e.which||!e.shiftKey&&9===e.which&&$(e.target).hasClass("link-url")?(e.preventDefault(),range=document.createRange(),_this.editor.selection.setRangeAfter(_this.target,range),_this.hide(),_this.editor.inputManager.throttledValueChanged()):void 0}}(this)),this.unlinkEl.on("click",function(_this){return function(e){var range,txtNode;return txtNode=document.createTextNode(_this.target.text()),_this.target.replaceWith(txtNode),_this.hide(),range=document.createRange(),_this.editor.selection.setRangeAfter(txtNode,range),_this.editor.inputManager.throttledValueChanged()}}(this)),this.selectTarget.on("change",function(_this){return function(e){return _this.target.attr("target",_this.selectTarget.val()),_this.editor.inputManager.throttledValueChanged()}}(this))},LinkPopover.prototype.show=function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],LinkPopover.__super__.show.apply(this,args),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr("href"))},LinkPopover}(Popover),Simditor.Toolbar.addButton(LinkButton),ImageButton=function(superClass){function ImageButton(){return ImageButton.__super__.constructor.apply(this,arguments)}return extend(ImageButton,superClass),ImageButton.prototype.name="image",ImageButton.prototype.icon="picture-o",ImageButton.prototype.htmlTag="img",ImageButton.prototype.disableTag="pre, table",ImageButton.prototype.defaultImage="",ImageButton.prototype.needFocus=!1,ImageButton.prototype._init=function(){var item,k,len,ref;if(this.editor.opts.imageButton)if(Array.isArray(this.editor.opts.imageButton))for(this.menu=[],ref=this.editor.opts.imageButton,k=0,len=ref.length;len>k;k++)item=ref[k],this.menu.push({name:item+"-image",text:this._t(item+"Image")});else this.menu=!1;else null!=this.editor.uploader?this.menu=[{name:"upload-image",text:this._t("uploadImage")},{name:"external-image",text:this._t("externalImage")}]:this.menu=!1;return this.defaultImage=this.editor.opts.defaultImage,this.editor.body.on("click","img:not([data-non-image])",function(_this){return function(e){var $img,range;return $img=$(e.currentTarget),range=document.createRange(),range.selectNode($img[0]),_this.editor.selection.range(range),_this.editor.util.support.onselectionchange||_this.editor.trigger("selectionchanged"),!1}}(this)),this.editor.body.on("mouseup","img:not([data-non-image])",function(e){return!1}),this.editor.on("selectionchanged.image",function(_this){return function(){var $contents,$img,range;return range=_this.editor.selection.range(),null!=range?($contents=$(range.cloneContents()).contents(),1===$contents.length&&$contents.is("img:not([data-non-image])")?($img=$(range.startContainer).contents().eq(range.startOffset),_this.popover.show($img)):_this.popover.hide()):void 0}}(this)),this.editor.on("valuechanged.image",function(_this){return function(){var $masks;return $masks=_this.editor.wrapper.find(".simditor-image-loading"),$masks.length>0?$masks.each(function(i,mask){var $img,$mask,file;return $mask=$(mask),$img=$mask.data("img"),!($img&&$img.parent().length>0)&&($mask.remove(),$img&&(file=$img.data("file"),file&&(_this.editor.uploader.cancel(file),_this.editor.body.find("img.uploading").length<1)))?_this.editor.uploader.trigger("uploadready",[file]):void 0}):void 0}}(this)),ImageButton.__super__._init.call(this)},ImageButton.prototype.render=function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],ImageButton.__super__.render.apply(this,args),this.popover=new ImagePopover({button:this}),"upload"===this.editor.opts.imageButton?this._initUploader(this.el):void 0},ImageButton.prototype.renderMenu=function(){return ImageButton.__super__.renderMenu.call(this),this._initUploader()},ImageButton.prototype._initUploader=function($uploadItem){var $input,createInput,uploadProgress;return null==$uploadItem&&($uploadItem=this.menuEl.find(".menu-item-upload-image")),null==this.editor.uploader?void this.el.find(".btn-upload").remove():($input=null,createInput=function(_this){return function(){return $input&&$input.remove(),$input=$("<input/>",{type:"file",title:_this._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo($uploadItem)}}(this),createInput(),$uploadItem.on("click mousedown","input[type=file]",function(e){return e.stopPropagation()}),$uploadItem.on("change","input[type=file]",function(_this){return function(e){return _this.editor.inputManager.focused?(_this.editor.uploader.upload($input,{inline:!0}),createInput()):(_this.editor.one("focus",function(e){return _this.editor.uploader.upload($input,{inline:!0}),createInput()}),_this.editor.focus()),_this.wrapper.removeClass("menu-on")}}(this)),this.editor.uploader.on("beforeupload",function(_this){return function(e,file){var $img;if(file.inline)return file.img?$img=$(file.img):($img=_this.createImage(file.name),file.img=$img),$img.addClass("uploading"),$img.data("file",file),_this.editor.uploader.readImageFile(file.obj,function(img){var src;if($img.hasClass("uploading"))return src=img?img.src:_this.defaultImage,_this.loadImage($img,src,function(){return _this.popover.active?(_this.popover.refresh(),_this.popover.srcEl.val(_this._t("uploading")).prop("disabled",!0)):void 0})})}}(this)),uploadProgress=$.proxy(this.editor.util.throttle(function(e,file,loaded,total){var $img,$mask,percent;if(file.inline&&($mask=file.img.data("mask")))return $img=$mask.data("img"),$img.hasClass("uploading")&&$img.parent().length>0?(percent=loaded/total,percent=(100*percent).toFixed(0),percent>99&&(percent=99),$mask.find(".progress").height(100-percent+"%")):void $mask.remove()},500),this),this.editor.uploader.on("uploadprogress",uploadProgress),this.editor.uploader.on("uploadsuccess",function(_this){return function(e,file,result){var $img,img_path,msg;if(file.inline&&($img=file.img,$img.hasClass("uploading")&&$img.parent().length>0)){if("object"!=typeof result)try{result=$.parseJSON(result)}catch(_error){e=_error,result={success:!1}}return result.success===!1?(msg=result.msg||_this._t("uploadFailed"),alert(msg),img_path=_this.defaultImage):img_path=result.file_path,_this.loadImage($img,img_path,function(){var $mask;return $img.removeData("file"),$img.removeClass("uploading").removeClass("loading"),$mask=$img.data("mask"),$mask&&$mask.remove(),$img.removeData("mask"),_this.editor.trigger("valuechanged"),_this.editor.body.find("img.uploading").length<1?_this.editor.uploader.trigger("uploadready",[file,result]):void 0}),_this.popover.active?(_this.popover.srcEl.prop("disabled",!1),_this.popover.srcEl.val(result.file_path)):void 0}}}(this)),this.editor.uploader.on("uploaderror",function(_this){return function(e,file,xhr){var $img,msg,result;if(file.inline&&"abort"!==xhr.statusText){if(xhr.responseText)try{result=$.parseJSON(xhr.responseText),msg=result.msg}catch(_error){e=_error,msg=_this._t("uploadError")}if($img=file.img,$img.hasClass("uploading")&&$img.parent().length>0)return _this.loadImage($img,_this.defaultImage,function(){var $mask;return $img.removeData("file"),$img.removeClass("uploading").removeClass("loading"),$mask=$img.data("mask"),$mask&&$mask.remove(),$img.removeData("mask")}),_this.popover.active&&(_this.popover.srcEl.prop("disabled",!1),_this.popover.srcEl.val(_this.defaultImage)),_this.editor.trigger("valuechanged"),_this.editor.body.find("img.uploading").length<1?_this.editor.uploader.trigger("uploadready",[file,result]):void 0}}}(this)))},ImageButton.prototype._status=function(){return this._disableStatus()},ImageButton.prototype.loadImage=function($img,src,callback){var $mask,img,positionMask;return positionMask=function(_this){return function(){var imgOffset,wrapperOffset;return imgOffset=$img.offset(),wrapperOffset=_this.editor.wrapper.offset(),$mask.css({top:imgOffset.top-wrapperOffset.top,left:imgOffset.left-wrapperOffset.left,width:$img.width(),height:$img.height()}).show()}}(this),$img.addClass("loading"),$mask=$img.data("mask"),$mask||($mask=$('<div class="simditor-image-loading">\n  <div class="progress"></div>\n</div>').hide().appendTo(this.editor.wrapper),positionMask(),$img.data("mask",$mask),$mask.data("img",$img)),img=new Image,img.onload=function(_this){return function(){var height,width;if($img.hasClass("loading")||$img.hasClass("uploading"))return width=img.width,height=img.height,$img.attr({src:src,width:width,height:height,"data-image-size":width+","+height}).removeClass("loading"),$img.hasClass("uploading")?(_this.editor.util.reflow(_this.editor.body),positionMask()):($mask.remove(),$img.removeData("mask")),$.isFunction(callback)?callback(img):void 0}}(this),img.onerror=function(){return $.isFunction(callback)&&callback(!1),$mask.remove(),$img.removeData("mask").removeClass("loading")},img.src=src},ImageButton.prototype.createImage=function(name){var $img,range;return null==name&&(name="Image"),this.editor.inputManager.focused||this.editor.focus(),range=this.editor.selection.range(),range.deleteContents(),this.editor.selection.range(range),$img=$("<img/>").attr("alt",name),range.insertNode($img[0]),this.editor.selection.setRangeAfter($img,range),this.editor.trigger("valuechanged"),$img},ImageButton.prototype.command=function(src){var $img;return $img=this.createImage(),this.loadImage($img,src||this.defaultImage,function(_this){return function(){return _this.editor.trigger("valuechanged"),_this.editor.util.reflow($img),$img.click(),_this.popover.one("popovershow",function(){return _this.popover.srcEl.focus(),_this.popover.srcEl[0].select()})}}(this))},ImageButton}(Button),ImagePopover=function(superClass){function ImagePopover(){return ImagePopover.__super__.constructor.apply(this,arguments)}return extend(ImagePopover,superClass),ImagePopover.prototype.offset={top:6,left:-4},ImagePopover.prototype.render=function(){var tpl;return tpl='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("imageUrl")+'</label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;"\n      title="'+this._t("uploadImage")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-upload"></span>\n    </a>\n  </div>\n  <div class=\'settings-field\'>\n    <label>'+this._t("imageAlt")+'</label>\n    <input class="image-alt" id="image-alt" type="text" tabindex="1" />\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("imageSize")+'</label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">Ã</span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;"\n      title="'+this._t("restoreImageSize")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-undo"></span>\n    </a>\n  </div>\n</div>',this.el.addClass("image-popover").append(tpl),this.srcEl=this.el.find(".image-src"),this.widthEl=this.el.find("#image-width"),this.heightEl=this.el.find("#image-height"),this.altEl=this.el.find("#image-alt"),this.srcEl.on("keydown",function(_this){return function(e){var range;if(13===e.which&&!_this.target.hasClass("uploading"))return e.preventDefault(),range=document.createRange(),_this.button.editor.selection.setRangeAfter(_this.target,range),_this.hide()}}(this)),this.srcEl.on("blur",function(_this){return function(e){return _this._loadImage(_this.srcEl.val())}}(this)),this.el.find(".image-size").on("blur",function(_this){return function(e){return _this._resizeImg($(e.currentTarget)),_this.el.data("popover").refresh()}}(this)),this.el.find(".image-size").on("keyup",function(_this){return function(e){var inputEl;return inputEl=$(e.currentTarget),13!==e.which&&27!==e.which&&9!==e.which?_this._resizeImg(inputEl,!0):void 0}}(this)),this.el.find(".image-size").on("keydown",function(_this){return function(e){var $img,inputEl,range;return inputEl=$(e.currentTarget),13===e.which||27===e.which?(e.preventDefault(),13===e.which?_this._resizeImg(inputEl):_this._restoreImg(),$img=_this.target,_this.hide(),range=document.createRange(),_this.button.editor.selection.setRangeAfter($img,range)):9===e.which?_this.el.data("popover").refresh():void 0}}(this)),this.altEl.on("keydown",function(_this){return function(e){var range;return 13===e.which?(e.preventDefault(),range=document.createRange(),_this.button.editor.selection.setRangeAfter(_this.target,range),_this.hide()):void 0}}(this)),this.altEl.on("keyup",function(_this){return function(e){return 13!==e.which&&27!==e.which&&9!==e.which?(_this.alt=_this.altEl.val(),_this.target.attr("alt",_this.alt)):void 0}}(this)),this.el.find(".btn-restore").on("click",function(_this){return function(e){return _this._restoreImg(),_this.el.data("popover").refresh()}}(this)),this.editor.on("valuechanged",function(_this){return function(e){return _this.active?_this.refresh():void 0}}(this)),this._initUploader()},ImagePopover.prototype._initUploader=function(){var $uploadBtn,createInput;return $uploadBtn=this.el.find(".btn-upload"),null==this.editor.uploader?void $uploadBtn.remove():(createInput=function(_this){return function(){return _this.input&&_this.input.remove(),_this.input=$("<input/>",{type:"file",title:_this._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo($uploadBtn)}}(this),createInput(),this.el.on("click mousedown","input[type=file]",function(e){return e.stopPropagation()}),this.el.on("change","input[type=file]",function(_this){return function(e){return _this.editor.uploader.upload(_this.input,{inline:!0,img:_this.target}),createInput()}}(this)))},ImagePopover.prototype._resizeImg=function(inputEl,onlySetVal){var height,value,width;return null==onlySetVal&&(onlySetVal=!1),value=1*inputEl.val(),this.target&&($.isNumeric(value)||0>value)?(inputEl.is(this.widthEl)?(width=value,height=this.height*value/this.width,this.heightEl.val(height)):(height=value,width=this.width*value/this.height,this.widthEl.val(width)),onlySetVal?void 0:(this.target.attr({width:width,height:height}),this.editor.trigger("valuechanged"))):void 0},ImagePopover.prototype._restoreImg=function(){var ref,size;return size=(null!=(ref=this.target.data("image-size"))?ref.split(","):void 0)||[this.width,this.height],this.target.attr({width:1*size[0],height:1*size[1]}),this.widthEl.val(size[0]),this.heightEl.val(size[1]),this.editor.trigger("valuechanged")},ImagePopover.prototype._loadImage=function(src,callback){if(/^data:image/.test(src)&&!this.editor.uploader)return void(callback&&callback(!1));if(this.target.attr("src")!==src)return this.button.loadImage(this.target,src,function(_this){return function(img){var blob;if(img)return _this.active&&(_this.width=img.width,_this.height=img.height,_this.widthEl.val(_this.width),_this.heightEl.val(_this.height)),/^data:image/.test(src)?(blob=_this.editor.util.dataURLtoBlob(src),blob.name="Base64 Image.png",_this.editor.uploader.upload(blob,{inline:!0,img:_this.target})):_this.editor.trigger("valuechanged"),callback?callback(img):void 0}}(this))},ImagePopover.prototype.show=function(){var $img,args;return args=1<=arguments.length?slice.call(arguments,0):[],ImagePopover.__super__.show.apply(this,args),$img=this.target,this.width=$img.width(),this.height=$img.height(),this.alt=$img.attr("alt"),$img.hasClass("uploading")?this.srcEl.val(this._t("uploading")).prop("disabled",!0):(this.srcEl.val($img.attr("src")).prop("disabled",!1),this.widthEl.val(this.width),this.heightEl.val(this.height),this.altEl.val(this.alt))},ImagePopover}(Popover),Simditor.Toolbar.addButton(ImageButton),IndentButton=function(superClass){function IndentButton(){return IndentButton.__super__.constructor.apply(this,arguments)}return extend(IndentButton,superClass),IndentButton.prototype.name="indent",IndentButton.prototype.icon="indent",IndentButton.prototype._init=function(){var hotkey;return hotkey=this.editor.opts.tabIndent===!1?"":" (Tab)",this.title=this._t(this.name)+hotkey,IndentButton.__super__._init.call(this)},IndentButton.prototype._status=function(){},IndentButton.prototype.command=function(){return this.editor.indentation.indent()},IndentButton}(Button),Simditor.Toolbar.addButton(IndentButton),OutdentButton=function(superClass){function OutdentButton(){return OutdentButton.__super__.constructor.apply(this,arguments)}return extend(OutdentButton,superClass),OutdentButton.prototype.name="outdent",OutdentButton.prototype.icon="outdent",OutdentButton.prototype._init=function(){var hotkey;return hotkey=this.editor.opts.tabIndent===!1?"":" (Shift + Tab)",this.title=this._t(this.name)+hotkey,OutdentButton.__super__._init.call(this)},OutdentButton.prototype._status=function(){},OutdentButton.prototype.command=function(){return this.editor.indentation.indent(!0)},OutdentButton}(Button),Simditor.Toolbar.addButton(OutdentButton),HrButton=function(superClass){function HrButton(){return HrButton.__super__.constructor.apply(this,arguments)}return extend(HrButton,superClass),HrButton.prototype.name="hr",HrButton.prototype.icon="minus",HrButton.prototype.htmlTag="hr",HrButton.prototype._status=function(){},HrButton.prototype.command=function(){var $hr,$newBlock,$nextBlock,$rootBlock;return $rootBlock=this.editor.selection.rootNodes().first(),$nextBlock=$rootBlock.next(),$nextBlock.length>0?this.editor.selection.save():$newBlock=$("<p/>").append(this.editor.util.phBr),$hr=$("<hr/>").insertAfter($rootBlock),$newBlock?($newBlock.insertAfter($hr),this.editor.selection.setRangeAtStartOf($newBlock)):this.editor.selection.restore(),this.editor.trigger("valuechanged")},HrButton}(Button),Simditor.Toolbar.addButton(HrButton),TableButton=function(superClass){function TableButton(){return TableButton.__super__.constructor.apply(this,arguments)}return extend(TableButton,superClass),TableButton.prototype.name="table",TableButton.prototype.icon="table",TableButton.prototype.htmlTag="table",TableButton.prototype.disableTag="pre, li, blockquote",TableButton.prototype.menu=!0,TableButton.prototype._init=function(){return TableButton.__super__._init.call(this),$.merge(this.editor.formatter._allowedTags,["thead","th","tbody","tr","td","colgroup","col"]),$.extend(this.editor.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]}),$.extend(this.editor.formatter._allowedStyles,{td:["text-align"],th:["text-align"]}),this._initShortcuts(),this._initResize(),this.editor.on("decorate",function(_this){return function(e,$el){return $el.find("table").each(function(i,table){return _this.decorate($(table))})}}(this)),this.editor.on("undecorate",function(_this){return function(e,$el){return $el.find("table").each(function(i,table){return _this.undecorate($(table))})}}(this)),this.editor.on("selectionchanged.table",function(_this){return function(e){var $container,range;return _this.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active"),(range=_this.editor.selection.range())?($container=_this.editor.selection.containerNode(),range.collapsed&&$container.is(".simditor-table")&&_this.editor.selection.setRangeAtEndOf($container),$container.closest("td, th",_this.editor.body).addClass("active")):void 0}}(this)),this.editor.on("blur.table",function(_this){return function(e){return _this.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active")}}(this)),this.editor.keystroke.add("up","td",function(_this){return function(e,$node){return _this._tdNav($node,"up"),!0}}(this)),this.editor.keystroke.add("up","th",function(_this){return function(e,$node){return _this._tdNav($node,"up"),!0}}(this)),this.editor.keystroke.add("down","td",function(_this){return function(e,$node){return _this._tdNav($node,"down"),!0}}(this)),this.editor.keystroke.add("down","th",function(_this){return function(e,$node){return _this._tdNav($node,"down"),!0}}(this))},TableButton.prototype._tdNav=function($td,direction){var $anotherTr,$tr,action,anotherTag,index,parentTag,ref;return null==direction&&(direction="up"),action="up"===direction?"prev":"next",ref="up"===direction?["tbody","thead"]:["thead","tbody"],parentTag=ref[0],anotherTag=ref[1],$tr=$td.parent("tr"),$anotherTr=this["_"+action+"Row"]($tr),$anotherTr.length>0?(index=$tr.find("td, th").index($td),this.editor.selection.setRangeAtEndOf($anotherTr.find("td, th").eq(index))):!0},TableButton.prototype._nextRow=function($tr){var $nextTr;return $nextTr=$tr.next("tr"),$nextTr.length<1&&$tr.parent("thead").length>0&&($nextTr=$tr.parent("thead").next("tbody").find("tr:first")),$nextTr},TableButton.prototype._prevRow=function($tr){var $prevTr;return $prevTr=$tr.prev("tr"),$prevTr.length<1&&$tr.parent("tbody").length>0&&($prevTr=$tr.parent("tbody").prev("thead").find("tr")),$prevTr},TableButton.prototype._initResize=function(){var $editor;return $editor=this.editor,$(document).on("mousemove.simditor-table",".simditor-table td, .simditor-table th",function(e){var $col,$colgroup,$resizeHandle,$td,$wrapper,index,ref,ref1,x;return $wrapper=$(this).parents(".simditor-table"),$resizeHandle=$wrapper.find(".simditor-resize-handle"),$colgroup=$wrapper.find("colgroup"),$wrapper.hasClass("resizing")?void 0:($td=$(e.currentTarget),x=e.pageX-$(e.currentTarget).offset().left,5>x&&$td.prev().length>0&&($td=$td.prev()),$td.next("td, th").length<1?void $resizeHandle.hide():(null!=(ref=$resizeHandle.data("td"))?ref.is($td):void 0)?void $resizeHandle.show():(index=$td.parent().find("td, th").index($td),$col=$colgroup.find("col").eq(index),(null!=(ref1=$resizeHandle.data("col"))?ref1.is($col):void 0)?void $resizeHandle.show():$resizeHandle.css("left",$td.position().left+$td.outerWidth()-5).data("td",$td).data("col",$col).show()))}),$(document).on("mouseleave.simditor-table",".simditor-table",function(e){return $(this).find(".simditor-resize-handle").hide()}),$(document).on("mousedown.simditor-resize-handle",".simditor-resize-handle",function(e){var $handle,$leftCol,$leftTd,$rightCol,$rightTd,$wrapper,minWidth,startHandleLeft,startLeftWidth,startRightWidth,startX,tableWidth;return $wrapper=$(this).parent(".simditor-table"),$handle=$(e.currentTarget),$leftTd=$handle.data("td"),$leftCol=$handle.data("col"),$rightTd=$leftTd.next("td, th"),$rightCol=$leftCol.next("col"),startX=e.pageX,startLeftWidth=1*$leftTd.outerWidth(),startRightWidth=1*$rightTd.outerWidth(),startHandleLeft=parseFloat($handle.css("left")),tableWidth=$leftTd.closest("table").width(),
minWidth=50,$(document).on("mousemove.simditor-resize-table",function(e){var deltaX,leftWidth,rightWidth;return deltaX=e.pageX-startX,leftWidth=startLeftWidth+deltaX,rightWidth=startRightWidth-deltaX,minWidth>leftWidth?(leftWidth=minWidth,deltaX=minWidth-startLeftWidth,rightWidth=startRightWidth-deltaX):minWidth>rightWidth&&(rightWidth=minWidth,deltaX=startRightWidth-minWidth,leftWidth=startLeftWidth+deltaX),$leftCol.attr("width",leftWidth/tableWidth*100+"%"),$rightCol.attr("width",rightWidth/tableWidth*100+"%"),$handle.css("left",startHandleLeft+deltaX)}),$(document).one("mouseup.simditor-resize-table",function(e){return $editor.sync(),$(document).off(".simditor-resize-table"),$wrapper.removeClass("resizing")}),$wrapper.addClass("resizing"),!1})},TableButton.prototype._initShortcuts=function(){return this.editor.hotkeys.add("ctrl+alt+up",function(_this){return function(e){return _this.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+down",function(_this){return function(e){return _this.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+left",function(_this){return function(e){return _this.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+right",function(_this){return function(e){return _this.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},TableButton.prototype.decorate=function($table){var $colgroup,$headRow,$resizeHandle,$tbody,$thead,$wrapper;return $table.parent(".simditor-table").length>0&&this.undecorate($table),$table.wrap('<div class="simditor-table"></div>'),$wrapper=$table.parent(".simditor-table"),$colgroup=$table.find("colgroup"),$table.find("thead").length<1&&($thead=$("<thead />"),$headRow=$table.find("tr").first(),$thead.append($headRow),this._changeCellTag($headRow,"th"),$tbody=$table.find("tbody"),$tbody.length>0?$tbody.before($thead):$table.prepend($thead)),$colgroup.length<1&&($colgroup=$("<colgroup/>").prependTo($table),$table.find("thead tr th").each(function(i,td){var $col;return $col=$("<col/>").appendTo($colgroup)}),this.refreshTableWidth($table)),$resizeHandle=$("<div />",{"class":"simditor-resize-handle",contenteditable:"false"}).appendTo($wrapper),$table.parent()},TableButton.prototype.undecorate=function($table){return $table.parent(".simditor-table").length>0?$table.parent().replaceWith($table):void 0},TableButton.prototype.renderMenu=function(){var $table;return $('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+this._t("deleteRow")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + â )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + â )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+this._t("deleteColumn")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + â )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + â )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+this._t("deleteTable")+"</span>\n      </a>\n    </li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),$table=this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td, th",function(_this){return function(e){var $td,$tr,$trs,num;return _this.createMenu.find("td, th").removeClass("selected"),$td=$(e.currentTarget),$tr=$td.parent(),num=$tr.find("td, th").index($td)+1,$trs=$tr.prevAll("tr").addBack(),$tr.parent().is("tbody")&&($trs=$trs.add($table.find("thead tr"))),$trs.find("td:lt("+num+"), th:lt("+num+")").addClass("selected")}}(this)),this.createMenu.on("mouseleave",function(e){return $(e.currentTarget).find("td, th").removeClass("selected")}),this.createMenu.on("mousedown","td, th",function(_this){return function(e){var $closestBlock,$td,$tr,colNum,rowNum;return _this.wrapper.removeClass("menu-on"),_this.editor.inputManager.focused?($td=$(e.currentTarget),$tr=$td.parent(),colNum=$tr.find("td").index($td)+1,rowNum=$tr.prevAll("tr").length+1,$tr.parent().is("tbody")&&(rowNum+=1),$table=_this.createTable(rowNum,colNum,!0),$closestBlock=_this.editor.selection.blockNodes().last(),_this.editor.util.isEmptyNode($closestBlock)?$closestBlock.replaceWith($table):$closestBlock.after($table),_this.decorate($table),_this.editor.selection.setRangeAtStartOf($table.find("th:first")),_this.editor.trigger("valuechanged"),!1):void 0}}(this))},TableButton.prototype.createTable=function(row,col,phBr){var $table,$tbody,$td,$thead,$tr,c,k,l,r,ref,ref1;for($table=$("<table/>"),$thead=$("<thead/>").appendTo($table),$tbody=$("<tbody/>").appendTo($table),r=k=0,ref=row;ref>=0?ref>k:k>ref;r=ref>=0?++k:--k)for($tr=$("<tr/>"),$tr.appendTo(0===r?$thead:$tbody),c=l=0,ref1=col;ref1>=0?ref1>l:l>ref1;c=ref1>=0?++l:--l)$td=$(0===r?"<th/>":"<td/>").appendTo($tr),phBr&&$td.append(this.editor.util.phBr);return $table},TableButton.prototype.refreshTableWidth=function($table){return setTimeout(function(_this){return function(){var cols,tableWidth;return tableWidth=$table.width(),cols=$table.find("col"),$table.find("thead tr th").each(function(i,td){var $col;return $col=cols.eq(i),$col.attr("width",$(td).outerWidth()/tableWidth*100+"%")})}}(this),0)},TableButton.prototype.setActive=function(active){return TableButton.__super__.setActive.call(this,active),active?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},TableButton.prototype._changeCellTag=function($tr,tagName){return $tr.find("td, th").each(function(i,cell){var $cell;return $cell=$(cell),$cell.replaceWith("<"+tagName+">"+$cell.html()+"</"+tagName+">")})},TableButton.prototype.deleteRow=function($td){var $newTr,$tr,index;return $tr=$td.parent("tr"),$tr.closest("table").find("tr").length<1?this.deleteTable($td):($newTr=this._nextRow($tr),$newTr.length>0||($newTr=this._prevRow($tr)),index=$tr.find("td, th").index($td),$tr.parent().is("thead")&&($newTr.appendTo($tr.parent()),this._changeCellTag($newTr,"th")),$tr.remove(),this.editor.selection.setRangeAtEndOf($newTr.find("td, th").eq(index)))},TableButton.prototype.insertRow=function($td,direction){var $newTr,$table,$tr,cellTag,colNum,i,index,k,ref;for(null==direction&&(direction="after"),$tr=$td.parent("tr"),$table=$tr.closest("table"),colNum=0,$table.find("tr").each(function(i,tr){return colNum=Math.max(colNum,$(tr).find("td").length)}),index=$tr.find("td, th").index($td),$newTr=$("<tr/>"),cellTag="td","after"===direction&&$tr.parent().is("thead")?$tr.parent().next("tbody").prepend($newTr):"before"===direction&&$tr.parent().is("thead")?($tr.before($newTr),$tr.parent().next("tbody").prepend($tr),this._changeCellTag($tr,"td"),cellTag="th"):$tr[direction]($newTr),i=k=1,ref=colNum;ref>=1?ref>=k:k>=ref;i=ref>=1?++k:--k)$("<"+cellTag+"/>").append(this.editor.util.phBr).appendTo($newTr);return this.editor.selection.setRangeAtStartOf($newTr.find("td, th").eq(index))},TableButton.prototype.deleteCol=function($td){var $newTd,$table,$tr,index,noOtherCol,noOtherRow;return $tr=$td.parent("tr"),noOtherRow=$tr.closest("table").find("tr").length<2,noOtherCol=$td.siblings("td, th").length<1,noOtherRow&&noOtherCol?this.deleteTable($td):(index=$tr.find("td, th").index($td),$newTd=$td.next("td, th"),$newTd.length>0||($newTd=$tr.prev("td, th")),$table=$tr.closest("table"),$table.find("col").eq(index).remove(),$table.find("tr").each(function(i,tr){return $(tr).find("td, th").eq(index).remove()}),this.refreshTableWidth($table),this.editor.selection.setRangeAtEndOf($newTd))},TableButton.prototype.insertCol=function($td,direction){var $col,$newCol,$newTd,$table,$tr,index,tableWidth,width;return null==direction&&(direction="after"),$tr=$td.parent("tr"),index=$tr.find("td, th").index($td),$table=$td.closest("table"),$col=$table.find("col").eq(index),$table.find("tr").each(function(_this){return function(i,tr){var $newTd,cellTag;return cellTag=$(tr).parent().is("thead")?"th":"td",$newTd=$("<"+cellTag+"/>").append(_this.editor.util.phBr),$(tr).find("td, th").eq(index)[direction]($newTd)}}(this)),$newCol=$("<col/>"),$col[direction]($newCol),tableWidth=$table.width(),width=Math.max(parseFloat($col.attr("width"))/2,50/tableWidth*100),$col.attr("width",width+"%"),$newCol.attr("width",width+"%"),this.refreshTableWidth($table),$newTd="after"===direction?$td.next("td, th"):$td.prev("td, th"),this.editor.selection.setRangeAtStartOf($newTd)},TableButton.prototype.deleteTable=function($td){var $block,$table;return $table=$td.closest(".simditor-table"),$block=$table.next("p"),$table.remove(),$block.length>0?this.editor.selection.setRangeAtStartOf($block):void 0},TableButton.prototype.command=function(param){var $td;if($td=this.editor.selection.containerNode().closest("td, th"),$td.length>0){if("deleteRow"===param)this.deleteRow($td);else if("insertRowAbove"===param)this.insertRow($td,"before");else if("insertRowBelow"===param)this.insertRow($td);else if("deleteCol"===param)this.deleteCol($td);else if("insertColLeft"===param)this.insertCol($td,"before");else if("insertColRight"===param)this.insertCol($td);else{if("deleteTable"!==param)return;this.deleteTable($td)}return this.editor.trigger("valuechanged")}},TableButton}(Button),Simditor.Toolbar.addButton(TableButton),StrikethroughButton=function(superClass){function StrikethroughButton(){return StrikethroughButton.__super__.constructor.apply(this,arguments)}return extend(StrikethroughButton,superClass),StrikethroughButton.prototype.name="strikethrough",StrikethroughButton.prototype.icon="strikethrough",StrikethroughButton.prototype.htmlTag="strike",StrikethroughButton.prototype.disableTag="pre",StrikethroughButton.prototype._activeStatus=function(){var active;return active=document.queryCommandState("strikethrough")===!0,this.setActive(active),this.active},StrikethroughButton.prototype.command=function(){return document.execCommand("strikethrough"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),$(document).trigger("selectionchange")},StrikethroughButton}(Button),Simditor.Toolbar.addButton(StrikethroughButton),AlignmentButton=function(superClass){function AlignmentButton(){return AlignmentButton.__super__.constructor.apply(this,arguments)}return extend(AlignmentButton,superClass),AlignmentButton.prototype.name="alignment",AlignmentButton.prototype.icon="align-left",AlignmentButton.prototype.htmlTag="p, h1, h2, h3, h4, td, th",AlignmentButton.prototype._init=function(){return this.menu=[{name:"left",text:this._t("alignLeft"),icon:"align-left",param:"left"},{name:"center",text:this._t("alignCenter"),icon:"align-center",param:"center"},{name:"right",text:this._t("alignRight"),icon:"align-right",param:"right"}],AlignmentButton.__super__._init.call(this)},AlignmentButton.prototype.setActive=function(active,align){return null==align&&(align="left"),"left"!==align&&"center"!==align&&"right"!==align&&(align="left"),"left"===align?AlignmentButton.__super__.setActive.call(this,!1):AlignmentButton.__super__.setActive.call(this,active),this.el.removeClass("align-left align-center align-right"),active&&this.el.addClass("align-"+align),this.setIcon("align-"+align),this.menuEl.find(".menu-item").show().end().find(".menu-item-"+align).hide()},AlignmentButton.prototype._status=function(){return this.nodes=this.editor.selection.nodes().filter(this.htmlTag),this.nodes.length<1?(this.setDisabled(!0),this.setActive(!1)):(this.setDisabled(!1),this.setActive(!0,this.nodes.first().css("text-align")))},AlignmentButton.prototype.command=function(align){if("left"!==align&&"center"!==align&&"right"!==align)throw new Error("simditor alignment button: invalid align "+align);return this.nodes.css({"text-align":"left"===align?"":align}),this.editor.trigger("valuechanged"),this.editor.inputManager.throttledSelectionChanged()},AlignmentButton}(Button),Simditor.Toolbar.addButton(AlignmentButton),Simditor}),function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=angular.module("ngSimditor",[require("./simditor.directive").name,require("./simditorOptions.service").name])},{"./simditor.directive":2,"./simditorOptions.service":3}],2:[function(require,module,exports){function simditor(simditorOptions){return{restrict:"AE",require:"ngModel",link:function(scope,element,attr,ngModel){if(ngModel){var $textarea=angular.element('<textarea placeholder="'+attr.placeholder+'"></textarea>');element.append($textarea);var config=angular.extend({textarea:$textarea},simditorOptions),editor=new Simditor(config);ngModel.$render=function(){editor.setValue(ngModel.$viewValue||"")},editor.on("valuechanged",function(e){ngModel.$setViewValue(editor.getValue())})}}}}module.exports=angular.module("simditor.directive",[]).directive("simditor",simditor),simditor.$inject=["simditorOptions"]},{}],3:[function(require,module,exports){module.exports=angular.module("simditorOptions.service",[]).value("simditorOptions",{})},{}]},{},[1]),function(root,factory){"function"==typeof define&&define.amd?define("simditor-i18n",["jquery","simditor"],function(a0,b1){return root["Simditor.i18n"]=factory(a0,b1)}):"object"==typeof module&&module.exports?module.exports=factory(require("jquery"),require("simditor")):root["Simditor.i18n"]=factory(root.jQuery,root.Simditor)}(this,function($,Simditor){return Simditor.i18n["pt-BR"]={blockquote:"Bloco de citaÃ§Ã£o",bold:"Negrito",code:"CÃ³digo",color:"Cor do Texto",coloredText:"Texto Colorido",hr:"Linha Horizontal",image:"Inserir Imagem",externalImage:"Imagem Externa",uploadImage:"Upload Imagem",uploadFailed:"Upload Falhou",uploadError:"Error ocorreu durante Upload",imageUrl:"Url",imageSize:"Tamanho",imageAlt:"Alt",restoreImageSize:"Tamanho original",uploading:"Uploading",indent:"Indentar",outdent:"Outdent",italic:"Italic",link:"Inserir link",linkText:"Texto",linkUrl:"Url",linkTarget:"Target",openLinkInCurrentWindow:"Abrir link na janela atual",openLinkInNewWindow:"Abrir link em uma nova janela",removeLink:"Remover link",ol:"Lista ordenada",ul:"Lista nÃ£o ordenada",strikethrough:"Tachado",table:"Tabela",deleteRow:"Remover linha",insertRowAbove:"Inserir linha acima",insertRowBelow:"Inserir linha abaixo",deleteColumn:"Remover coluna",insertColumnLeft:"Inserir coluna a esquerda",insertColumnRight:"Inserir coluna a direita",deleteTable:"Remover tabela",title:"Titulo",normalText:"Texto",underline:"Sublinhado",alignment:"Alinhamento",alignCenter:"Alinha ao centro",alignLeft:"Alinha a esquerda",alignRight:"Alinha a direita",alignJustify:"Justificar",selectLanguage:"Selecionar linguagem",fontScale:"Tamnaho da fonte",fontScaleXLarge:"X Tamanho grande",fontScaleLarge:"Tamanho grande",fontScaleNormal:"Tamanho normal",fontScaleSmall:"Tamanho pequeno",fontScaleXSmall:"X Tamanho pequeno"},Simditor.i18n}),function(){function requestDetalheCtrl($scope,$controller,item,functionToDetailNotify,objectName,stUtil,stService,$http){item=item||{},item.urlBase=item.urlBase||stService.getBaseUrl();var ctrl=this;angular.extend(ctrl,$controller("genericDetalheController",{$scope:$scope,functionToDetailNotify:functionToDetailNotify,objectName:objectName,item:item})),ctrl.executar=function(request){var url=request.urlBase+request.url,req={method:request.tipo,url:url,headers:{"Content-Type":"application/json"},data:angular.fromJson(request.body)};$http(req).then(function(data){ctrl.data.response=data})}}function requestListCtrl($scope,$controller,config,stCrudTools,stUtil,$route){var ctrl=this;angular.extend(ctrl,$controller("genericListController",{$scope:$scope,objectName:objectName,detalheTemplateUrl:"app/request/html/requestDetalhe.html",detalheController:"requestDetalheCtrl",detalheControllerAs:"$requestDetalheCtrl",filtros:[{attr:"descricao",label:"DescriÃ§Ã£o"}]})),ctrl.data.tableColumns=[{label:"DescriÃ§Ã£o",attr:"descricao",orderBy:!0,labelIcon:"list"}],ctrl.data.orderBy="descricao",ctrl.data.requestListParams={objectName:objectName,maxItensPerPage:config.confs.maxItemsPerPage||9},ctrl.data.getList()}angular.module("stapi").controller("requestDetalheCtrl",requestDetalheCtrl).controller("requestListCtrl",requestListCtrl);var objectName="Request"}(),function(){function requestList(){return{restrict:"E",templateUrl:"app/request/html/requestList.html",controller:"requestListCtrl",controllerAs:"$requestListCtrl"}}function requestGridView(){return{restrict:"E",templateUrl:"app/request/html/requestGridView.html"}}function requestTableView(){return{restrict:"E",templateUrl:"app/request/html/requestTableView.html"}}function requestForm(){return{restrict:"E",templateUrl:"app/request/html/requestForm.html"}}angular.module("stapi").directive("requestGridView",requestGridView).directive("requestTableView",requestTableView).directive("requestList",requestList).directive("requestDetalhe",requestList).directive("requestForm",requestForm)}(),function(){function requestUtil($mdDialogstService,$q,$mdDialog,$mdMedia,stCrudToolsUtils){}angular.module("stapi").factory("requestUtil",requestUtil)}(),function(){angular.module("stapi").config(function($routeProvider,$httpProvider){$routeProvider.when("/request",{template:"<request-list></request-list>"})})}(),function(){function democomponentDetalheCtrl($scope,$controller,item,functionToDetailNotify,objectName,stUtil){var ctrl=this;angular.extend(ctrl,$controller("genericDetalheController",{$scope:$scope,functionToDetailNotify:functionToDetailNotify,objectName:objectName,item:item}))}function democomponentListCtrl($scope,$controller,config,stCrudTools,stUtil,$route){function saveSuccessResolve(obj){stUtil.showMessage("","O objeto foi salvo com sucesso no override!"),obj.$mdDialog.hide(),$route.reload()}function cancelResolve(){stUtil.showMessage("","Fechado pelo usuÃ¡rio")}var ctrl=this;angular.extend(ctrl,$controller("genericListController",{$scope:$scope,objectName:objectName,detalheTemplateUrl:"app/democomponent/html/democomponentDetalhe.html",detalheController:"democomponentDetalheCtrl",detalheControllerAs:"$democomponentDetalheCtrl",filtros:[{attr:"_string.nome",label:"Buscar pelo nome do componente"},{attr:"id",operator:"=",label:"Buscar pelo id"}]})),ctrl.data.orderBy="_string.nome",ctrl.data.requestListParams={objectName:objectName,maxItensPerPage:config.maxItensPerPage||50},ctrl.data.saveSuccesResolve=saveSuccessResolve,ctrl.data.cancelResolve=cancelResolve,ctrl.data.getList()}angular.module("stapiApp").controller("democomponentDetalheCtrl",democomponentDetalheCtrl).controller("democomponentListCtrl",democomponentListCtrl);var objectName="DemoComponent"}(),function(){function democomponentList(){return{restrict:"E",templateUrl:"app/democomponent/html/democomponentList.html",controller:"democomponentListCtrl",controllerAs:"$democomponentListCtrl"}}function democomponentGridView(){return{restrict:"E",templateUrl:"app/democomponent/html/democomponentGridView.html"}}function democomponentTableView(){return{restrict:"E",templateUrl:"app/democomponent/html/democomponentTableView.html"}}function democomponentForm(){return{restrict:"E",templateUrl:"app/democomponent/html/democomponentForm.html"}}angular.module("stapiApp").directive("democomponentGridView",democomponentGridView).directive("democomponentTableView",democomponentTableView).directive("democomponentList",democomponentList).directive("democomponentDetalhe",democomponentList).directive("democomponentForm",democomponentForm)}(),function(){function democomponentUtil($mdDialogstService,$q,$mdDialog,$mdMedia,stCrudToolsUtils){var _deletar=function(_item,callback){stService["delete"]("democomponent",[_item.id]).then(function(){callback(_item)})["catch"](function(){callback()})},_mostrarDetalhe=function(item,functionToNotify){var useFullScreen=$mdMedia("sm")||$mdMedia("xs");$mdDialog.show({controllerAs:"$detalheCtrl",controller:"democomponentDetalheCtrl",resolve:{item:function(){return item},functionToNotify:function(){return functionToNotify},deferred:function(){return{}}},templateUrl:"app/democomponent/html/democomponentDetalhe.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:useFullScreen}).then(function(res){console.log("res: "),console.log(res)},function(){console.log("Cancelou!"),stCrudToolsUtils.cancelAndNotify(functionToNotify)})};return{deletar:_deletar,mostrarDetalhe:_mostrarDetalhe}}angular.module("stapiApp").factory("democomponentUtil",democomponentUtil)}(),function(){angular.module("stapiApp").config(function($routeProvider,$httpProvider){$routeProvider.when("/democomponent",{template:"<democomponent-list></democomponent-list>"})})}(),function(){function menuCtrl($scope,$controller){var ctrl=this;ctrl.scope=$scope;var menuItems=[{path:"inicio",icon:"home",label:"InÃ­cio"},{path:"cliente",icon:"person",label:"Crud Demo"},{path:"artigo",icon:"text_format",label:"Artigos"},{path:"democomponent",icon:"code",label:"Componentes"},{path:"prototipo",icon:"palette",label:"Criador de protÃ³tipos"},{path:"request",icon:"compare_arrows",label:"Request Test"}];angular.extend(ctrl,$controller("stMenuController",{$scope:$scope,menuItems:menuItems,sidenavId:"side-nav-principal"}))}angular.module("stapiApp").controller("menuCtrl",menuCtrl)}(),function(){function clienteDetalheCtrl($scope,$controller,item,functionToDetailNotify,objectName,stUtil){var ctrl=this;angular.extend(ctrl,$controller("genericDetalheController",{$scope:$scope,functionToDetailNotify:functionToDetailNotify,objectName:objectName,item:item}))}function clienteListCtrl($scope,$controller,config,stCrudTools,stUtil,$route){var ctrl=this;angular.extend(ctrl,$controller("genericListControl",{$scope:$scope,options:{objectName:objectName,detalheTemplateUrl:"app/cliente/html/clienteDetalhe.html",detalheController:"clienteDetalheCtrl",detalheControllerAs:"$clienteDetalheCtrl",fixProperties:ctrl.fixProperties||{}},filtros:[{attr:"principalAttr",label:" Buscar pelo principalAttr "}]})),ctrl.data.tableColumns=[{label:"principalLabel",attr:"principalAttr",orderBy:!0,labelIcon:"principalIcon"}],ctrl.data.orderBy="principalAttr",ctrl.data.requestListParams={objectName:objectName,maxItensPerPage:config.confs.maxItemsPerPage||9},ctrl.data.getList()}angular.module("stapiApp").controller("clienteDetalheCtrl",clienteDetalheCtrl).controller("clienteListCtrl",clienteListCtrl);var objectName="Cliente"}(),function(){function clienteList(){return{restrict:"E",templateUrl:"app/cliente/html/clienteList.html",bindToController:!0,controller:"clienteListCtrl",controllerAs:"$clienteListCtrl",scope:{fixProperties:"<",hideFilter:"<",hidePagination:"<",hideButtonAdd:"<"}}}function clienteGridView(){return{restrict:"E",templateUrl:"app/cliente/html/clienteGridView.html"}}function clienteTableView(){return{restrict:"E",templateUrl:"app/cliente/html/clienteTableView.html"}}function clienteForm(){return{restrict:"E",templateUrl:"app/cliente/html/clienteForm.html"}}angular.module("stapiApp").directive("clienteGridView",clienteGridView).directive("clienteTableView",clienteTableView).directive("clienteList",clienteList).directive("clienteDetalhe",clienteList).directive("clienteForm",clienteForm)}(),function(){function clienteUtil($mdDialogstService,$q,$mdDialog,$mdMedia,stCrudToolsUtils){}angular.module("stapiApp").factory("clienteUtil",clienteUtil)}(),function(){angular.module("stapiApp").config(function($routeProvider,$httpProvider){$routeProvider.when("/cliente",{template:"<cliente-list ></cliente-list>"})})}(),function(){angular.module("stapiApp").controller("detalhetesteController",function(stService,stUtil,$modalInstance,item,callback){var vm=this;vm.item=item||{},vm.salvandoItem=!1,vm.salvarItem=function(){var _item=vm.item;vm.salvandoItem=!0,stService.save("teste",_item).then(function(data){vm.item=data.item,vm.salvandoItem=!1,stUtil.showMessage("","Salvo com sucesso","info"),callback("add",$modalInstance)})["catch"](function(){vm.salvandoItem=!1,stUtil.showMessage("","Ocorreu um erro","danger"),callback("add-error",$modalInstance)})},vm.deletarItem=function(){stService["delete"]("teste",[vm.item.id]).then(function(){stUtil.showMessage("","Item deletado com sucesso","info"),callback("delete",$modalInstance)})["catch"](function(){stUtil.showMessage("","Ocorreu um erro ao deletar","danger"),callback("delete-error",$modalInstance)})}}).controller("listtesteController",function(testeUtil,stService,$route,stUtil,$scope){var vm=this;vm.openItem=function(item){testeUtil.openItem(item,function(event,modal){modal.close(),$route.reload()})},vm.deletarItem=function(item){stService["delete"]("teste",[item.id]).then(function(){stUtil.showMessage("","Item deletado com sucesso","info"),$route.reload()})["catch"](function(){stUtil.showMessage("","Ocorreu um erro ao deletar","danger")})}})}(),function(){angular.module("stapiApp").directive("testeGridView",function(){return{restrict:"E",templateUrl:"app/teste/html/gridView.html",scope:{objetos:"=",editFunction:"=",deleteFunction:"="},controllerAs:"vm",bindToController:!0,controller:function(){}}}).directive("testeTableView",function(){return{restrict:"E",templateUrl:"app/teste/html/tableView.html",scope:{objetos:"=",editFunction:"=",deleteFunction:"="},controllerAs:"vm",bindToController:!0,controller:function(){}}}).directive("testeForm",function(){return{restrict:"E",templateUrl:"app/teste/html/form.html",scope:{item:"="},controllerAs:"vm",bindToController:!0,controller:function(){}}})}(),function(){angular.module("stapiApp").factory("testeUtil",function($mdDialog){var _openItem=function(item,callback){$mdDialog.show({animation:!0,backdrop:"static",templateUrl:"app/teste/html/detalhe.html",size:"lg",controllerAs:"vm",controller:"detalhetesteController",resolve:{item:function(){return item},callback:function(){return callback}}})};return{openItem:_openItem}})}(),function(){angular.module("stapiApp").config(function($routeProvider,$httpProvider){$routeProvider.when("/teste",{templateUrl:"app/teste/html/list.html",controller:"listtesteController",controllerAs:"vm"})})}(),function(){angular.module("stapiApp").controller("changePasswordController",function($rootScope,$scope,stService,$cookieStore,$location,st,$localStorage,stUtil,configUtil){$scope.usuarioSistema=$cookieStore.get("usuarioSistema"),$scope.lembrarSenha=!0,$scope.alterarSenha=function(usuarioSistema){return!usuarioSistema.senha||usuarioSistema.senha.length<4?void stUtil.showMessage("","A senha deve ter pelo menos 4 caracteres.","danger"):void stService.save("operadorsistema",usuarioSistema).then(function(){st.leadEvt({descricao:"usuario_mudou_senha"}),configUtil.setConfig("mudouSenha","true",function(){$localStorage.senha=usuarioSistema.senha,$location.path("/inicio")})})["catch"](function(){st.evt({evento:"erro_mudar_senha"}),stUtil.showMessage("","Ocorreu um erro, tente novamente","danger")})}})}(),function(){angular.module("stapiApp").config(function($routeProvider,$httpProvider,$locationProvider){$routeProvider.when("/login",{templateUrl:"app/login/html/login.html",controller:"loginController",controllerAs:"$loginCtrl"}),$routeProvider.when("/notfound",{template:"<p>PÃ¡gina nÃ£o encontrada</p>"})})}(),function(){angular.module("stapiApp").controller("loginController",function($scope,$location,$rootScope,$localStorage,$cookieStore,loginUtil,stUtil,config,$route){function init(){ctrl.login={empresa:$localStorage.empresa,usuario:$localStorage.usuario,senha:$localStorage.senha},ctrl.loading=!1,ctrl.lembrarSenha=!0,$rootScope.usuarioSistema||($rootScope.usuarioSistema=$cookieStore.get("usuarioSistema"))}var ctrl=this;init(),ctrl.lembrarSenhaUsuario=function(){loginUtil.openLembrarSenha()},ctrl.logar=function(login,lembrarSenha){return login.usuario?login.senha?(ctrl.loading=!0,void loginUtil.logar(login,lembrarSenha,function(loginData){if(ctrl.loading=!1,loginData){angular.copy($rootScope.pathPosLogin);delete $rootScope.pathPosLogin,$location.path(config.defaultRoute||"/inicio")}else ctrl.login.senha="",delete $localStorage.senha,stUtil.showMessage("","Ocorreu um erro ao realizar login, tente novamente","danger")})):void stUtil.showMessage("","Informe a senha","danger"):void stUtil.showMessage("","Informe o UsuÃ¡rio","danger")},ctrl.logOut=function(){loginUtil.logOut(),$location.path(config.confs.loginPath||"login")},$localStorage.usuario&&$localStorage.senha&&ctrl.logar(ctrl.login,!0)})}(),function(){angular.module("stapiApp").controller("inicioController",function($rootScope,$route,$scope,$ocLazyLoad,dateUtil,$timeout,stService,$compile,config,$http,$templateCache,$controller,$mdColorUtil,$mdColors,ChartJs,$mdColorPalette){$rootScope.carregou&&0!=$rootScope.carregou||$ocLazyLoad.load({files:["http://localhost:8080/StApi/dev/app/login/js/moduloTest.js"]}).then(function(){console.log("Carregou!!!"),$route.reload(),$rootScope.carregou=!0})})}(),function(){angular.module("stapiApp").config(function($routeProvider,$httpProvider){$routeProvider.when("/inicio",{templateUrl:"app/inicio/html/inicio.html",controller:"inicioController",controllerAs:"$inicioCtrl"})})}();