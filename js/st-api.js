"use strict";!function(){angular.module("adm").config(function($routeProvider,$httpProvider){$httpProvider.interceptors.push(function($q,$rootScope,$location,$localStorage,usSpinnerService){return{responseError:function(rejection){var status=rejection.status,config=rejection.config;config.method,config.url;return usSpinnerService.stop("spinner-1"),401==status&&$location.path("/login-redirect"),$q.reject(rejection)}}}),$httpProvider.interceptors.push(function($q,$rootScope,$location,$cookieStore,usSpinnerService,cacheGet){return{request:function(config){if(-1==config.url.indexOf("projecao/execute-query")&&-1==config.url.indexOf("projecao/get-projecoes")&&-1==config.url.indexOf("isCachePost=true")&&usSpinnerService.spin("spinner-1"),-1==config.url.indexOf(".html")){var authToken=$rootScope.authToken||$cookieStore.get("authToken"),filialId=0,operadorId=0;$rootScope.currentFilial&&(filialId=$rootScope.currentFilial.id),$rootScope.currentOperador&&(operadorId=$rootScope.currentOperador.id);var operator="?";-1!=config.url.indexOf("?")&&(operator="&&"),config.url=config.url+operator+"token="+authToken,-1==config.url.indexOf("filialId")&&(config.url=config.url+"&&filialId="+filialId),-1==config.url.indexOf("operadorId")&&(config.url=config.url+"&&operadorId="+operadorId)}return config||$q.when(config)},response:function(res){var url=res.config.url;if(res.data&&res.data.item&&-1!=url.indexOf("produto/add")){var produto=res.data.item;if(console.log("Produto na resposta:"),console.log(produto),1==produto.disable)cacheGet.delObjectById("produto",produto.id);else if(cacheGet.updateObject("produto",produto),produto.tag){var tags=cacheGet.get("tagsProduto");-1==tags.indexOf(produto.tag)&&cacheGet.add("tagsProduto",[produto.tag])}}else if(res.data&&res.data.item&&-1!=url.indexOf("cliente/add")){var cliente=res.data.item;1==cliente.disable?cacheGet.delObjectById("cliente",cliente.id):cacheGet.updateObject("cliente",cliente)}return usSpinnerService.stop("spinner-1"),res||$q.when(res)}}})})}(),function(){angular.module("adm").factory("cacheGet",function($localStorage,$cookieStore,stUtil,$injector){var getNomeCache=function(){var login=$cookieStore.get("usuarioSistema").originalLogin;return"cacheGet"+login},_add=function(url,objetos){var nomeCache=getNomeCache();$localStorage[nomeCache]||($localStorage[nomeCache]={});var itens=$localStorage[nomeCache][url]||[];itens=itens.concat(objetos),$localStorage[nomeCache][url]=itens},_updateObject=function(url,objeto){var index=stUtil.buscaOb($localStorage[getNomeCache()][url],objeto.id,"id");-1!=index?$localStorage[getNomeCache()][url][index]=objeto:$localStorage[getNomeCache()][url].push(objeto)},_get=function(url,label,like){var nomeCache=getNomeCache();if(!$localStorage[nomeCache])return[];var itens=$localStorage[nomeCache][url];return label&&like&&(itens=itens.filter(function(item){return item[label]&&-1!=item[label].toLowerCase().indexOf(like.toLowerCase())?item:void 0})),itens},_getObjectById=function(url,id){var index=stUtil.buscaOb($localStorage[getNomeCache()][url],id,"id");return $localStorage[getNomeCache()][url][index]},_cleanAll=function(url){$localStorage[getNomeCache()]&&delete $localStorage[getNomeCache()][url]},_del=function(url,id){var index=stUtil.buscaOb($localStorage[getNomeCache()][url],id,"id");$localStorage[getNomeCache()][url].splice(index,1)},_getOfflineCache=function(callback){var stService=$injector.get("stService");_cleanAll("cliente"),_cleanAll("produto"),_cleanAll("tagsProduto"),stService.getLikeMap("cliente",["disable=0"],0,0,"").success(function(clientes){_add("cliente",clientes.itens),stService.getLikeMap("produto",["disable=0"],0,0,"").success(function(produtos){var prods=produtos.itens;_add("produto",prods);var tags=[];for(var i in prods)prods[i].tag&&-1==tags.indexOf(prods[i].tag)&&tags.push(prods[i].tag);_add("tagsProduto",tags),callback("ok")}).error(function(){callback()})}).error(function(){callback()})};return{add:_add,get:_get,cleanAll:_cleanAll,updateObject:_updateObject,getObjectById:_getObjectById,delObjectById:_del,getOfflineCache:_getOfflineCache}})}(),function(){angular.module("adm").factory("cachePost",function($localStorage,$cookieStore,$rootScope){var _add=function(url,objeto,callback){var idFilial=0;$rootScope.currentFilial&&(idFilial=$rootScope.currentFilial.id),objeto.idFilial=idFilial,url=url+"?filialId="+idFilial+"&&isCachePost=true",$localStorage.cachePost||($localStorage.cachePost=[]);var login,uS=$cookieStore.get("usuarioSistema");login=uS?uS.originalLogin:"shared@shared";var obCache={url:url,objeto:objeto,login:login};$localStorage.cachePost.push(obCache),callback&&callback(objeto)};return{add:_add}})}(),function(){angular.module("adm").directive("syncCachePost",function(onlineStatus){return{restrict:"E",templateUrl:"global/st-api/st-sync/template-module/syncCachePost.html",scope:{},controllerAs:"vm",bindToController:!0,controller:function($localStorage,$interval,$timeout,stService,$rootScope,stUtil,onlineStatus,$scope,loginUtil,st,$uibModal){var vm=this,_start=function(){function executePosts(i,tam){return i>=tam||!$localStorage.cachePost[0]||0==onlineStatus.isOnline()?(executando=!1,void($rootScope.executandoCachePost=!1)):(vm.indexCachePostInExcecution=i+1,void stService.executePost($localStorage.cachePost[0].url,$localStorage.cachePost[0].objeto).success(function(data){$localStorage.cachePost.splice(0,1),$timeout(function(){executePosts(i+1,tam)},300)}).error(function(erro,status){console.log("Erro no cachePost: "),console.log(erro),console.log("Status no cachePost"),console.log(status),console.log("Objeto no cachePost"),console.log($localStorage.cachePost[0]),erro&&401!=status&&(st.evt({evento:"erro_cache_post",descricao:erro,descricao_2:JSON.stringify($localStorage.cachePost[0])}),$localStorage.cachePost.splice(0,1),$uibModal.open({animation:!0,size:"lg",templateUrl:"global/st-api/app-login/template-route/manutencao.html"})),$timeout(function(){executePosts(i+1,tam)},5e3)}))}$localStorage.cachePost||($localStorage.cachePost=[]);var executando=!1,executar=function(){1!=executando&&0!=onlineStatus.isOnline()&&0!=loginUtil.isLogado()&&(executando=!0,$rootScope.executandoCachePost=!0,vm.sizeCachePostInExcecution=$localStorage.cachePost.length,executePosts(0,$localStorage.cachePost.length))};$interval(executar,5e3)};_start()}}})}(),function(){angular.module("adm").factory("st",function(stService,$rootScope,$cookieStore,config,deviceDetector){var _evt=function(evt){console.log("deviceDetector: "),console.log(deviceDetector);var usuario=$cookieStore.get("usuarioSistema");!evt.login&&usuario&&(evt.login=usuario.originalLogin),evt.versaoApp=config.appVersion,evt.alturaTela=$(window).height()+"",evt.larguraTela=$(window).width()+"",evt.os=deviceDetector.os+" - "+deviceDetector.os_version,evt.device=deviceDetector.device,evt.browser=deviceDetector.browser+" - "+deviceDetector.browser_version,stService.executePost("eventousuario/add/",evt).success(function(){})},_leadEvt=function(evt){var usuario=$cookieStore.get("usuarioSistema");stService.executeGet("/lead/add-action-by-tel",{tel:usuario.login,action:evt.descricao}).success(function(){})};return{evt:_evt,leadEvt:_leadEvt}}).factory("stUtil",function($rootScope,$filter,growl){var _removerAcentos=function(str){console.log("Antes: "+str);for(var rExps=[{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}],i=0,len=rExps.length;len>i;i++)str=str.replace(rExps[i].re,rExps[i].ch);return console.log("Depois: "+str),str},_disableFocus=function(){$("#anchor_cima").focus()},_getDayOfIndex=function(index){switch(index){case 0:return"segunda-feira";case 1:return"terça-feira";case 2:return"quarta-feira";case 3:return"quinta-feira";case 4:return"sexta-feira";case 5:return"sábado";case 6:return"domingo"}},_openLogin=function(modal){modal.open({animation:!0,templateUrl:"view/login/login.html",size:"lg",controller:function($scope,loginService,$rootScope){$scope.logar=function(login){$scope.logar=function(login){loginService.logar(login).success(function(data){var authToken=data.token;$rootScope.authToken=authToken})}},$scope.fechar=function(ele){ele.$dismiss("cancel")}}})},_getCountObs=function(obs,attrCount,attrComp,value){var total=0;for(i in obs)attrComp?_compareJson(obs[i],value,attrComp)&&(total+=_getValueOfNivel(obs[i],attrCount)):total+=_getValueOfNivel(obs[i],attrCount);return total},_formatData=function(data){if("object"==typeof data||"number"==typeof data)return $filter("date")(data,"yyyy-MM-dd");if(!data||""==data)return"";var format="",dia=parseInt(data.substring(0,2)),mes=data.substring(3,5),ano=data.substring(6);return format=ano+"-"+mes+"-"+dia},_getNameMonth=function(n){switch(n){case 1:return"Janeiro";case 2:return"Fevereiro";case 3:return"Março";case 4:return"Abril";case 5:return"Maio";case 6:return"Junho";case 7:return"Julho";case 8:return"Agosto";case 9:return"Setembro";case 10:return"Outubro";case 11:return"Novembro";case 12:return"Dezembro"}return""},_showMessage=function(titulo,mensagem,tipo){tipo=tipo||"info","danger"==tipo&&(tipo="error"),growl[tipo](mensagem)},_buscaOb=function(array,query,attr){var attrs=[];attr&&(attrs=attr.split("."));for(var i in array){if(attr&&1==attrs.length&&array[i][attrs[0]]==query)return i;if(attr&&2==attrs.length&&array[i][attrs[0]][attrs[1]]==query)return i;if(array[i]==query)return i}return-1},_getValueOfNivel=function(ob,attr){var result,nvs=attr.split(".");switch(nvs.length){case 0:result=ob;break;case 1:result=ob[nvs[0]];break;case 2:result=ob[nvs[0]][nvs[1]];break;case 3:result=ob[nvs[0]][nvs[1]][nvs[2]];break;case 4:result=ob[nvs[0]][nvs[1]][nvs[2]][nvs[3]];break;case 5:result=ob[nvs[0]][nvs[1]][nvs[2]][nvs[3]][nvs[4]]}return result},_setValueOfNivel=function(ob,attr,value){var nvs=attr.split(".");switch(nvs.length){case 0:break;case 1:ob[nvs[0]]=value;break;case 2:ob[nvs[0]][nvs[1]]=value;break;case 3:ob[nvs[0]][nvs[1]][nvs[2]]=value;break;case 4:ob[nvs[0]][nvs[1]][nvs[2]][nvs[3]]=value;break;case 5:ob[nvs[0]][nvs[1]][nvs[2]][nvs[3]][nvs[4]]=value}return ob},_compareJson=function(ob,value,attr){if(!attr||0==attr.split(".").length)return ob==value;var key,nvs=attr.split(".");switch(nvs.length){case 1:key=ob[nvs[0]];break;case 2:key=ob[nvs[0]][nvs[1]];break;case 3:key=ob[nvs[0]][nvs[1]][nvs[2]];break;case 4:key=ob[nvs[0]][nvs[1]][nvs[2]][nvs[3]];break;case 5:key=ob[nvs[0]][nvs[1]][nvs[2]][nvs[3]][nvs[4]]}return key==value};return{getCountObs:_getCountObs,getNameMonth:_getNameMonth,formatData:_formatData,showMessage:_showMessage,buscaOb:_buscaOb,openLogin:_openLogin,getValueOfNivel:_getValueOfNivel,setValueOfNivel:_setValueOfNivel,compareJson:_compareJson,disableFocus:_disableFocus,removerAcentos:_removerAcentos,getDayOfIndex:_getDayOfIndex}}).factory("s",function(){var _format=function(texto,tam,limiter){for(limiter&&(texto=_setLimiter(texto,limiter,"."));texto.length<tam;)texto+=" ";return texto},_setLimiter=function(value,max,tail){if(!value)return"";if(max=parseInt(max,10),!max)return value;if(value.length<=max)return value;value=value.substr(0,max);var lastspace=value.lastIndexOf(" ");return-1!=lastspace&&(("."==value.charAt(lastspace-1)||","==value.charAt(lastspace-1))&&(lastspace-=1),value=value.substr(0,lastspace)),value+(tail||" …")};return _format}).factory("printUtil",function($rootScope,$http,$filter,s,stUtil,movUtil){var FONT_BOLD=1,FONT_ITALIC=2,getFooterPrint=function(){var linhas=[],hoje=new Date;return linhas.push({texto:"TRACO"}),linhas.push({texto:"Emitido em "+$filter("date")(hoje,"dd/MM/yyyy")+" as "+$filter("date")(hoje,"HH:mm:ss")}),linhas},getHeaderPrint=function(tipoPessoa,nomePessoa){var linhas=[],config=$rootScope.config.confs,nome="  "+config.nomeUsuario,telefone="           "+config.telefone||"";if(linhas.push({texto:nome,fontSize:22,fontWeight:FONT_ITALIC,fontFamily:"ARIAL"}),linhas.push({texto:telefone,fontSize:12,fontWeight:FONT_BOLD,fontFamily:"ARIAL"}),linhas.push({texto:"TRACO"}),tipoPessoa&&nomePessoa){var descricaoPessoa=tipoPessoa+" : "+nomePessoa;descricaoPessoa=$filter("uppercase")(descricaoPessoa),linhas.push({texto:descricaoPessoa})}return linhas.push({texto:"TRACO"}),linhas},_printMovs=function(movs){var config=$rootScope.config.confs,tipoPessoa=movs[0].pessoa.tipo_pessoa,nomePessoa=movs[0].pessoa.nome,linhas=getHeaderPrint(tipoPessoa,nomePessoa);for(i in movs){var mov=movs[i],data=new Date(mov.data),dataFormatada=$filter("date")(data,"dd/MM/yyyy"),diaSemana=$filter("date")(data,"EEEE"),totalMov=$filter("number")(mov.valor,2);linhas.push({texto:dataFormatada+" ("+diaSemana+") - R$ "+totalMov});var pedidos=mov.pedidos,headerPedido=s("QUANT",5)+" "+s("PRODUTO",17)+" "+s("UNIT",5)+"  "+s("SUB-TOTAL",10);linhas.push({texto:headerPedido,fontSize:8,fontWeight:1});for(var j in pedidos){var ped=pedidos[j],totalPedido=$filter("number")(ped.quantidade*ped.valorUnitario,2),valorUnitario=$filter("number")(ped.valorUnitario,2),nomeProduto=ped.produto.nome;ped.opcao&&(nomeProduto+=" "+ped.opcao.nomeOpcao);var descPedido=s(ped.quantidade+"x",5)+" "+s(nomeProduto,17,16)+" "+s(valorUnitario,5)+"  "+s(totalPedido,10);linhas.push({texto:descPedido,fontSize:8,fontWeight:1})}}var totalForMovs=movUtil.getTotalMovs(movs);totalForMovs=$filter("number")(totalForMovs,2),linhas.push({texto:"Total: R$ "+totalForMovs}),linhas=linhas.concat(getFooterPrint());var objectPrint={larguraPapel:config.larguraPapelCupom||80,linhas:linhas},urlPrint=(config.urlImpressoraCupom||"http://localhost:1220")+"/print",req={method:"POST",url:urlPrint,headers:{"Content-Type":"text/plain"},data:objectPrint};$http(req).success(function(data){}).error(function(msg){stUtil.showMessage("","Ocorreu ao imprimir em '"+urlPrint+"'","danger")})};return{printMovs:_printMovs}}).factory("$stDetalhe",function($http,config,$uibModal){var _open=function(template,ob,$scope_,callback){$uibModal.open({animation:!0,templateUrl:template,size:"lg",controller:function($scope){$scope.ob=ob,$scope.objeto=ob,$scope.parente=$scope_,$scope.fechar=function(ele){ele.$dismiss("cancel"),callback($scope.objeto)}}})};return{open:_open}})}(),function(){angular.module("adm").config(["growlProvider",function(growlProvider){growlProvider.globalTimeToLive({success:1e3,error:2e3,warning:3e3,info:4e3})}])}(),function(){angular.module("adm").factory("onlineStatus",["$window","$rootScope",function($window,$rootScope){var onlineStatus={};return onlineStatus.onLine=$window.navigator.onLine,onlineStatus.isOnline=function(){return onlineStatus.onLine},$window.addEventListener("online",function(){onlineStatus.onLine=!0,$rootScope.$digest()},!0),$window.addEventListener("offline",function(){onlineStatus.onLine=!1,$rootScope.$digest()},!0),onlineStatus}])}(),function(){angular.module("adm").factory("dateUtil",function($rootScope,$filter,stUtil){function getDesdeInicioAno(){var periodoDe=new Date;return periodoDe.setDate(1),periodoDe.setMonth(0),{de:periodoDe,ate:new Date}}function getSemanaPassada(){var hoje=new Date,periodoDe=new Date,inicioSemana=parseInt($rootScope.config.confs.inicio_semana);periodoDe.setDate(hoje.getDate()-(hoje.getDay()+7)+inicioSemana);var periodoAte=new Date;return periodoAte.setDate(hoje.getDate()-hoje.getDay()+(inicioSemana-1)),{de:periodoDe,ate:periodoAte}}function getMesAtual(){var atual=new Date,lastDay=_daysInMonth(atual.getMonth()+1,atual.getYear()),periodoDe=new Date;new Date;periodoDe.setDate(1);var periodoAte=new Date;return periodoAte.setDate(lastDay),{de:periodoDe,ate:periodoAte}}function getSemanaAtual(){var hoje=new Date,periodoDe=new Date,inicioSemana=parseInt($rootScope.config.confs.inicio_semana);console.log("date: "+hoje.getDate()),console.log("day: "+hoje.getDay()),console.log("inicioSemana: "+inicioSemana),periodoDe.setDate(hoje.getDate()-hoje.getDay()+inicioSemana);var periodoAte=new Date;return periodoAte.setDate(periodoDe.getDate()+6),{de:periodoDe,ate:periodoAte}}function getNextDays(days){var hoje=new Date,periodoDe=new Date;periodoDe.setDate(hoje.getDate()+days);var periodoAte=new Date;return{de:periodoDe,ate:periodoAte}}function getLastDays(days){var hoje=new Date,periodoDe=new Date;periodoDe.setDate(hoje.getDate()-days);var periodoAte=new Date;return{de:periodoDe,ate:periodoAte}}function _getQueryOfPeriod(column,de,ate){var query=column+" between '"+_formatDate(de)+"' and '"+_formatDate(ate)+"'";return query}var _getPeriodOf=function(p,n){var intervalo;return"SEMANA_PASSADA"==p?intervalo=getSemanaPassada():"SEMANA_ATUAL"==p?intervalo=getSemanaAtual():"MES_ATUAL"==p?intervalo=getMesAtual():"LAST_DAYS"==p?intervalo=getLastDays(n):"NEXT_DAYS"==p?intervalo=getNextDays(n):"HOJE"==p?intervalo={de:new Date,ate:new Date}:"DESDE_INICIO_ANO"==p?intervalo=getDesdeInicioAno():console.log("tipo não definido em getPeridoOf()"),intervalo.de.setHours(0,0,0),intervalo.ate.setHours(23,59,59),intervalo},_formatDate=function(data){if("object"==typeof data||"number"==typeof data)return $filter("date")(data,"yyyy-MM-d");if(!data||""==data)return"";var format="";if(1==RegExp(/\d{4}\-\d{2}\-(\d{2}|\d{1})/).test(data)){var dia=parseInt(data.substring(8)),mes=data.substring(5,7),ano=data.substring(0,4);format=ano+"-"+mes+"-"+dia}else if(1==RegExp(/\d{2}\/\d{2}\/\d{4}/).test(data)){var dia=parseInt(data.substring(0,2)),mes=data.substring(3,5),ano=data.substring(6);format=ano+"-"+mes+"-"+dia}else if(1==RegExp(/\d{1}\/\d{2}\/\d{4}/).test(data)){var dia=parseInt(data.substring(0,1)),mes=data.substring(2,4),ano=data.substring(5);format=ano+"-"+mes+"-"+dia}return format},_getDate=function(data){var formatData=_formatDate(data),dia=parseInt(formatData.substring(8)),mes=parseInt(formatData.substring(5,7)),ano=parseInt(formatData.substring(0,4)),data=new Date(ano,mes-1,dia);return data},_daysInMonth=function(month,year){var dd=new Date(year,month,0);return dd.getDate()},_incrementaData=function(data,modo){switch(modo&&0!=modo||(modo=3),modo){case 1:data.setDate(data.getDate()+1);break;case 3:data.setMonth(data.getMonth()+1);break;default:data.setMonth(data.getMonth()+1)}return data},_daysBetween=function(date1_ms,date2_ms){var ONE_DAY=864e5,difference_ms=Math.abs(date1_ms-date2_ms);return Math.round(difference_ms/ONE_DAY)};return{getPeriodOf:_getPeriodOf,getQueryOfPeriod:_getQueryOfPeriod,formatDate:_formatDate,getDate:_getDate,daysInMonth:_daysInMonth,incrementaData:_incrementaData,daysBetween:_daysBetween}})}(),function(){angular.module("adm").directive("inputForm",function(){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/inputForm.html",scope:{ngModel:"=",label:"="}}}).directive("delayCount",function(onlineStatus){return{restrict:"E",template:"{{count}}",scope:{number:"=",time:"=",finish:"="},controller:function($scope,$interval){$scope.count=0,$interval(function(){return $scope.count<$scope.number?void $scope.count++:void($scope.finish=!0)},$scope.time||300)}}}).directive("networkButtonStatus",function(onlineStatus){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/networkButtonStatus.html",controller:function($scope){$scope.onlineStatus=onlineStatus,$scope.$watch("onlineStatus.isOnline()",function(online){$scope.online_status=online})}}}).directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]).directive("stInitial",function(){return{restrict:"A",controller:["$scope","$element","$attrs","$parse",function($scope,$element,$attrs,$parse){var getter,setter,val;val=$attrs.ngInitial||$attrs.value,getter=$parse($attrs.ngModel),(setter=getter.assign)($scope,val)}]}}).directive("buttonInfoOb",function($uibModal,filialUtil){return{link:function(scope,element,attrs){element.bind("click",function(){var objeto=JSON.parse(attrs.objeto);$uibModal.open({animation:!0,templateUrl:"global/st-api/st-util/template-module/info-ob/modalInfoOb.html",size:"md",controller:function($scope){$scope.objeto=objeto,objeto.historicoObjeto&&($scope.historicos=objeto.historicoObjeto.split(",")),$scope.filialObjeto=filialUtil.getFilialById(objeto.idFilial)}})})}}}).directive("buttonAdd",function(){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/buttonAdd.html"}}).directive("estadosCidades",function(){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/estadosCidades.html",scope:{estado:"=",cidade:"=",codigoUf:"=",codigoMunicipio:"=",nomeMunicipio:"=",uf:"="},bindToController:!0,controller:"estadosCidadesController as vm"}}).directive("stNoItens",function(){return{template:'<p class="text-muted" style="padding:10px;"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> {{label}}</p>',scope:{label:"="}}}).directive("destaqueTexto",function(){return{restrict:"E",template:"<strong><span class='{{class}}' ng-class=\"{'busca-destaque':(first!=-1 && $index>=first && $index<=last)}\" ng-repeat='c in texto track by $index'>{{c}}</span></strong>",scope:{busca:"=",texto:"=","class":"="},controller:function($scope){if($scope.busca&&$scope.busca.length>0){var texto=$scope.texto.toLowerCase(),busca=$scope.busca.toLowerCase();$scope.first=texto.indexOf(busca),$scope.last=$scope.first+busca.length}else $scope.first=-1,$scope.last=-1}}}).directive("buttonExpressCad",function(movUtil,stService){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/buttonExpressCad.html",controller:function($scope){$scope.cadDespesa=function(){var mov={tipo:1};movUtil.openMov(mov,function(){})}}}}).directive("stItemSelection",function(stService){return{restrict:"E",require:"ngModel",templateUrl:"global/st-api/st-util/template-module/itemSelection.html",scope:{maxItens:"=",objectOp:"=",label:"=",extraLabel:"="},link:function($scope,elements,attrs,ctrl){$scope.setPagina=function(pagina){$scope.pagina=pagina,stService.getLikeMap($scope.objectOp,[""],pagina,$scope.maxItens||0,"").success(function(data){$scope.itens=data.itens})},$scope.setPagina(0),$scope.selecionarItem=function(item){ctrl.$setViewValue(item)}}}}).directive("stShow",function($window,$animate){return{restrict:"A",multiElement:!0,link:function(scope,element,attr){scope.$watch(attr.stShow,function(value){1==value?element.addClass("st-show"):element.removeClass("st-show")})}}}).directive("stPrint",function($window){return{restrict:"A",scope:{},link:function(scope,element,attr){element.bind("click",function(){var ele=$("#"+element.attr("id-print"));ele.addClass("printShow"),ele.removeClass("printHide"),$window.print(),ele.removeClass("printShow"),ele.addClass("printHide")})}}}).directive("stPagination",function(anchorScroll){return{restrict:"AE",templateUrl:"global/st-api/st-util/template-module/st-pagination.html",scope:{label:"=",querys:"="},controller:function($scope,$rootScope){$scope.pagina=0,$scope.max=$rootScope.config.confs.maxItensPage||7,$scope.setPagina=function(pagina){anchorScroll.scrollTo("anchor_cima"),$scope.pagina=pagina,$scope.$parent.getLikeMap($scope.querys||[""],$scope.pagina,$rootScope.config.confs.maxItensPage||7,"","id","DESC")}}}}).directive("loading",function(){return{restrict:"E",scope:{label:"="},replace:!0,template:'<div class="loading"><i class="fa fa-refresh fa-spin"></i> <i>{{label}}</i></div>',link:function(scope,element,attr){scope.$watch("loading",function(val){val?scope.loadingStatus="true":scope.loadingStatus="false"})}}}).directive("stList",function($filter){return{templateUrl:"view/api/st-list.html",restrict:"E",scope:{itens:"=",left:"@",right:"@",link:"@",tl:"@",tr:"@",cl:"@",cr:"@",bl:"@",br:"@",tamleft:"@",tamright:"@",labelitem:"@"},link:function($scope,element,attrs){$scope.tamleft||($scope.tamleft=6),$scope.tamright||($scope.tamright=6),$scope.getLt=function(item,position){$scope[position]||"cl"!=position||(position="left"),$scope[position]||"cr"!=position||(position="right");var frase="";if(!$scope[position])return"";frase=$scope[position];var regex,i,expressoes=frase.split(","),termos=[],termo={atributo:"",valor:0,tipo:"",exp:""};for(var i in expressoes){if(termo={},-1==expressoes[i].indexOf("["))regex=new RegExp(/\'[\w | \W]+\'/),termo.valor=regex.exec(expressoes[i])[0].replace(/\'/g,""),termo.tipo="string",termo.atributo=null,termo.exp=expressoes[i];else{regex=new RegExp(/\[[\w |\W]+\:/);var atributo=regex.exec(expressoes[i])[0];atributo=atributo.replace("[",""),atributo=atributo.replace(":","");var atributos=atributo.split(".");termo.atributo=atributos[0];var sub_=atributo.split(".")[1],valor=item[termo.atributo];sub_&&(valor=valor[sub_]),termo.valor=valor,regex=new RegExp(/\'[\w | \W]+\'/),termo.tipo=regex.exec(expressoes[i])[0].replace(/\'/g,""),termo.exp=expressoes[i]}termos.push(termo)}var j,lt="";for(var j in termos)"money"==termos[j].tipo?(lt="R$ ",termos[j].valor=$filter("number")(termos[j].valor,2)):"string"==termos[j].tipo&&(termos[j].valor=$filter("uppercase")(termos[j].valor)),lt+=termos[j].valor;return lt},$scope.getLink=function(item){var link=$scope.link;if(!link)return"#";var pattern=new RegExp(/\[[a-z]+\]/),atributo=pattern.exec($scope.link),attr=atributo[0];return attr=attr.replace("[",""),attr=attr.replace("]",""),link=link.replace(pattern,item[attr])}}}}).directive("stCheck",function(){return{templateUrl:"global/st-api/st-util/template-module/stCheck.html",transclude:!0,scope:{ngModel:"=",ngChange:"=",ngDisabled:"=",label:"=",labelClass:"="}}}).directive("stRelatorio",function(relatorioService,stUtil){return{templateUrl:"view/relatorio/relatorioDirective.html",transclude:!0,scope:{url:"=",nomeObjeto:"="},controller:function($scope){$scope.dataDe=new Date,$scope.dataAte=new Date,$scope.teste=function(){},$scope.gerarRelatorio=function(column,operador,valueColumn,countColumn,query,nomeRelatorio){$scope.nomeRelatorio=nomeRelatorio;var ops={};ops.nomeObjeto=$scope.nomeObjeto,ops.column=column,ops.operador=operador,ops.countColumn=countColumn,ops.valueColumn=valueColumn,ops.url=$scope.url,ops.querys=[],ops.labels=["Dinheiro","Cheque"],ops.querysLabel=[],ops.dataDe=stUtil.formatData($scope.dataDe),ops.dataAte=stUtil.formatData($scope.dataAte),ops.querysLabel=ops.querys,query&&query.length>0&&ops.querys.push(query),relatorioService.getProjecoes(ops,function(data){$scope.proj=data})}}}}).directive("convertToNumber",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModel){ngModel.$parsers.push(function(val){return val?parseInt(val,10):null}),ngModel.$formatters.push(function(val){return val?""+val:null})}}}).directive("navClick",function(){return{restrict:"A",link:function(scope,element,attrs){element.on("click",function(event){var elementoMenu=$("#elementoMenu");elementoMenu.attr("class","sidebar-nav navbar-collapse collapse")})}}}).service("anchorScroll",function(){this.scrollTo=function(eID){function currentYPosition(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function elmYPosition(eID){for(var elm=document.getElementById(eID),y=elm.offsetTop,node=elm;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y}var startY=currentYPosition(),stopY=elmYPosition(eID),distance=stopY>startY?stopY-startY:startY-stopY;if(100>distance)return void scrollTo(0,stopY);var speed=Math.round(distance/100);speed>=20&&(speed=20);var step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(stopY>startY)for(var i=startY;stopY>i;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(var i=startY;i>stopY;i-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,stopY>leapY&&(leapY=stopY),timer++}}).directive("stCollapsePanel",function($timeout){return{restrict:"E",transclude:!0,templateUrl:"global/st-api/st-util/template-module/stCollapsePanel.html",scope:{titulo:"=",icone:"=",show:"=",extraClass:"="},link:function($scope){}}}).directive("stAccordion",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="panel-group" ng-transclude></div>',scope:{accordionIn:"="},link:function(scope,elem,attrs){var id=elem.attr("id");id||(id="btst_acc"+scope.$id,elem.attr("id",id));for(var arr=elem.find(".accordion-toggle"),i=0;i<arr.length;i++)$(arr[i]).attr("data-parent","#"+id),$(arr[i]).attr("href","#"+id+"collapse"+i);var arr=elem.find(".panel-collapse");1==scope.accordionIn&&$(arr[0]).addClass("in");for(var x=0;x<arr.length;x++)$(arr[x]).attr("id",id+"collapse"+x)},controller:function(){}}}).directive("stAccordionPanel",function(){return{require:"^stAccordion",restrict:"E",replace:!0,transclude:!0,scope:{title:"=",idPanel:"@"},template:'<div class="panel panel-default panel-pdvficha">	<div id="{{idPanel}}" data-toggle="collapse" class="panel-heading accordion-toggle collapsed">   	{{title}} <i class="fa fa-edit"></i>	</div>	<div class="panel-collapse collapse panel-body" ng-transclude>	</div></div>',link:function(scope,elem,attrs){scope.$watch("title",function(){var hdr=elem.find(".accordion-toggle");hdr.html(scope.title+' <i class="fa arrow"></i>')})}}}).filter("indexDay",function(stUtil){return function(value){return stUtil.getDayOfIndex(value)}}).filter("limiter",function(){return function(value,max,tail){if(!value)return"";if(max=parseInt(max,10),!max)return value;if(value.length<=max)return value;value=value.substr(0,max);var lastspace=value.lastIndexOf(" ");return-1!=lastspace&&(("."==value.charAt(lastspace-1)||","==value.charAt(lastspace-1))&&(lastspace-=1),value=value.substr(0,lastspace)),value+(tail||" …")}}).filter("tojson",function(){return function(value){return value?JSON.parse(value):""}}).directive('autoFocus"',function($timeout){return{link:function(scope,element){console.log("Chamou o focus"),$timeout(function(){element[0].focus(),console.log("Chamou o focus")})}}}).directive("focusMe",function($timeout){return{scope:{trigger:"=focusMe"},require:"ngModel",link:function(scope,element,attr,ctrl){scope.$watch("trigger",function(value){value===!0&&$timeout(function(){var ele=element[0];ele.selectionStart=ele.value.length,ele.focus(),scope.trigger=!1},1e3)})}}}).directive("verticalSpace",function(){return{restrict:"E",replace:!0,template:'<div class="row"><div class="vertical-space"></div></div>'}}).directive("stValue",function(){return{restrict:"E",scope:{object:"=",attr:"=",value:"="},link:function($scope){$scope.object||($scope.object={}),$scope.object[$scope.attr]=$scope.value,$scope.$watch($scope.value,function(){$scope.object[$scope.attr]=$scope.value})}}}).directive("usuarioSistema",function($uibModal,stService,stUtil,loginUtil){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/usuario-sistema/usuarioSistema.html",controller:function($scope,$rootScope,$cookieStore,filialUtil){$rootScope.$watch("usuarioSistema",function(usuarioSistema){$scope.usuarioSistema=usuarioSistema}),$scope.logOut=function(){loginUtil.logOut()},$scope.editarFilial=function(){filialUtil.openDetalheCurrentFilial(function(filial){})},$scope.editarUsuario=function(usuarioSistema){$uibModal.open({animation:!0,templateUrl:"global/st-api/st-util/template-module/usuario-sistema/modalEditUsuario.html",size:"lg",controller:function($scope){$scope.usuarioSistema=usuarioSistema,$scope.salvar=function(usuarioSistema,modal){return usuarioSistema.senha?usuarioSistema.senha!=usuarioSistema.senha2?void stUtil.showMessage("","As senhas não conferem!","danger"):usuarioSistema.senha.length<6?void stUtil.showMessage("","A senha deve ter pelo menos 6 caracteres.","danger"):void stService.save("operadorsistema",usuarioSistema).success(function(){stUtil.showMessage("","Salvo com sucesso!","info"),modal.$dismiss("cancel")}):void stUtil.showMessage("","O campo senha deve ser preenchido!","danger");
},$scope.fechar=function(ele){ele.$dismiss("cancel"),callback($scope.objeto)}}})}}}}).directive("stToggle",function(){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/stToggle.html",scope:{ngModel:"=",ngDisabled:"="}}}).directive("stSplitCheck",function(){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/st-split-check.html",scope:{ngModel:"=",preValues:"=",limiteLabel:"="},controller:function($scope){null==$scope.ngModel&&($scope.ngModel="");var its=$scope.preValues.split(","),itens=[];for(var i in its){var sele=-1!=$scope.ngModel.indexOf(its[i]);itens.push({label:its[i],selecionado:sele})}$scope.itens=itens,$scope.changeCheck=function(){var model="";for(var j in $scope.itens)1==$scope.itens[j].selecionado&&(model=model+","+$scope.itens[j].label);$scope.ngModel=model}}}}).directive("stStep",function(){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/st-step.html",scope:{steps:"=",step:"=",initialStep:"="},controller:function($scope){$scope.initialStep||($scope.step=0),$scope.changeStep=function(index){$scope.step=index}}}}).directive("inputEdit",function(){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/inputEdit.html",transclude:!0,scope:{label:"=",ngModel:"=",icon:"=",type:"="},controller:function($scope){$scope.ngModel?$scope.mostraValor=!0:$scope.mostraValor=!1}}}).directive("stCollapse",function(){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/st-collapse.html",transclude:!0,scope:{label:"="},controller:function($scope){$scope.show=!1}}}).directive("stPeriod",function(dateUtil,$localStorage){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/stPeriod.html",require:["de","ate","submit"],scope:{de:"=",ate:"=",submit:"=",change:"=",syncPeriod:"="},controller:function($scope){1==$scope.syncPeriod&&($scope.de=$localStorage.dataDe,$scope.ate=$localStorage.dataAte,$scope.$watch("de",function(de){$localStorage.dataDe=de}),$scope.$watch("ate",function(ate){$localStorage.dataAte=ate})),$scope.alterarPeriodo=function(periodo){var p=dateUtil.getPeriodOf(periodo);$scope.de=p.de,$scope.ate=p.ate}}}}).directive("stAlertButton",function(){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/stAlertButton.html",controller:function($scope,$interval,stService,$uibModal,$location,$stDetalhe,$route){var getAlerts=function(){stService.executeGet("projecao/execute-query",{query:"select p.id,p.nome,'',p.quantidade from Produto p where (p.quantidade<=p.minQuant) and p.disable =0"}).success(function(data){$scope.itens=data.itens,$scope.numAlerts=data.itens.length}).error(function(){})};$interval(getAlerts,15e3),$scope.openAlerts=function(itens){$uibModal.open({animation:!0,templateUrl:"global/st-api/st-util/template-module/modalAlertEstoque.html",size:"md",controller:function($scope){$scope.itens=itens,$scope.fechar=function(ele){ele.$dismiss("cancel"),callback($scope.objeto)},$scope.toProduct=function(idProduto,modal){modal.$dismiss("cancel"),stService.getById("produto",idProduto).success(function(data){$stDetalhe.open("view/produto/addAndUpdateProduto.html",data.item,$scope,function(res){$route.reload()})})}}})}}}})}(),function(){angular.module("adm").directive("mobileTabs",function(onlineStatus){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/mobileTabs.html",scope:{activeTab:"=",tabs:"="},controllerAs:"vm",bindToController:!0,controller:function(){var vm=this;0!=vm.activeTab&&(vm.activeTab=vm.activeTab||1),vm.alterarTab=function(tab){vm.activeTab=tab}}}})}(),function(){angular.module("adm").directive("stSelect",function(stService){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/stSelect.html",scope:{urlBase:"=",attrLabel:"=",ngModel:"="},controller:function($scope){stService.getAll($scope.urlBase).success(function(data){$scope.itens=data.itens})}}})}(),function(){angular.module("adm").directive("stInput",function($compile,$filter,stService,$rootScope,stUtil){return{require:"ngModel",scope:{tipo:"@",label:"=",disable:"@",objectOp:"@",optionsChosen:"@",html:"@",dateFormat:"=",savePath:"=",saveObject:"="},link:function($scope,element,attrs,ctrl){if("data"!=$scope.tipo&&element.bind("mouseover",function(){element.focus();var $thisVal=element.val();element.val("").val($thisVal)}),"htmlCompile"==$scope.tipo){var content=$compile($scope.html)($scope);element.html(content)}if("htmlView"==$scope.tipo){var content=$compile($scope.html)($scope);element.append(content)}else if("checkbox"==$scope.tipo)element.attr("type","checkbox"),element.attr("class","checkbox");else if("popover"==$scope.tipo){var button=$compile('<button style="z-index:99999"  type="button" class="btn btn-primary btn-lg" id="myPopover" data-toggle="popover">HTML Inside Popover</button>')($scope);$(button).popover({title:"<p><strong>Cadastrar Nova Pessoa/Empresa</strong></p>",content:'<p style="font-size:9pt">Digite abaixo o nome da Pessoa/Empresa que deseja cadastrar.</p><div class="form-group"><input class="form-control" placeholder="Digite o nome da Pessoa/Empresa"/></div><div class="form-group"><button class="btn btn-danger pull-left" onclick="$(&quot;#myPopover&quot;).popover(&quot;hide&quot;);" >Fechar</button><button class="btn btn-primary pull-right">Salvar</button></div><div class="row"></div',html:!0}),element.append(button)}else"tel"==$scope.tipo?(element.attr("type","tel"),element.mask("(99) 9999-9999?9")):"cpf"==$scope.tipo?element.mask("999.999.999-99"):"cnpj"==$scope.tipo?element.mask("99.999.999/9999-99"):"upper"==$scope.tipo?$(element).keyup(function(){this.value=this.value.toLocaleUpperCase(),ctrl.$setViewValue(this.value.toLocaleUpperCase())}):"money"==$scope.tipo||"monthPicker"==$scope.tipo&&(element.datepicker({onSelect:function(value){}}),element.bind("click",function(){ctrl.$setViewValue(element.val()),ctrl.$render()}));if("time"==$scope.tipo&&element.datepicker({dateFormat:"HH:mm:ss","z-index":9999,onSelect:function(date){ctrl.$setViewValue(date)}}),"data"==$scope.tipo){var format=$scope.dateFormat;$(element).focus(function(){this.blur()}),format&&"MM/yyyy"==format?element.MonthPicker():element.datepicker({dateFormat:"dd/mm/yy","z-index":9999,onSelect:function(date){ctrl.$setViewValue(date)}})}element.bind("keyup",function(value){"data"==$scope.tipo&&(ctrl.$setViewValue(_formatDate(ctrl.$viewValue)),ctrl.$render())}),ctrl.$parsers.push(function(value){return"data"==$scope.tipo?value=$filter("date")(value,"dd/MM/yyyy"):"time"==$scope.tipo&&(value=$filter("date")(value,"HH:mm:ss")),value}),ctrl.$formatters.push(function(value){return"data"==$scope.tipo?(value=$filter("date")(value,"dd/MM/yyyy"),ctrl.$setViewValue(value),ctrl.$render()):"time"==$scope.tipo&&(value=$filter("date")(value,"HH:mm:ss"),ctrl.$setViewValue(value),ctrl.$render()),value});var _formatDate=function(data){return data=data.replace(/[^0-9]+/g,""),data.length>2&&(data=data.substring(0,2)+"/"+data.substring(2)),data.length>5&&(data=data.substring(0,5)+"/"+data.substring(5,9)),data}}}})}(),function(){angular.module("adm").controller("estadosCidadesController",function(stService,stUtil){var vm=this;vm.loadingEstados=!0,stService.executeGet("estadoscidades/get-estados").success(function(data){if(vm.loadingEstados=!1,vm.estados=data.itens,vm.uf){var index=stUtil.buscaOb(vm.estados,vm.uf,"uf");vm.estado=vm.estados[index],vm.changeEstado({uf:vm.uf})}}),vm.changeCidade=function(cidade){vm.uf=cidade.uf,vm.codigoMunicipio=cidade.codigoMunicipio,vm.nomeMunicipio=cidade.nome,vm.codigoUf=vm.estado.codigoUf},vm.changeEstado=function(estado){vm.loadingCidades=!0,stService.executeGet("estadoscidades/get-cidades",{uf:estado.uf}).success(function(data){vm.loadingCidades=!1,vm.cidades=data.itens})},vm.codigoMunicipio&&(vm.loading=!0,stService.executeGet("/estadoscidades/get-cidade",{codMun:vm.codigoMunicipio}).success(function(data){vm.cidade=data.item,vm.loading=!1}))})}(),function(){angular.module("adm").directive("stTopMenu",function(configUtil,stService,$rootScope,$route,$filter,stUtil){return{restrict:"E",templateUrl:"global/st-api/st-util/template-module/stTopMenu.html",controller:function($scope,$rootScope){$scope.openConfig=function(){configUtil.openConfig()}}}}).directive("stMenu",function(){return{templateUrl:"global/st-api/st-menu/template-module/stMenu.html",scope:{itens:"="},controller:function($scope,$rootScope,$route,$filter,anchorScroll,loginUtil,$location,Fullscreen,$localStorage,stUtil,config){$scope.appVersion=config.appVersion,$rootScope.$on("$routeChangeSuccess",function(){var path;return $route.current.$$route?(path=$route.current.$$route.originalPath,"/cadastro/:login"==path||"/login"==path||"/change-password"==path||"/video-apresentacao"==path||"/login-redirect"==path||"/login/:login"==path||"/initial-config"==path?$scope.showMenu=!1:$scope.showMenu=!0,void $scope.clickItemMenu(path)):void $location.path("login")}),$scope.clickItemMenu=function(path){path=path.replace("/","");var indexItem=stUtil.buscaOb($scope.itens,path,"path"),item=$scope.itens[indexItem]||{};$scope.atualPage=item.label,$scope.currentPath=item.path,document.title=item.label||"SierTech - Gestão Fácil",$scope.routeHistory=$scope.routeHistory||[];var indexHistory=stUtil.buscaOb($scope.routeHistory,item.label,"label");-1!=indexHistory&&$scope.routeHistory.splice(indexHistory,1),$scope.routeHistory.push(item),$location.path(item.path)},$rootScope.absUrl=$location.$$absUrl,$scope.enableFullScreen=function(){Fullscreen.all()},$scope.enableFullScreen(),$rootScope.menuCollapsed=!0,$scope.changeCollapse=function(){$rootScope.menuCollapsed=!$rootScope.menuCollapsed},$rootScope.usuarioSistema||($rootScope.usuarioSistema=$localStorage.usuarioSistema),$scope.gotoAnchor=function(id){anchorScroll.scrollTo(id)},$scope.goToPageAnt=function(){window.history.back()},$scope.logOut=function(){loginUtil.logOut()}}}})}(),function(){angular.module("adm").factory("menuUtil",function($rootScope,$filter,stUtil){var _startOnboard=function(scope){};return{startOnboard:_startOnboard}})}(),function(){function replaceByAttr(string,item){var pattern=new RegExp(/\[[a-z]+\]/),atributo=pattern.exec(string),attr=atributo[0];return attr=attr.replace("[",""),attr=attr.replace("]",""),string=string.replace(pattern,item[attr])}angular.module("adm").controller("stControl",function($scope,$rootScope,$route,stService,$location,$stModal,$timeout,stUtil,$filter){function saveObject(objeto,nextLink){stService.save($scope.nomeObjeto,objeto).success(function(data){$scope.objeto=data.item,nextLink&&$location.path(replaceByAttr(nextLink,data.item)),stUtil.showMessage("","Salvo com sucesso!","success"),$route.reload(),$scope.objeto={}})}var maxIni=$rootScope.config.confs.maxItensPage||7;$scope.dataHoje=$filter("date")(new Date,"dd/MM/yyyy"),$scope.loadingStatus=!1,$scope.host=$location.$$host;var nomeObjeto,metodo,path=$location.$$path,opcoes=path.match(/\w+/gi),item={},itens=[],idObjeto=path.match(/\d+/i)||0;nomeObjeto=3==opcoes.length?opcoes[1]:opcoes[0],metodo=0==idObjeto?opcoes[1]||"get":"add",$scope.nomeObjeto=nomeObjeto,$scope.loadingStatus=!0,$timeout(function(){$scope.objetos||"get"==metodo&&stService.getLikeMap($scope.nomeObjeto,[""],0,maxIni,"").success(function(data){$scope.objetos=data.itens,$scope.loadingStatus=!1})},900),"add"==metodo&&0!=idObjeto&&stService.getById($scope.nomeObjeto,idObjeto).success(function(data){$scope.objeto=data.item,item=data.item}),$scope.selecionarTodos=function(sele,objetos){for(var i in objetos)objetos[i].selecionado=sele},$scope.saveAll=function(objetos){for(var i in objetos)objetos[i].selecionado&&$scope.save(objetos[i],null,null,!0)},$scope.save=function(objeto,nextLink,reqs,attrUnique){if($scope.savingStatus=!0,$scope.activeTab){var appends=$scope.activeTab.objectAppend;for(var key in appends)objeto[key]=appends[key]}objeto||$stModal.show({mensagem:"Preencha os campos corretamente."});for(var i in reqs)if(!objeto[reqs[i]]&&"id"!=reqs[i])return void $stModal.show({mensagem:"O campo "+reqs[i]+" está vazio."});if(attrUnique){var query=attrUnique+"='"+objeto[attrUnique]+"'";console.log("Query: "+query),stService.getLikeMap($scope.nomeObjeto,[query],0,0,"").success(function(data){return data.itens.length>0?void stUtil.showMessage("","Já existe um registro com '"+objeto[attrUnique]+"' cadastrado no sistema","danger"):void saveObject(objeto,nextLink)})}else saveObject(objeto,nextLink)},$scope.getLike=function(query,propriedade){$scope.loading=!0,query||(query=""),console.log("Prop: "+propriedade),propriedade||(propriedade="nome"),stService.getLike($scope.nomeObjeto,query,propriedade).success(function(data){$scope.objetos=data.itens,itens=data.itens,$scope.loading=!1})},$scope.setMaxIni=function(max){maxIni=max},$scope.getLikeMap=function(qs,pagina,max,extra,orderBy,ordem){$scope.loadingStatus=!0,$scope.fixQuerys&&(qs=qs.concat($scope.fixQuerys)),$scope.rightQuery&&qs.push($scope.rightQuery),orderBy&&null!=orderBy&&(extra||(extra=""),extra+=" order by "+orderBy+" "+ordem),qs&&0!=qs.length||(qs=[""]),stService.getLikeMap($scope.nomeObjeto,qs,pagina,max,extra).success(function(data){$scope.countAll=data.countAll,$scope.objetos=data.itens,itens=data.itens,$scope.loadingStatus=!1})},$scope.disableObject=function(objeto,callback,message){objeto.disable=1,stService.save($scope.nomeObjeto,objeto).success(function(data){stUtil.showMessage("",message||"Item removido com sucesso!","info"),callback(data)})},$scope.apagar=function(objetos){var ids=[];objetos.filter(function(ob,index){ob.selecionado&&(ids.push(ob.id),objetos.splice(index,1))});return 0==ids.length?void stUtil.showMessage("Nenhum item selecionado.","","danger"):void stService.apagar($scope.nomeObjeto,ids).success(function(data){var msg="";msg=ids.length>1?"Itens excluidos com sucesso!":"Item excluido com sucesso!",stUtil.showMessage("",msg,"success")})},$scope.getLink=function(pagina){return"comanda"==pagina?$location.$$host+":1220/Albar/comanda/index.html#/inicio":void 0}})}(),function(){angular.module("adm").factory("stService",function($http,config,$cookieStore){var _save=function(nomeObjeto,objeto){return $http.post(config.baseUrl+nomeObjeto+"/add/",objeto)},_getById=function(nomeObjeto,id){var req={method:"GET",params:{id:id}};return $http.get(config.baseUrl+nomeObjeto+"/get",req)},_getValues=function(nomeOb,attr,extras){var req={method:"GET",params:{nomeOb:nomeOb,attr:attr,extras:extras||[""]}};return $http.get(config.baseUrl+"opcao/get-values",req)},_apagar=function(nomeObjeto,ids){return $http.post(config.baseUrl+nomeObjeto+"/delete/",ids)},_getLike=function(nomeObjeto,queryBusca,prop){var req={method:"GET",params:{query:queryBusca,propriedade:prop}};return $http.get(config.baseUrl+nomeObjeto+"/busca/",req)},_getLikeMap=function(nomeObjeto,qs,pagina,max,extra){var req={method:"GET",params:{qs:qs,pagina:pagina,max:max,extra:extra}};return $http.get(config.baseUrl+nomeObjeto+"/busca/map",req)},_getAll=function(nomeObjeto){var req={method:"GET"};return $http.get(config.baseUrl+nomeObjeto,req)},_executePost=function(url,objeto){return $http.post(config.baseUrl+url,objeto)},_executeGet=function(url,params){var req={method:"GET",params:params};return $http.get(config.baseUrl+url,req)},_getProjecoesFromObject=function(objeto,ops){ops.extra=ops.extra||"",ops.qs=ops.qs||[""],ops.max=ops.max||0;var req={method:"GET",params:ops};return $http.get(config.baseUrl+objeto+"/projecoes",req)},_getProjecoes=function(ops){return ops.extra=ops.extra||"",ops.qs=ops.qs||[""],ops.max=ops.max||0,$http.post(config.baseUrl+"projecao/get-projecoes/",ops)};return{getLikeMap:_getLikeMap,getLike:_getLike,getAll:_getAll,save:_save,apagar:_apagar,getById:_getById,getValues:_getValues,getProjecoes:_getProjecoes,getProjecoesFromObject:_getProjecoesFromObject,executePost:_executePost,executeGet:_executeGet}})}(),function(){angular.module("adm").factory("loginUtil",function(cacheGet,$localStorage,$rootScope,$cookieStore,stService,filialUtil,$location,dateUtil,$uibModal,st){var _openModalDateErro=function(){$uibModal.open({animation:!0,templateUrl:"global/st-api/app-login/template-module/modalDateErro.html",size:"lg",controller:function($scope){}})},_openLembrarSenha=function(){$uibModal.open({animation:!0,templateUrl:"global/st-api/app-login/template-module/modalLembrarSenha.html",size:"lg",bindToController:"true",controllerAs:"vm",controller:function(stService,stUtil,$modalInstance){var vm=this;vm.step=1,vm.numero=$localStorage.usuario,vm.fechar=function(){$modalInstance.close()},vm.lembrarSenha=function(_numero){stService.executeGet("/lembrar-senha-sms",{numero:_numero}).success(function(res){1==res?vm.step=2:stUtil.showMessage("","Usuário inexistente no sistema","danger")})}}})},_logOut=function(){delete $rootScope.user,delete $rootScope.authToken,delete $rootScope.usuarioSistema,delete $localStorage.senha,$cookieStore.remove("authToken"),$cookieStore.remove("usuarioSistema"),$location.path("/login")},_configureSystemForUser=function(loginData,callback){var authToken=loginData.token;$rootScope.authToken=authToken,$cookieStore.put("authToken",authToken);var usuarioSistema=loginData.usuarioSistema;usuarioSistema.originalLogin=usuarioSistema.login,usuarioSistema.login=usuarioSistema.login.split("@")[0],$rootScope.usuarioSistema=usuarioSistema,$rootScope.config=loginData.config,$cookieStore.put("usuarioSistema",usuarioSistema),filialUtil.getAllFiliais(function(filiaisReturn){if(!filiaisReturn)return void callback();var idFilialInConfig=parseInt($rootScope.config.confs.currentFilialId),nomeFilial=$rootScope.config.confs.labelCurrentFilial,filiaisPermitdas=[];$rootScope.usuarioSistema.filiaisPermitidas&&(filiaisPermitdas=$rootScope.usuarioSistema.filiaisPermitidas.split(",")),idFilialInConfig>0&&-1!=filiaisPermitdas.indexOf(idFilialInConfig+"")?$rootScope.currentFilial={id:idFilialInConfig,xNome:nomeFilial}:filiaisPermitdas[0]&&($rootScope.currentFilial=filialUtil.getFilialById(parseInt(filiaisPermitdas[0]))),callback(loginData)})},_logar=function(login,lembrarSenha,callback){$localStorage.empresa=login.empresa,$localStorage.usuario=login.usuario,1==lembrarSenha?$localStorage.senha=login.senha:delete $localStorage.senha,$cookieStore.remove("authToken"),stService.executePost("/user/login/",login).success(function(data){var dataFrontEnd=dateUtil.getDate(new Date),dataBackEnd=dateUtil.getDate(data.dataBackEnd);return dataFrontEnd.getTime()!=dataBackEnd.getTime()?(st.evt({evento:"data_frontend_errada",descricao:"data_usuario_errada",descricao:"data do backend: "+dataBackEnd+", data do frontend: "+dataFrontEnd}),_openModalDateErro(),void callback()):void _configureSystemForUser(data,callback)}).error(function(data,erro){callback()})},_isLogado=function(){return $rootScope.usuarioSistema?!0:!1};return{logar:_logar,logOut:_logOut,isLogado:_isLogado,openLembrarSenha:_openLembrarSenha}})}(),function(){angular.module("adm").factory("filialUtil",function(stService,$rootScope,$localStorage,stUtil,st,$uibModal,$http,config){var _openDetalheCurrentFilial=function(filial,callback){$uibModal.open({animation:!0,templateUrl:"global/st-api/app-filial/template/modalDetalheFilial.html",size:"lg",controller:function($scope,$rootScope){$scope.filial=$rootScope.currentFilial,$scope.fechar=function(ele){ele.$dismiss("cancel"),callback($scope.filial)},$scope.enviarCertificado=function(file,senha){var fd=new FormData;fd.append("file",file),fd.append("senha",senha),$http.post(config.baseUrl+"filial/upload-certificado/",fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data){$rootScope.currentFilial.nomeCertificado=data.item,$scope.filial.nomeCertificado=data.item}).error(function(){})},$scope.salvar=function(filial){stService.save("filial",filial).success(function(data){stUtil.showMessage("","Salvo com sucesso","info"),callback&&callback(data.item)})}}})},_getAllFiliais=function(callback){stService.getAll("filial").success(function(data){var filiais=data.itens;filiais.length>0?($rootScope.filiais=filiais,$rootScope.filiais.unshift({id:0,xNome:"Todas"}),$rootScope.currentFilial=$localStorage.currentFilial||data.itens[0]):($rootScope.filiais=[{id:1,xNome:"Matriz"}],$rootScope.currentFilial={id:1,xNome:"Matriz"}),callback&&callback(data.itens)}).error(function(){callback()})},_getFilialById=function(id){var filial={},index=stUtil.buscaOb($rootScope.filiais,id,"id");return-1!=index&&(filial=$rootScope.filiais[index]),filial};return{getFilialById:_getFilialById,getAllFiliais:_getAllFiliais,openDetalheCurrentFilial:_openDetalheCurrentFilial}})}(),function(){angular.module("adm").controller("changeFilialController",function($scope,$rootScope,$localStorage,cacheGet,$route,filialUtil,stUtil,stService,configUtil,$modalInstance){stService.executeGet("/operadorsistema").success(function(data){$scope.operadores=[{id:0,nome:"Todos"}],$scope.operadores=$scope.operadores.concat(data.itens),$scope.operadorEsc=$rootScope.currentOperador||$scope.operadores[0]}),$rootScope.$watch("filiais",function(filiais){filiais&&($scope.filiais=filiais,$scope.filialEsc=$rootScope.currentFilial||filiais[0]),$scope.filiaisPermitidas=null,$rootScope.usuarioSistema.filiaisPermitidas&&($scope.filiaisPermitidas=$rootScope.usuarioSistema.filiaisPermitidas.split(","))}),$scope.config=$rootScope.config,$scope.filiais=$rootScope.filiais,$scope.currentFilial=$rootScope.currentFilial,$scope.openDetalheFilial=function(filial){filialUtil.openDetalheFilial(filial)},$scope.fecharModal=function(){$modalInstance.close()},$scope.alterarFilialAndOperador=function(filial,operador){return 1==filial.bloqueada?void stUtil.showMessage("","A origem '"+filial.nome+"' está bloqueada.","danger"):null!=$scope.filiaisPermitidas&&-1==$scope.filiaisPermitidas.indexOf(filial.id+"")?void stUtil.showMessage("","A origem '"+filial.nome+"' não está disponível para este usuário","danger"):($scope.currentFilial=filial,$rootScope.currentFilial=filial,$localStorage.currentFilial=filial,$rootScope.currentOperador=operador,$localStorage.currentOperador=operador,configUtil.setConfig("currentFilialId",filial.id+""),configUtil.setConfig("labelCurrentFilial",filial.xNome),void cacheGet.getOfflineCache(function(){stUtil.showMessage("","Origem alterada para  '"+filial.nome||filial.xNome+"'.","info"),1!=$scope.inModal&&$route.reload()}))}})}(),function(){angular.module("adm").directive("buttonFilial",function(filialUtil,$uibModal){return{templateUrl:"global/st-api/app-filial/template/buttonFilial.html",scope:{inModal:"="},controller:function($scope,$rootScope,$timeout){$timeout(function(){$scope.currentFilial=$rootScope.currentFilial},300),$rootScope.$watch("currentFilial",function(currentFilial){currentFilial&&($scope.labelCurrentFilial=currentFilial.xNome)}),$rootScope.$watch("currentOperador",function(currentOperador){currentOperador&&($scope.currentOperador=currentOperador)}),$scope.openChangeFilial=function(){$uibModal.open({animation:!0,templateUrl:"global/st-api/app-filial/template/openChangeFilial.html",size:"md",controller:"changeFilialController"})}}}}).directive("buttonFilialListWithModal",function($uibModal){return{restric:"E",templateUrl:"global/st-api/app-filial/template/buttonFilialListWithModal.html",controller:function($scope,$rootScope){$scope.currentFilial=$rootScope.currentFilial,$rootScope.$watch("currentFilial",function(currentFilial){currentFilial&&($scope.labelCurrentFilial=currentFilial.xNome)}),$scope.config=$rootScope.config,$scope.open=function(){$uibModal.open({animation:!0,templateUrl:"global/st-api/app-filial/template/filialListWithModal.html",size:"lg",controller:function($scope,$modalInstance){$scope.fechar=function(){console.log("Chamou"),$modalInstance.close()}}})}}}}).directive("alertFilial",function(filialUtil){return{templateUrl:"global/st-api/app-filial/template/alertFilial.html",scope:{label:"="},controller:function($scope,$rootScope){$scope.currentFilial=$rootScope.currentFilial}}}).directive("setAllFilials",function(filialUtil){return{templateUrl:"global/st-api/app-filial/template/setAllFilials.html",scope:{objeto:"=",defaultValue:"="},controller:function($scope,$rootScope){console.log("defaultValue antes: "),console.log(angular.copy($scope.defaultValue)),"true"==$scope.defaultValue?$scope.defaultValue=!0:"false"==$scope.defaultValue&&($scope.defaultValue=!1),$scope.filiais=$rootScope.filiais,$scope.objeto||($scope.objeto={allFilials:!0}),$scope.objeto.id||($scope.objeto.allFilials=$scope.defaultValue||!1,console.log("defaultValue: "),console.log($scope.defaultValue))}}})}(),function(){angular.module("adm").controller("cadastrosController",function($scope,stService,$rootScope,stUtil,$filter,cadastrosUtil){$scope.apagar=function(op,index){stService.apagar("opcao",[op.id]).success(function(){$scope.opcoes.splice(index,1)})},$scope.openCadastro=function(cadastro){cadastrosUtil.openCadastro(cadastro,function(item){$scope.getOpcoes($scope.descricao,$scope.label)})},$scope.getOpcoes=function(descricao,label){$scope.label=label,$scope.descricao=descricao,stService.getLikeMap("opcao",["descricao='"+descricao+"'"],0,0,"").success(function(data){$scope.opcoes=data.itens})}})}(),function(){angular.module("adm").config(function($routeProvider,$httpProvider){$routeProvider.when("/cadastros",{templateUrl:"global/st-api/cadastros/template-route/cadastros.html",controller:"cadastrosController"})})}(),function(){angular.module("adm").factory("cadastrosUtil",function($rootScope,$filter,stUtil,$uibModal){var _openCadastro=function(cadastro,callback){$uibModal.open({animation:!0,templateUrl:"global/st-api/cadastros/template-module/detalheCadastro.html",size:"lg",controller:function($scope,stService,stUtil){$scope.cadastro=cadastro,$scope.fechar=function(modal){modal.$dismiss("")},$scope.salvar=function(cadastro,modal){stService.save("opcao",cadastro).success(function(data){stUtil.showMessage("","Opção adicionada com sucesso!","info"),modal.$dismiss(""),callback(data.item)})}}})};return{openCadastro:_openCadastro}})}(),function(){angular.module("adm").factory("configUtil",function($http,config,$uibModal,stService,$rootScope,stUtil,$localStorage){var _getConfig=function(callback){stService.getAll("config").success(function(data){$rootScope.config=data.itens[0],$localStorage.config=data.itens[0],callback($rootScope.config)})},_setConfig=function(key,value,callback){var config=$rootScope.config,confs=$rootScope.config.confs;confs[key]=value,config.confs=confs,stService.save("config",config).success(function(data){$rootScope.config=data.item,callback&&callback(data.item)})},_openConfig=function(tab,callback){$uibModal.open({animation:!0,templateUrl:"global/st-api/app-config/template-module/config.html",size:"lg",controller:function($scope){$scope.activeTab=tab||0,$scope.modulos=[{nome:"Pessoas"},{nome:"Logística Reversa"},{nome:"Controle de Ponto"},{nome:"Estoque"},{nome:"Financeiro"},{nome:"Ferramentas"},{nome:"Relatorios"}],$scope.itensRelatorio=[{label:"Balanço",value:"balanco"},{label:"Lançamentos anteriores baixados",value:"lancamentos_anteriores_baixados"},{label:"Lucro por período (Mensal)",value:"lucro_periodo_mensal"},{label:"Produtos mais vendidos",value:"produtos_mais_vendidos"},{label:"Faturamento por produto",value:"faturamento_por_produto"},{label:"Despesas por categoria",value:"despesas_por_categoria"}],$scope.config=$rootScope.config,console.log("Config do rootScope: "),console.log($scope.config),$scope.config.id=1;var mds=$scope.modulos,mdsUser=[],itensRelatorio=[],itensRelatorioScope=$scope.itensRelatorio;$scope.config.confs||($scope.config.confs={}),$scope.config.confs.modulos&&(mdsUser=$scope.config.confs.modulos.split(",")),$scope.config.confs.itensRelatorio&&(itensRelatorio=$scope.config.confs.itensRelatorio.split(","));for(var i in mds)-1!=stUtil.buscaOb(mdsUser,mds[i].nome)&&(mds[i].selecionado=!0);for(var j in itensRelatorioScope)-1!=stUtil.buscaOb(itensRelatorio,itensRelatorioScope[j].value)&&(itensRelatorioScope[j].selecionado=!0);$scope.modulos=mds,$scope.itensRelatorio=itensRelatorioScope,$scope.salvar=function(){var conf=$scope.config,its=$scope.itensRelatorio,itensRelatorio="";for(var j in its)1==its[j].selecionado&&(itensRelatorio+=its[j].value+",");conf.confs.itensRelatorio=itensRelatorio;var mds="";for(var i in $scope.modulos)1==$scope.modulos[i].selecionado&&(mds+=$scope.modulos[i].nome+",");conf.confs.modulos=mds,stService.save("config",conf).success(function(data){stUtil.showMessage("","Salvo com sucesso!","info"),console.log("Config salvo: "),console.log(data.item),$rootScope.config=data.item})},$scope.fechar=function(ele){ele.$dismiss("cancel"),callback($scope.objeto)}}})};return{openConfig:_openConfig,getConfig:_getConfig,setConfig:_setConfig}})}(),function(){angular.module("adm").directive("buttonOpenConfig",function(configUtil){return{templateUrl:"global/st-api/app-config/template-module/button-config.html",scope:{activeTab:"=",label:"=",extraClass:"="},controller:function($scope){$scope.open=function(){configUtil.openConfig($scope.activeTab||0)}}}})}(),function(){angular.module("adm").directive("stFilterMap",function($compile,$filter,$rootScope){return{templateUrl:"global/st-api/st-filter-map/template-module/stFilterMap.html",restrict:"AE",scope:{filtros:"=",filterMapInstance:"=",querys:"=",extra:"="},controller:function($scope,stUtil){$scope.extra||($scope.extra=""),$scope.$watch("querys",function(value){$scope.aplicarFiltros(null,0,$rootScope.config.confs.maxItensPage||7,$scope.orderBy,$scope.orderType)}),$scope.filtros&&($scope.infoBusca=$scope.filtros[0]),$scope.dataHoje=$filter("date")(new Date,"dd/MM/yyyy"),$scope.pagina=0,$scope.max=$rootScope.config.confs.maxItensPage||7,$scope.qs=[],$scope.orderBy,$scope.ordem="DESC",$scope.objectFilter={},$scope.limparFiltros=function(){$scope.objectFilter={}},$scope.atualizar=function(){$scope.aplicarFiltros(null,0,$scope.max)},$scope.changeInfoBusca=function(info){$scope.infoBusca=info},$scope.buscar=function(info){stUtil.disableFocus();var objectFilter={};info&&(objectFilter[info.attr]=info.value),$scope.aplicarFiltros(objectFilter,0,$scope.max)},$scope.setPagina=function(pagina){$scope.pagina=pagina,$scope.$parent.getLikeMap($scope.qs,$scope.pagina,$scope.max,$scope.extra,$scope.orderBy,$scope.ordem)},$scope.aplicarFiltros=function(objectFilter,pagina,max,orderBy,ordem,interceptFilter){if($scope.pagina=0,objectFilter&&objectFilter.id&&objectFilter.id.length>0)return void $scope.$parent.getLikeMap(["id = "+objectFilter.id],$scope.pagina,max,$scope.extra,orderBy,ordem);var obs={};for(var key in objectFilter)obs[key]=objectFilter[key];$scope.qs=[];var query;for(var key in obs){if(query="","string"==typeof obs[key]&&obs[key].match(/\d{2}\/\d{2}\/\d{4}/)){var dataDe=obs[key]||"01/01/0000",dataAte=obs[key+"_ate"]||"01/01/3000";key=key.replace(/_ate/g,""),query=key+" between '"+stUtil.formatData(dataDe)+"' and '"+stUtil.formatData(dataAte)+"'",delete obs[key+"_ate"]}else if("string"==typeof obs[key]&&obs[key].match(/[\d]+\.[\d]+$/)){var de,ate;key.match(/[\w]+_ate/)?ate=obs[key]:de=obs[key],de=de||0,ate=ate||9e10,key=key.replace(/_ate/g,""),query=key+" between "+de+" and "+ate}else if(obs[key].toString().length>0){var valor=obs[key],operador="";"string"==typeof valor?(valor="'%"+valor+"%'",operador="like"):1==valor?(valor=1,operador="="):0==valor?(valor=0,operador="="):operador="=",query=key+" "+operador+" "+valor}query.length>0&&$scope.qs.push(query)}$scope.querys&&($scope.qs=$scope.qs.concat($scope.querys)),$scope.qs&&0!=$scope.qs.length||($scope.qs=[""]),$scope.$parent.getLikeMap&&$scope.$parent.getLikeMap($scope.qs,0,max,$scope.extra,$scope.orderBy,$scope.orderType)}}}})}(),function(){angular.module("adm").directive("stTable",function($filter,stService,$q,$stDetalhe,$timeout,$rootScope,pessoaUtil,$location,$route){return{templateUrl:"global/st-api/st-table/template-module/stTable.html",restrict:"AE",scope:{filterIntercept:"=",labels:"=",title:"=",attrUnique:"=",reqs:"=",nextLink:"=",objetos:"=",noCrud:"=",tabs:"=",teste:"=",rightTab:"=",cacheOps:"=",
cadLabel:"=",filtros:"=",buscaEspecial:"=",detalheLink:"=",customActions:"=",noSave:"=",htmlActionsPos:"=",detalheLink:"=",labelPivo:"=",tipoObjeto:"=",icon:"@"},link:function($scope){function transformLabelsToReqs(labels){var lista=[];for(var i in labels)lista.push(labels[i].attr);return lista}$rootScope.atualPage=$scope.title,$scope.rightTab&&"monthPicker"==$scope.rightTab.tipo&&($scope.rightTab.value=new Date),$scope.filtros||($scope.filtros=$scope.labels),$scope.title||($scope.title="Lista"),$scope.reqs||($scope.reqs=transformLabelsToReqs($scope.labels)),$scope.nextLink||($scope.nextLink=null),$scope.objeto={},$scope.objectFilter={},$scope.executeCustomAction=function(action,ob){action.call&&$scope.$parent[action.call](ob,function(data){ob=data,$timeout(function(){$scope.getLikeMap([],0,0,"")},500)})},$scope.bindFunction=function(funcao,ob){funcao&&$scope.$parent[funcao.call](ob,function(data){ob=data,$timeout(function(){$scope.getLikeMap([],0,0,"")},500)})},$scope.cadItem=function(){var objeto={tipo_pessoa:$location.$$path.replace("/","")};pessoaUtil.openDetalhePessoa(objeto,0,function(){console.log("Objeto: "),console.log(objeto),$route.reload()})},$scope.openDetalhe=function(objeto,tab){"pessoa"==$scope.tipoObjeto&&pessoaUtil.openDetalhePessoa(objeto,tab,function(){})},$scope.deletarItem=function(ob,index){$scope.disableObject(ob,function(){$scope.objetos.splice(index,1)})},$scope.executeRightTabClick=function(tab){if(tab){$scope.pagina=0;var operador=tab.operador||"=";if("monthPicker"==tab.tipo){var mes=$filter("date")(tab.value,"MM"),ano=$filter("date")(tab.value,"yyyy");$scope.rightQuery="month("+tab.attr+") "+operador+" '"+mes+"' and year("+tab.attr+") "+operador+" '"+ano+"'",$scope.getLikeMap([],0,0,"")}}};var _executeFixTabQuery=function(tab){console.log("Pagina ="+$scope.pagina),obAppend=tab.objectAppend,$scope.objectAppend=obAppend;var qs=[];for(var attr in obAppend){var valor=obAppend[attr];("string"==typeof valor||"date"==typeof valor)&&(valor="'"+valor+"'"),qs.push(attr+"="+valor)}$scope.fixQuerys=qs,$scope.activeTab=tab,console.log("Tab:"),console.log($scope.activeTab),$scope.pagina=0,$scope.getLikeMap(qs,0,0,"")};$scope.executeFixTabQuery=_executeFixTabQuery,$scope.tabs&&_executeFixTabQuery($scope.tabs[0]),$scope.executeRightTabClick($scope.rightTab)},controller:"stControl"}}).directive("optionsTable",function(){return{templateUrl:"view/templates/st-table/optionsTable.html",scope:{ob:"="}}})}(),function(){angular.module("adm").directive("autoCompleteObject",function(stService,$compile,$filter,$log,stUtil,$uibModal,$timeout,$modalStack,cacheGet){return{restrict:"AE",require:"ngModel",scope:{objectOp:"=",onDemand:"=",getCompleteObject:"=",label:"=",placeHolder:"=",labelCad:"=",placeHolderCad:"=",ngModel:"=",defaulText:"=",initialBusca:"=",extraClass:"=",fixProperties:"=",valueOnly:"=",itens:"=",subLabel:"=",showSubLabel:"=",hideResults:"=",autoFocus:"=",showResultsOnFocus:"=",idInput:"=",resultadoBusca:"=",useCache:"=",autoShowBusca:"="},templateUrl:"global/st-api/app-autocomplete/template-module/autoCompleteObject.html",link:function($scope,element,attrs,ctrl){function getModelValue(){return $scope.modelValue}function getInitialBusca(){return $scope.initialBusca}function setModelValue(item){$scope.modelValue=item[label]||item}function buscarItem(valueLabel,callback){if(valueLabel=valueLabel||"",$scope.aba="resultados",$scope.useCache&&0!=$scope.useCache){var itens=(new Date,cacheGet.get($scope.objectOp,label,valueLabel));itens=jlinq.from(itens).starts(label,valueLabel).select();var its=[];for(var i in itens)its.push([itens[i].id,itens[i][label]]);callback(its)}else{var query=label+" like '%"+valueLabel+"%'",qs=[];qs=qs.concat(querys),qs.push(query);var objeto=$scope.objectOp;objeto=objeto[0].toUpperCase()+objeto.slice(1);var subLabel="";$scope.subLabel&&(subLabel=","+$scope.subLabel.attr);var ops={qs:qs,columns:"id,"+$scope.label+subLabel||"*",groupBy:"id",objeto:objeto};$scope.loadingBusca=!0,stService.getProjecoes(ops).success(function(data){$scope.loadingBusca=!1,callback(data.itens)}).error(function(){$scope.loadingBusca=!1,$scope.messageResult="Ocorreu um erro, tente novamente."})}}function selecionarItem(item){if(1==$scope.getCompleteObject)stService.getById(nomeObjeto,item[0]).success(function(data){setValueItem(data.item)});else{var ob={};ob.id=item[0],ob[label]=item[1],setValueItem(ob)}}function setValueItem(objetoSele){var viewValue;viewValue=1==$scope.valueOnly?objetoSele[label]:objetoSele,$scope.modelValue=objetoSele[label],setModelValue(objetoSele),ctrl.$setViewValue(viewValue),$scope.focusBusca=!1,$scope.labelValue=objetoSele[label],$scope.obs=null,$scope.aba="resultados"}function executeBuscarItens(labelValue){buscarItem(labelValue,function(itens){0==itens.length?$scope.messageResult="Não encontrado '"+labelValue+"'.":$scope.messageResult="",$scope.obs=itens,$scope.resultadoBusca=itens})}$scope.$watch("ngModel",function(value){value||($scope.labelValue="")});var fix=$scope.fixProperties||[],querys=[];for(var key in fix)querys.push(key+"='"+fix[key]+"'");var nomeObjeto=$scope.objectOp,label=$scope.label,labelCad=$scope.labelCad,placeHolder=($scope.onDemand,$scope.placeHolder||"Digite um valor"),lastKeyUp=0;attrs.inline&&"false"!=attrs.inline||element.bind("click",function(){$scope.openBusca()}),$timeout(function(){if(ctrl.$viewValue){var value;value=$scope.valueOnly?ctrl.$viewValue:ctrl.$viewValue[label]||ctrl.$viewValue||"Selecione uma opção",$scope.modelValue=value}},0),$scope.editarItem=function(){},$scope.buscarItem=function(labelValue){var d=new Date,execute=!1;return d.getTime()-lastKeyUp<300?(lastKeyUp=d.getTime(),execute=!0,void $timeout(function(){1==execute&&executeBuscarItens(labelValue)},300)):(lastKeyUp=d.getTime(),void executeBuscarItens(labelValue))},$scope.cadItem=function(value,allFilials){cadItem(value,allFilials)},$scope.selecionarItem=selecionarItem,$scope.alterarAba=function(aba){$scope.aba=aba},$scope.openBusca=function(){$uibModal.open({animation:!0,templateUrl:"global/st-api/app-autocomplete/template-module/buscaAutoCompleteObject.html",size:"lg",controller:function($scope,$modalInstance){$scope.label=label,$scope.labelCad=labelCad,$scope.placeHolder=placeHolder,$scope.modelValue=getModelValue(),$scope.initialBusca=getInitialBusca(),$scope.focusBusca=!0,console.log("initialBusca: "+getInitialBusca()),$scope.inputFocus=function(labelValue){1==$scope.showResultsOnFocus&&$scope.buscarItem(labelValue)},$scope.selecionarItem=function(item,modal){selecionarItem(item),$modalInstance.close()},$scope.cadItem=function(value,allFilials){$scope.salvandoItem=!0;var ob={};ob[label]=value;for(var k in fix)ob[k]=fix[k];ob.allFilials=allFilials;var query=label+" = '"+ob[label]+"'",qs=[];qs.push(query),qs=qs.concat(querys),console.log("salvandoItem: "+$scope.salvandoItem),stService.getLikeMap(nomeObjeto,qs,0,0,"").success(function(data){return data.itens.length>0?(stUtil.showMessage("","Já existe um registro com '"+ob[label]+"' cadastrado no sistema","danger"),void($scope.salvandoItem=!1)):void stService.save(nomeObjeto,ob).success(function(data){var objeto=[data.item.id,data.item[label]];selecionarItem(objeto),value="",$scope.salvandoItem=!1,stUtil.showMessage("","'"+ob[label]+"' cadastrado com sucesso!","info"),$modalInstance.close()}).error(function(){stUtil.showMessage("","Ocorreu um erro, verifique sua conexão com a internet.","danger"),$scope.salvandoItem=!1,$modalInstance.close()})}).error(function(){stUtil.showMessage("","Ocorreu um erro, verifique sua conexão com a internet.","danger"),$scope.salvandoItem=!1})},$scope.alterarAba=function(aba){$scope.aba=aba},$scope.buscarItem=function(valueLabel){$scope.loadingBusca=!0,buscarItem(valueLabel,function(itens){$scope.loadingBusca=!1,0==itens.length?$scope.messageResult="Não encontrado '"+valueLabel+"'.":$scope.messageResult="",$scope.obs=itens})},void 0!=$scope.initialBusca&&$scope.buscarItem($scope.initialBusca),$scope.fecharModal=function(ele){ele.$dismiss("cancel")}}})},1==$scope.autoShowBusca&&$scope.openBusca(),querys=querys.filter(function(value){return value.length>0?value:void 0})}}})}(),function(){angular.module("adm").directive("modalContent",function($templateCache){return{templateUrl:"global/st-api/st-modal/template-module/modalContent.html",restrict:"E",transclude:!0,scope:{titulo:"=",iconeTitulo:"=",modalInstance:"=",labelCloseButton:"=",disableOkButton:"=",loadingOkAction:"=",okAction:"=",okActionLabel:"=",forceOkActionShowLabel:"=",okActionIcon:"=",cancelAction:"=",deleteAction:"=",item:"="},controller:function($scope,$timeout){$scope.disableOkButton=$scope.disableOkButton||!1,$scope.currentStep=0,$scope.cancelAction=$scope.cancelAction||function(){$scope.modalInstance&&$scope.modalInstance.$dismiss("cancel")},$scope.localAction=function(){console.log("localAction")}}}}).directive("stModal",function($filter){return{templateUrl:"global/st-api/st-modal/template-module/stModal.html",restrict:"AE",transclude:!0,scope:{titulo:"@",icon:"@",idmodal:"@",size:"@",okIcon:"@",okLabel:"@"},link:function($scope,element,attrs){}}})}(),function(){angular.module("adm").factory("$stModal",function($uibModal){var _showAlert=function(modal){$uibModal.open({animation:!0,template:"global/st-api/st-modal/template-module/modalAlert.html",controller:function($scope,modal){$scope.modal=modal,$scope.close=function(){modal.dismiss("cancel")}},size:100})};return{showAlert:_showAlert}})}(),function(){angular.module("adm").directive("stNav",function($timeout){return{restrict:"E",templateUrl:"global/st-api/st-nav/template-module/stNav.html",scope:{activeTab:"=",tabs:"="},controller:function($scope){$scope.activeTab||($scope.activeTab=0),$scope.alterarTab=function(tab){$scope.activeTab=tab}}}})}(),function(){angular.module("adm").directive("stCheckbox",function(movUtil){return{templateUrl:"global/st-api/st-checkbox/template-module/stCheckbox.html",scope:{ngModel:"=",label:"=",cofirmacao:"="}}})}(),function(){angular.module("adm").directive("cardList",function(){return{restrict:"E",transclude:!0,scope:{ob:"=",hideButtons:"=",pivo:"=",editFunction:"=",deleteFunction:"=",index:"@",icon:"@"},templateUrl:"global/st-api/card-list/template-module/cardListDirective.html",bindToController:!0,controllerAs:"vm",controller:"cardListController"}})}(),function(){angular.module("adm").controller("cardListController",function(stUtil){var vm=this;console.log("pivo: "+vm.pivo),console.log("ob:"),console.log(vm.ob),vm.labelPivo=stUtil.getValueOfNivel(vm.ob,vm.pivo)})}(),function(){angular.module("adm").config(function($routeProvider,$httpProvider){$routeProvider.when("/prot/:template",{templateUrl:"global/st-api/app-prototype/template-route/prototype.html",controller:function($scope,$rootScope,$route,stService,$localStorage,$http,loginUtil){loginUtil.logar({usuario:$localStorage.usuario,empresa:$localStorage.empresa,senha:$localStorage.senha},!0,function(){$scope.showTemplate=!0;for(var prot=$route.current.params.template,urlBase="global/st-api/app-prototype/prots/"+prot+"/",versions=[],i=1;10>=i;i++)versions.push({id:i,label:"Versão "+i,template:urlBase+i+".html"});$localStorage.activeVersion=$localStorage["prot_"+prot]||versions[0],$scope.activeVersion=$localStorage.activeVersion,$scope.changeActiveVersion=function(v){$scope.activeVersion=v,$localStorage["prot_"+prot]=v},$scope.funcao=function(){console.log("!!!!!!!!!!!!!!!!!!!!!!!!")},$scope.vs=versions,angular.forEach($scope.vs,function(v){$http.get(v.template).success(function(){v.enable=!0,console.log("Erro em: "+v.template)})})})}})})}(),function(){angular.module("adm").directive("testUserButton",function(stService,$uibModal,stUtil){return{restrict:"AE",templateUrl:"global/st-api/test-user/template-module/testUserButton.html",link:function($rootScope,element,attrs){var _openDetalhe=function(){$rootScope.testIsOpen=!0,modal=$uibModal.open({animation:!0,templateUrl:"global/st-api/test-user/template-module/testUserDetalhe.html",size:"lg",controller:function($scope,$rootScope,$modalInstance,chronoService,$timeout){$scope.$on("modal.closing",function(){$rootScope.testIsOpen=!1});var _getProxTest=function(){$scope.carregandoTest=!0,stService.executeGet("testuser/prox-test").success(function(data){$rootScope.definition=data.item,null!=data.item&&$("#descricao-teste").html(data.item.descricao),$scope.carregandoTest=!1,stService.executeGet("/testuser/saldo-for-user").success(function(data){$rootScope.saldoTestes=data.item||0,stService.executeGet("/testuser/total-tests-for-user").success(function(data){$rootScope.quantTests=data.item||0})})}).error(function(){$scope.carregandoTest=!1,stUsilt.showMessage("","ocorreu um erro ao recuperar informações do teste, tente novamente"),$modalInstance.close()})};$scope.getProxTest=_getProxTest,$timeout(_getProxTest,300),$rootScope.voltar=function(){$modalInstance.close(),$rootScope.testIsOpen=!1},$rootScope.iniciarTeste=function(){$rootScope.iniTeste=(new Date).getTime(),$modalInstance.close(),$rootScope.executandoTeste=!0,$rootScope.testIsOpen=!1,chronoService.addTimer("myTimer",{interval:500}),chronoService.start(),stUtil.showMessage("","O teste foi iniciado!","info")},$rootScope.finalizarTeste=function(comentario,erroSistema){var teste={};teste.definition=$rootScope.definition,teste.comentario=comentario,teste.tempoGasto=(new Date).getTime()-$rootScope.iniTeste||0,teste.erroSistema=erroSistema,$rootScope.definition.queryVerification&&null!=$rootScope.definition.queryVerification?stService.executeGet("projecao/execute-query",{query:$rootScope.definition.queryVerification}).success(function(data){data.itens.length>0||1==erroSistema?_openDetalheFeedBack(teste):stUtil.showMessage("","Você não executou o teste corretamente, tente novamente ou descreva o erro nos","danger")}):_openDetalheFeedBack(teste)};var _openDetalheFeedBack=function(test){$uibModal.open({animation:!0,templateUrl:"global/st-api/test-user/template-module/testeUserResposta.html",size:"lg",controller:function($scope,$modalInstance){$scope.test=test,$scope.salvar=function(){return $scope.test.nivelDificuldadeFromUser?void stService.executePost("testuser/add/",$scope.test).success(function(){stUtil.showMessage("","Teste executado com sucesso!","info"),$modalInstance.close(),$rootScope.executandoTeste=!1,$rootScope.testIsOpen=!1,_getProxTest()}):void stUtil.showMessage("","Escolha uma opção","danger")}}})}}})};element.bind("click",function(){_openDetalhe()})}}})}(),function(){angular.module("adm").config(function($routeProvider,$httpProvider){$routeProvider.when("/testdefinition",{templateUrl:"global/st-api/test-user/template-route/testDefinition.html",controller:function($scope,stService,stUtil,$uibModal){$scope.openDetalhe=function(definition){$uibModal.open({animation:!0,templateUrl:"global/st-api/test-user/template-module/detalheTestDefinition.html",size:"lg",controller:function($scope,$modalInstance){$scope.definition=definition||{},$scope.salvar=function(){stService.executePost("testdefinition/add/",$scope.definition).success(function(){$modalInstance.close()})}}})}}})})}(),function(){angular.module("adm").factory("tutorialUtil",function($rootScope,$filter,stUtil,$uibModal){var _openDetalheTutorial=function(tutorialItem){$uibModal.open({animation:!0,templateUrl:"global/st-api/st-tutorial/template-module/detalheTutorial.html",size:"lg",controllerAs:"vm",bindToController:!0,controller:function($scope,deviceDetector){var vm=this;vm.tutorial=tutorialItem,1==deviceDetector.isMobile()?vm.linkTutorial=tutorialItem.linkMobile:vm.linkTutorial=tutorialItem.linkDesktop;var youtubePlayer;vm.playerVars={modestbranding:1,rel:0,start:30,end:39},$scope.$on("youtube.player.ready",function($event,player){youtubePlayer=player,youtubePlayer.playVideo()})}})};return{openDetalheTutorial:_openDetalheTutorial}})}(),function(){angular.module("adm").directive("buttonTutorial",function($uibModal,tutorialUtil){return{restrict:"AE",link:function(scope,element,attrs){element.bind("click",function(){$uibModal.open({animation:!0,templateUrl:"global/st-api/st-tutorial/template-module/tutorialList.html",size:"lg",controllerAs:"vm",bindToController:!0,controller:function($scope){var vm=this;vm.tutoriais=[{titulo:"Vendas",descricao:"Como realizar uma venda, listagem de vendas",linkMobile:"https://www.youtube.com/watch?v=sOdiWXFF9Ms",linkDesktop:"https://www.youtube.com/watch?v=93RTB0PXAU0&feature=youtu.be"},{titulo:"Estoque",descricao:"Cadastro e listagem de produtos",linkMobile:"",linkDesktop:""}],vm.openTutorial=function(item){tutorialUtil.openDetalheTutorial(item)}}})})}}})}();